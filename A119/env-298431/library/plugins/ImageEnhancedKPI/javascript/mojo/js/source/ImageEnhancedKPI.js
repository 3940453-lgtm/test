(()=>{"use strict";mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});const t={LIGHT:{AREA:"AUTO",TREND:"AUTO",TREND_OPACITY:"40",FONT:"#35383A",AREA_FILL_OPACITY:10,IMG_FILL_COLOR:"AUTO",IMG_FILL_OPACITY:100,SECONDARY_VALUE_FONT_COLOR:"#727679"},NIGHT:{AREA:"#313855",TREND:"#539CAE",TREND_OPACITY:"100",FONT:"#FFFFFF"},DESERT:{AREA:"#606060",TREND:"#FFD333",TREND_OPACITY:"100",FONT:"#FFFFFF"},OCEAN:{AREA:"#5181D7",TREND:"#83C8F4",TREND_OPACITY:"100",FONT:"#FFFFFF"}},e={INCREASE:"#20A76C",DECREASE:"#D9232E",CONSTANT:"#575A5D"},n={LIGHT:"#FFFFFF",NIGHT:"#4D4D4D"},r="#CA3D40",a="#A9ADB1";mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var i={METRICS:0,TREND:1},o={METRICS:0,COMPARE_WITH:1,BREAK_BY:2,TREND:3},l=function(t){return 0===t?i:o};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var c="N/A",u="1",s="referenceLineLabel",d="previousValueLabel",f="removeWidgetString",m="card-vertical-with-trend-graph",p="card-vertical-no-trend-graph",h="card-vertical-no-trend",y="card-horizontal-with-trend-graph",g="card-horizontal-no-trend-graph",v="card-horizontal-no-trend";function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function b(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach(function(e){_(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function _(t,e,n){return(e=function(t){var e=function(t){if("object"!=E(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==E(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var A={TEXT_CONTENT_TYPE:{ALL:"all",LABEL:"label",PRIMARY_VALUE:"primaryValue",SECONDARY_VALUE:"secondaryValue",INDICATOR:"indicator"},TREND_SHAPE:{AREA:"area",BAR:"bar",LINE:"line"},AXIS_SCALE:{GLOBAL:"global",SYNCED_METRIC:"synced",SYNCED_ALL:"syncedAll"},CARD_ALIGNMENT:{LEFT:"left",MIDDLE:"middle",RIGHT:"right"},TREND_INDICATOR_SHAPE:{BADGE:"badge",ARROW:"arrow"},TREND_INDICATOR_VALUE_TYPE:{PERCENT:"percentValue",NUMERIC:"numericValue"},SELECTED_REFERENCE_LINE_SHAPE:{DOTTED_LINE_TYPE:"1pt dotted",DASHED_LINE_TYPE:"1pt dashed",THIN_LINE_TYPE:"1pt solid",THICK_LINE_TYPE:"2pt solid"},REFERENCE_LINE_DEFAULT_VALUES:{font:{fontFamily:"Open Sans",style:[!1,!1,!1,!1],size:9,color:"#35383A"},line:{shape:"1pt dashed",color:"#4D4D4D"}},LAYOUT_TYPES:{GRID:0,STACKED:1,HORIZONTAL:2,VERTICAL:3},TEXT_SIZE_TYPE:{UNIFIED:0,FIT_TO_CONTAINER:1,FIXED:2},FIRST_CARD_INDEX:1},S={fontFamily:"Open Sans",fontStyle:[!1,!1,!1,!1],fontSteps:0,fontSize:""},T={HIDEABLE_SECTION_TEMPLATE:{name:"hideableSectionTemplate",defaultValue:null},CARD_STYLE:{name:"cardStyle",defaultValue:0},HIDEABLE_SECTION_LAYOUT:{name:"hideableSectionLayout",defaultValue:null},LAYOUT_TYPE:{name:"layoutType",defaultValue:A.LAYOUT_TYPES.GRID},GRID_LAYOUT_PROPERTIES:{name:"gridLayoutProperties",defaultValue:null},GRID_COLUMN_COUNT:{name:"gridColumnCount",defaultValue:4},GRID_FIX_CARD_HEIGHT:{name:"gridFixCardHeight",defaultValue:null},GRID_FIX_CARD_HEIGHT_ENABLED:{name:"gridFixCardHeightEnabled",defaultValue:!1},STACKED_LAYOUT_PROPERTIES:{name:"stackedLayoutProperties",defaultValue:null},STACKED_AUTO_PLAY:{name:"stackedAutoPlay",defaultValue:!0},SHOW_METRIC_NAME:{name:"showMetricName",defaultValue:null},SECONDARY_VALUE_LAYOUT:{name:"secondaryValueLayout",defaultValue:null},SECONDARY_METRIC_NAME:{name:"secondaryMetricName",defaultValue:""},TREND_INDICATOR_LAYOUT:{name:"trendIndicatorLayout",defaultValue:null},TREND_INDICATOR_ENABLED:{name:"trendIndicatorEnabled",defaultValue:!0},TREND_INDICATOR_ENABLED_LABEL:{name:"trendIndicatorEnabledLabel",defaultValue:""},COMPARISON_INDICATOR_ENABLED:{name:"comparisonIndicatorEnabled",defaultValue:!0},COMPARISON_INDICATOR_ENABLED_LABEL:{name:"comparisonIndicatorEnabledLabel",defaultValue:""},TREND_INDICATOR_VALUE_TYPE:{name:"trendIndicatorValueType",defaultValue:A.TREND_INDICATOR_VALUE_TYPE.PERCENT},ENTIRE_CHART_SECTION:{name:"entireKPIChartSection",defaultValue:null},TEXT_SIZE_TYPE:{name:"textSizeType",defaultValue:A.TEXT_SIZE_TYPE.UNIFIED},SHAPE_SECTION:{name:"shapeSection",defaultValue:null},SHAPE_TYPE:{name:"shapeType",defaultValue:0},SHAPE_TYPE_COMPARISON:{name:"shapeTypeComparison",defaultValue:0},SHAPE_TYPE_COMPARISON_NO_TREND:{name:"shapeTypeComparisonNoTrend",defaultValue:0},BACKGROUND_SHAPE_AREA_SECTION:{name:"backgroundShapeAreaSection",defaultValue:null},THRESHOLDS_SECTION:{name:"colorThresholdsSection",defaultValue:{thresholds:[]}},TEXT_CONTENT_TYPE:{name:"textContentType",defaultValue:A.TEXT_CONTENT_TYPE.ALL},TEXT_CONTENT_TYPE_COMPARISON:{name:"textContentTypeComparison",defaultValue:A.TEXT_CONTENT_TYPE.ALL},FONT_FAMILY:{name:"fontFamily",defaultValue:S.fontFamily},FONT_STYLE:{name:"fontStyle",defaultValue:[!1,!1,!1,!1]},FONT_STEPS:{name:"fontSteps",defaultValue:0},FONT_SIZE:{name:"fontSize",defaultValue:""},FONT_COLOR:{name:"fontColor",defaultValue:t.LIGHT.FONT},TEXT_ALL_FONT_OPTIONS:{name:"allFontOptions",defaultValue:b(b({},S),{},{fontColor:"INDETERMINATE"})},TEXT_LABEL_FONT_OPTIONS:{name:"labelFontOptions",defaultValue:b(b({},S),{},{fontColor:t.LIGHT.FONT,fontWeight:500})},TEXT_PRIMARY_VALUE_FONT_OPTIONS:{name:"primaryValueFontOptions",defaultValue:b(b({},S),{},{fontColor:t.LIGHT.FONT,fontStyle:[!0,!1,!1,!1]})},TEXT_SECONDARY_VALUE_FONT_OPTIONS:{name:"secondaryValueFontOptions",defaultValue:b(b({},S),{},{fontStyle:[!1,!1,!1,!1],fontColor:t.LIGHT.SECONDARY_VALUE_FONT_COLOR})},TEXT_INDICATOR_FONT_OPTIONS:{name:"indicatorFontOptions",defaultValue:b({},S)},AREA_FILL_COLOR:{name:"areaFillColor",defaultValue:t.LIGHT.AREA},AREA_FILL_COLOR_WITH_TREND:{name:"areaFillColorWithTrend",defaultValue:t.LIGHT.AREA},AREA_FILL_COLOR_WITH_NO_TREND:{name:"areaFillColorWithNoTrend",defaultValue:t.LIGHT.AREA},AREA_FILL_OPACITY:{name:"areaFillOpacity",defaultValue:t.LIGHT.AREA_FILL_OPACITY},TREND_FILL_COLOR:{name:"trendFillColor",defaultValue:t.LIGHT.TREND},TREND_FILL_OPACITY:{name:"trendFillOpacity",defaultValue:t.LIGHT.TREND_OPACITY},TREND_INCREASE_BACKGROUND_COLOR:{name:"trendIncreaseBackgroundColor",defaultValue:e.INCREASE},TREND_DECREASE_BACKGROUND_COLOR:{name:"trendDecreaseBackgroundColor",defaultValue:e.DECREASE},HIDEABLE_SECTION_TREND_SHAPE:{name:"hideableSectionTrendShape",defaultValue:null},TREND_SHAPE:{name:"trendShape",defaultValue:A.TREND_SHAPE.AREA},AXIS_SCALE:{name:"axisScale",defaultValue:A.AXIS_SCALE.GLOBAL},AXIS_SCALE_COMPARISON:{name:"axisScaleComparison",defaultValue:A.AXIS_SCALE.GLOBAL},EMPTY_VIZ_WARNING_MESSAGE:{name:"emptyVizWarningMessage",defaultValue:null},VIZ_FIRST_TAB_SECTION:{name:"vizFirstTabSection",defaultValue:null},VIZ_SECOND_TAB_SECTION:{name:"vizSecondTabSection",defaultValue:null},CARD_ALIGNMENT:{name:"cardAlignment",defaultValue:""},TREND_INDICATOR_SHAPE_LAYOUT:{name:"trendIndicatorShapeLayout",defaultValue:""},TREND_INDICATOR_SHAPE:{name:"trendIndicatorShape",defaultValue:A.TREND_INDICATOR_SHAPE.ARROW},TREND_CONSTANT_BACKGROUND_COLOR:{name:"trendConstantBackgroundColor",defaultValue:e.CONSTANT},DOSSIER_FONT:{name:"dossierFont",defaultValue:""},HIDEABLE_SECTION_REFERENCE_LINES:{name:"hideableSectionReferenceLines",defaultValue:null},SELECTED_REFERENCE_LINE:{name:"selectedReferenceLine",defaultValue:""},REFERENCE_LINE_CONSTANT_VALUE:{name:"referenceLineConstantValue",defaultValue:""},REFERENCE_LINE_LABEL:{name:"referenceLineLabel",defaultValue:""},CREATED_REFERENCE_LINES:{name:"createdReferenceLines",defaultValue:{}},REFERENCE_LINE_CONSTANT_VALUE_WARNING:{name:"referenceLineConstantValueWarning",defaultValue:null},REFERENCE_LINES_SECTION:{name:"referenceLinesSection",defaultValue:null},TEXT_AND_FORM_DROPDOWN_WITH_REFERENCE_LINES:{name:"textAndFormDropdownWithReferenceLines",defaultValue:0},TEXT_AND_FORM_DROPDOWN_WITHOUT_REFERENCE_LINES:{name:"textAndFormDropdownWithoutReferenceLines",defaultValue:0},SELECTED_REFERENCE_LINE_TEXT_AND_FORM:{name:"selectedReferenceLineTextAndForm",defaultValue:""},SELECTED_REFERENCE_LINE_FONT_NAME:{name:"selectedReferenceLineFontName",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.font.fontFamily},SELECTED_REFERENCE_LINE_FONT_STYLE:{name:"selectedReferenceLineFontStyle",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.font.style},SELECTED_REFERENCE_LINE_FONT_SIZE:{name:"selectedReferenceLineFontSize",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.font.size},SELECTED_REFERENCE_LINE_FONT_COLOR:{name:"selectedReferenceLineFontColor",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.font.color},SELECTED_REFERENCE_LINE_COLOR:{name:"selectedReferenceLineColor",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.line.color},SELECTED_REFERENCE_LINE_SHAPE:{name:"selectedReferenceLineShape",defaultValue:A.REFERENCE_LINE_DEFAULT_VALUES.line.shape},ACTIVE_CARD_INDEX:{name:"activeCardIndex",defaultValue:A.FIRST_CARD_INDEX},SECONDARY_METRIC_NAME_LABEL:{name:"secondaryMetricNameLabel",defaultValue:null},SECONDARY_METRIC_NAME_LABEL_COMPARISON:{name:"secondaryMetricNameLabelComparison",defaultValue:null},TREND_INCREASE_BACKGROUND_COLOR_LABEL:{name:"trendIncreaseBackgroundColorLabel",defaultValue:null},TREND_INCREASE_BACKGROUND_COLOR_LABEL_COMPARISON:{name:"trendIncreaseBackgroundColorLabelComparison",defaultValue:null},TREND_DECREASE_BACKGROUND_COLOR_LABEL:{name:"trendDecreaseBackgroundColorLabel",defaultValue:null},TREND_DECREASE_BACKGROUND_COLOR_LABEL_COMPARISON:{name:"trendDecreaseBackgroundColorLabelComparison",defaultValue:null},HIDEABLE_SECTION_IMAGE:{name:"hideableSectionImage",defaultValue:null},IMAGE_PROP_GALLERY:{name:"gallery",defaultValue:null},IMAGE_PROP_BROWSE:{name:"browse",defaultValue:null},IMAGE_PROP_BROWSE_DISABLED:{name:"browseDisabled",defaultValue:null},IMAGE_PROP_NAME:{name:"imageName",defaultValue:""},IMAGE_PROP_URL:{name:"imageSrc",defaultValue:""},IMAGE_FILL_COLOR:{name:"imgFillColor",defaultValue:t.LIGHT.IMG_FILL_COLOR},IMAGE_FILL_OPACITY:{name:"imgFillOpacity",defaultValue:t.LIGHT.IMG_FILL_OPACITY},IMAGE_SEARCH_ICON:{name:"searchIcon",defaultValue:null}};function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var M={};function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}Object.entries(T).forEach(function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(e,n)||function(t,e){if(t){if("string"==typeof t)return C(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[0],i=r[1].name;M[a]=i}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var O="properties",w=[O],D=function(t){"object"===N(t)?Object.values(t).forEach(function(t){D(t)}):Array.isArray(t)?t.forEach(function(t){D(t)}):w.push(t)};function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function L(t,e,n){return(e=function(t){var e=function(t){if("object"!=x(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==x(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}D(M),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var j=L(L(L(L(L(L({},m,{LABEL:"max(6.5cqmin, 8px)",PRIMARY_VALUE:"max(16cqmin, 12px)",SECONDARY_VALUE:"max(6cqmin, 8px)",TREND_INDICATOR:"max(5cqmin, 8px)"}),y,{LABEL:"max(min(9cqh, 6cqw), 8px)",PRIMARY_VALUE:"max(min(19.25cqh, 14.25cqw), 12px)",SECONDARY_VALUE:"max(6cqmin, 8px)",TREND_INDICATOR:"max(5cqmin, 8px)"}),v,{LABEL:"max(12cqmin, 8px)",PRIMARY_VALUE:"max(26cqmin, 12px)",SECONDARY_VALUE:null,TREND_INDICATOR:null}),h,{LABEL:"max(10cqmin, 8px)",PRIMARY_VALUE:"max(22.5cqmin, 12px)",SECONDARY_VALUE:null,TREND_INDICATOR:null}),p,{LABEL:"max(8cqmin, 8px)",PRIMARY_VALUE:"max(20cqmin, 12px)",SECONDARY_VALUE:"max(6cqmin, 8px)",TREND_INDICATOR:"max(5cqmin, 8px)"}),g,{LABEL:"max(10cqmin, 8px)",PRIMARY_VALUE:"max(24cqmin, 12px)",SECONDARY_VALUE:"max(11cqmin, 8px)",TREND_INDICATOR:"max(7.5cqmin, 8px)"});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.requiresCls("mstrmojo.css","mstrmojo.VisUtility","mstrmojo.HTMLSanitizeUtil");var P=function(t,e,n){var r=n.cardWidth,a=n.cardHeight,i=mstrmojo.css.getComputedStyle(t),o="width"===e||"maxWidth"===e?parseFloat(r):parseFloat(a);return function(t,e){if("none"!==t)return t.indexOf("px")>0?parseFloat(t):e*parseFloat(t)/100}(i[e],o-2)},R=function(t,e){return e?"max(calc("+t+" + "+e+"px), 0px)":t};function V(t){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(t)}function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function k(t,e,n){return(e=function(t){var e=function(t){if("object"!=V(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=V(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==V(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function B(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||z(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){if(t){if("string"==typeof t)return U(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U(t,e):void 0}}function U(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var K=function(t,e){return t.zonesModel.getDropZoneObjectsByIndex(e).length>0},Y=function(t){var e=t.partialValue,n=t.totalValue;return mstrmojo.num.format(4,1,"",Math.abs(e/n))},H=function(t,e,n,r){var a,i=t.fontFamily,o=t.fontColor,l=t.fontSize,c=t.fontStyle,u=G(e),s=e.getProperty(T.DOSSIER_FONT.name),d=!1;s&&s!==u&&(d=!0);var f,m,p,h,y,g,v=d?u:i,E=e.isIOS&&"Open Sans"===v?"Helvetica":v,I=(null==j||null===(a=j[n])||void 0===a?void 0:a[r])||"16px";return l&&"string"==typeof l&&l.indexOf("px")>0?I=l:l&&(I="".concat($(l),"px")),function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?F(Object(n),!0).forEach(function(e){k(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({fontSize:I,fontFamily:E,color:o},(m=(f=B(c,4))[0],p=f[1],h=f[2],y=f[3],g=[],h&&g.push("underline"),y&&g.push("line-through"),{fontWeight:m?"bold":"normal",fontStyle:p?"italic":"normal",textDecoration:g.join(" ")||"none currentcolor solid"}))},G=function(t){var e,n=null===(e=t.controller.model)||void 0===e?void 0:e.defmts.find(function(t){return"Text"===t.n});return(null==n?void 0:n.props.FormattingFont.Name)||t.getProperty(T.FONT_FAMILY.name)},W=function(t,e){var n=e<=1?e:e/100;return"rgba(".concat(parseInt(t.slice(1,3),16),",").concat(parseInt(t.slice(3,5),16),",").concat(parseInt(t.slice(5,7),16),", ").concat(n,")")},$=function(t){return 1.328147*t},X=function(t){var e=t.container,n=t.maxTextWidth,r=t.textData,a=t.fontSize,i=t.fontStyle,o=r.label,l=r.value,c=r.connector,s=o+c+l;if(e.title=s,e.style.fontSize="".concat(a,"px"),""===o)return e.textContent=l,{truncatedLabelAndValue:l,truncatedLabel:""};var d,f,m="...".concat(c);if(f=o[0]+m,rt(d+u,i,i.bonus)>=n)e.style.overflow="hidden",e.style.textOverflow="ellipsis",e.style.whiteSpace="nowrap",e.textContent=l,f="";else{for(var p=2;p<o.length;p++)if(d=o.substring(0,p)+m+l,rt(d+u,i,i.bonus)>=n){f=o.substring(0,p-1)+m;break}d=p===o.length?o+c+l:f+l,e.textContent=d}return{truncatedLabelWithValue:e.textContent,truncatedLabel:f}},q=function(t){return.75292857248934*t},Z=function(t,e){var n=t.textContent,r=Q(t,e);return mstrmojo.VisUtility.measureTextSize(n+u,r,0)},Q=function(t,e){var n=mstrmojo.css.getComputedStyle(t);return{fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontSize:"".concat(parseInt(e),"px"),fontWeight:n.fontWeight,lineHeight:1,bonus:parseInt(n.paddingLeft)+parseInt(n.paddingRight)}},J=function(t,e,n){t.forEach(function(t){t.style[e]=n})},tt=function(t){setTimeout(function(){var e,n;null===(e=(n=window).syncDossierFormatPanel)||void 0===e||e.call(n,t)},0)},et=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=t.replace("#",""),r=3===n.length?n.split("").map(function(t){return t+t}).join(""):n,a=B([0,2,4].map(function(t){return parseInt(r.substr(t,2),16)}),3),i=a[0],o=a[1],l=a[2],c=parseFloat(e.toString().replace("%",""))/100;return"rgba(".concat(i,", ").concat(o,", ").concat(l,", ").concat(c,")")},nt=/images\/material-symbols\/400\/rounded\//,rt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>5?arguments[5]:void 0,a=document.createElement("canvas"),i=a.getContext("2d"),o=e.fontSize||"16px",l=e.fontFamily||"Arial",c=e.fontWeight||"normal",u=e.fontStyle||"normal";i.font="".concat(u," ").concat(c," ").concat(o," ").concat(l);var s=t;r||(s=t.replace(/\s+/g," "));var d=i.measureText(s).width;return d+=n,a.remove(),Math.ceil(d)};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),M.EMPTY_VIZ_WARNING_MESSAGE;var at=function(t){var e=l(t.KPIType);return t.isComparisonKPI&&K(t,e.COMPARE_WITH)};function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var ot=function(t,e){for(var n={},r=function(){var r,o,c=(r=i[a],o=1,function(t){if(Array.isArray(t))return t}(r)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(r,o)||function(t,e){if(t){if("string"==typeof t)return it(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?it(t,e):void 0}}(r,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],u=t[c],f=l(e.KPIType);switch(c){case T.SHOW_METRIC_NAME.name:if(null===u){var m=K(e,f.BREAK_BY),p=function(t,e){return t.zonesModel.getDropZoneObjectsByIndex(e).length}(e,f.METRICS)>1;u=!m||p,e.showMetricName=u,tt([c])}break;case T.CARD_ALIGNMENT.name:if(!u){var h=K(e,f.TREND);u=h?A.CARD_ALIGNMENT.LEFT:A.CARD_ALIGNMENT.MIDDLE,e.cardAlignment=u,tt([c])}break;case T.SECONDARY_METRIC_NAME.name:var y,g,v=e.isComparisonKPI,E=e.isRealTime,I=e.timestampIndex,b=e.timeFilter,_=e.dataInterface,S=e.data,C=null==_||null===(y=_.data)||void 0===y||null===(g=y.wdgstrs)||void 0===g?void 0:g[d];if(u&&E&&v&&(K(e,f.COMPARE_WITH)||(u=null)),C&&!e.labelsEditState[c]&&(u=C,n[c]=u),!u){var N=v&&K(e,f.COMPARE_WITH),O=K(e,f.TREND);if(N){var w=E?_.data.gsi.mx[1].n:_.getColHeaders(0).getHeader(1).getName();u="".concat(mstrmojo.descP("IMGKPI.","39","Compare with")," ").concat(w)}else if(O){var D=K(e,f.BREAK_BY)?1:0;if(E)if(b.isMoreDataThanFilter)u="".concat(b.filterLabel," ago");else{var x=new Date(S[0].cells[I].v).toTimeString().split(" ").shift();u="Compare to ".concat(x)}else u="".concat(mstrmojo.descP("IMGKPI.","36","Previous")," ").concat(e.dataInterface.getRowTitles().getTitle(D).getName())}e.secondaryMetricName=u,tt([c])}break;case T.CREATED_REFERENCE_LINES.name:if(!u)break;var L=function(t,e){var n=e[M.SELECTED_REFERENCE_LINE];if(!n){var r,a,i=null===(r=t.dataInterface.getColTitles().titles[0])||void 0===r?void 0:r.es.map(function(t){return{n:t.n,dssid:t.oid}});null!=i&&i.find(function(t){return t.dssid===n})&&!t.isComparisonKPI||(n=null==i||null===(a=i[0])||void 0===a?void 0:a.dssid)}return n}(e,t),j=T.REFERENCE_LINE_LABEL.name;Object.keys(u).forEach(function(r){var a=function(t,e,n){var r,a;return null===(r=t.model.data.gsi.mx.find(function(t){return t.did===e}))||void 0===r||null===(a=r.wdgstrs)||void 0===a?void 0:a[n]}(e,r,s);a&&!e.labelsEditState[r]&&(u[r].label=a,n[c]=u,L===r&&(t[j]=a,n[j]=a))})}t[c]=u},a=0,i=Object.entries(t);a<i.length;a++)r();return Object.keys(n).length&&function(t,e){var n=JSON.parse(t.getProperty(O));Object.keys(e).forEach(function(t){n[t]=e[t]}),t.getProperties()[O]=JSON.stringify(n)}(e,n),t};function lt(t){return lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lt(t)}function ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ut(t,e,n){return(e=function(t){var e=function(t){if("object"!=lt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=lt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==lt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});function st(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||dt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dt(t,e){if(t){if("string"==typeof t)return ft(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ft(t,e):void 0}}function ft(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var mt=function(t){if(!t)return!0;var e=t.color,n=t.range;return!(e||null!=n&&n.value)},pt=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return t.forEach(function(t){var r=t.nfs,a=t.id,i=(r||"General").split(";").map(function(t){return function(t){var e,n=["black","blue","cyan","green","magenta","red","white","yellow"],r={range:{check:function(t){return!0}},color:void 0,formatString:t.slice(t.lastIndexOf("]")+1)},a=(e=t.matchAll(/\[([A-Za-z0-9<>=-]+)\]/g),function(t){if(Array.isArray(t))return ft(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||dt(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map(function(t){return t[1]});return a&&a.forEach(function(t){if(n.includes(t.toLowerCase()))r.color=t.toLowerCase();else{var e=Number.parseFloat(t.split(/[^0-9-,.]/).join(""));r.range.value=e,0===t.search(">")?(r.range.compareType=0,1===t.search("=")?r.range.check=function(t){return t>=e}:r.range.check=function(t){return t>e}):0===t.search("<")?(r.range.compareType=1,1===t.search("=")?r.range.check=function(t){return t<=e}:r.range.check=function(t){return t<e}):0===t.search("=")&&(r.range.check=function(t){return t===e})}}),r}(t)}),o=a;!function(t){t.length>1&&void 0===t[0].range.value&&(t[0].range={value:0,check:function(t){return t>=0}},t[1]&&void 0===t[1].range.value&&(t[1].range={value:0,check:function(t){return t<0}}),t[2]&&void 0===t[2].range.value&&(t[2].range={value:0,check:function(t){return 0===t}},t[0].range={check:function(t){return t>0}}))}(i),i.forEach(function(t){t.rules=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=mstrmojo.locales.number,r=n.THOUSANDSEPARATOR,a={thousandSeparator:"",decimalSeparator:n.DECIMALSEPARATOR,minimalIntegerLength:1,maximalFractionLength:0,minimalFractionLength:0,divisor:1,prefix:"",suffix:"",shouldLeadingZeroBeOmitted:!1},i=/"(.*?)"/g.exec(t);if(i){var o=t.search(/[#0]/);if(0!==i.length){if(i.index<o){var l=st(i,2);a.prefix=l[1]}else{var c=st(i,2);a.suffix=c[1]}i.forEach(function(e){t=t.replace(e,"")})}}for("%"===t.slice(-1)&&(a.divisor*=.01,a.suffix+=e?"%":"pp",t=t.slice(0,-1));","===t.slice(-1);)a.divisor*=1e3,t=t.slice(0,-1);t.includes(",")&&(a.thousandSeparator=r),t.includes("(")&&t.includes(")")?(a.prefix="(".concat(a.prefix),a.suffix+=")","%)"===t.slice(-2)&&(t=t.slice(0,-2),t+=")",a.divisor*=.01,a.suffix+="pp")):t.includes("-")&&(a.prefix="-".concat(a.prefix));var u=t.split(".");if(2===u.length){var s=st(u,2),d=s[0],f=s[1],m=d.match(/[0]/g);m&&(a.minimalIntegerLength=m.length),a.maximalFractionLength=f.match(/[0#]/g).length;var p=f.match(/[0]/g);p&&(a.minimalFractionLength=p.length),1===d.length&&"#"===d&&(a.shouldLeadingZeroBeOmitted=!0)}return a}(t.formatString,e)}),n[o]=i}),n},ht=function(t,e,n){var r=Number.isNaN(Number(t))?0:Number(t);return function(t,e){var n=e.color,r=e.rules,a=r.maximalFractionLength,i=r.minimalIntegerLength,o=r.minimalFractionLength,l=r.thousandSeparator,c=r.decimalSeparator,u=r.prefix,s=r.suffix,d=r.shouldLeadingZeroBeOmitted,f=r.divisor,m=t<0,p=Math.abs(t)/f,h=function(t,e,n){if(e===n)return e;var r=parseFloat(Number(t).toFixed(n)).toString().split(".")[1];return r&&r.length>e?r.length:e}(t,o,a),y=p.toFixed(h);if(d&&p<1)y=y.slice(1);else{var g=Math.pow(10,i);p<g-1&&(y=(parseFloat(y)+g).toFixed(h).slice(1))}var v=y.split(".");return v[0]=v[0].replace(/\B(?=(\d{3})+(?!\d))/g,l),y=v.join(c),!m||r.prefix.includes("(")||r.prefix.includes("-")||(y="-".concat(y)),{formattedValue:"".concat(u).concat(y).concat(s),color:n}}(r,function(t,e){var n=e.filter(function(e){return e.range.check(t)});return n.length>1?function(t,e){if(t>=0)return!1;if(e.length<=1)return!1;var n=e.filter(function(t){return!mt(t)});return n.length>0&&n.every(function(t){var e;return 1===(null===(e=t.range)||void 0===e?void 0:e.compareType)})}(t,n)?n.find(function(t){return!mt(t)}):n.reduce(function(t,e){return e.range.value&&t.range.value?e.range.value>t.range.value?e:t:e.range.value?e:t}):n[0]}(r,n[e]))};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});function yt(t){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yt(t)}function gt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gt(Object(n),!0).forEach(function(e){It(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Et(t){return function(t){if(Array.isArray(t))return _t(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||bt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(t,e,n){return(e=function(t){var e=function(t){if("object"!=yt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=yt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==yt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function bt(t,e){if(t){if("string"==typeof t)return _t(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(t,e):void 0}}function _t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var At=function(t,e,n){if(e.isRealTime){t=t.map(function(t){return St(t.cells,e)});var r=Tt(e);e.mappedIndexes=r}var a=K(e,n.TREND),i=K(e,n.BREAK_BY),o=t[0].values.map(function(){return i?new Map:[]}),l=e.isComparisonKPI,c=e.timestampIndex,u=e.isRealTime,s=e.model;return t.forEach(function(t,r){var d,f,m,p,h,y;if(!Ot(t)){if(i){var g,v,E,I,b=t.headers[0];d=b.attributeSelector,f=d.eid,m=b.name,p=null==b||null===(g=b.headerObj)||void 0===g||null===(v=g.t)||void 0===v||null===(E=v.fs)||void 0===E||null===(I=E[0])||void 0===I?void 0:I.bftp}else if(a){var _=t.headers[0];d=_.attributeSelector}if(a){var A,S,T,C,M,N,O,w,D=t.headers;h=i?null===(A=D[1])||void 0===A||null===(S=A.headerObj)||void 0===S||null===(T=S.t)||void 0===T||null===(C=T.fs[0])||void 0===C?void 0:C.bftp:null===(M=D[0])||void 0===M||null===(N=M.headerObj)||void 0===N||null===(O=N.t)||void 0===O||null===(w=O.fs[0])||void 0===w?void 0:w.bftp}t.values.forEach(function(g,v){var E,I,b,_,A,S,T,C=g.name,M=g.rv,N=g.v,O=g.id;if(1!==v||!l){y=(null==s||null===(E=s.getFullObjectInfo)||void 0===E||null===(I=E.call(s,O))||void 0===I?void 0:I.mft)||(null==s||null===(b=s.docModel)||void 0===b||null===(_=b.getObjectInfo)||void 0===_||null===(A=_.call(b,O))||void 0===A?void 0:A.mft)||(null==s||null===(S=s.getObjectInfo)||void 0===S||null===(T=S.call(s,O))||void 0===T?void 0:T.mft);var w,D,x=i?o[v].get(f):o[v][0];if(l&&(D=(w=t.values[1]||null)?{raw:w.rv,formatted:w.v}:null),x){if(a){var L=Object.keys(t.metricSelector),j={raw:M,formatted:N,graphicModel:Mt(d,t.idValueMapping,L,O)};u&&(j.timestamp=e.data[r].cells[c].v,j.timestampDate=new Date(j.timestamp)),x.trendChartData.push(j)}l&&(x.compareMetricValue=D)}else{var P;if(a){var R=Object.keys(t.metricSelector);P=[{raw:M,formatted:N,graphicModel:Mt(d,t.idValueMapping,R,O)}],u&&(P[0].timestamp=e.data[r].cells[c].v,P[0].timestampDate=new Date(P[0].timestamp))}else P=[{raw:M,formatted:N}];var V,F={metricId:O,graphicModel:Nt(d,O,e,t,n),label:{withMetricName:m?"".concat(C," - ").concat(m):C,withoutMetricName:m||""},trendChartData:P,breakByAttributeName:m,breakByAttributeFormType:p,trendAttributeFormType:h,metricFormType:y};l&&(F.compareMetricId=(null===(V=w)||void 0===V?void 0:V.id)||null,F.compareMetricValue=D),i?o[v].set(f,F):o[v].push(F)}}})}}),i?o.map(function(t){return function(t){return function(t){if(Array.isArray(t))return U(t)}(e=t.values())||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||z(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var e}(t)}):o},St=function(t,e){var n=e.isComparisonKPI,r=e.dataInterface.data.realtimeQueryInfo.columns,a={};r.forEach(function(t,e){a[t.id]=e});var i=-1,o=[],c=[],u={},s={},d=l(e.KPIType);if(e.zonesModel.getDropZoneObjectsByIndex(d.TREND).forEach(function(e){var n=a[e.id];i=n,u[e.id]=t[n].v,s[e.id]={}}),e.zonesModel.getDropZoneObjectsByIndex(d.BREAK_BY).forEach(function(e){var n=a[e.id];i=n,u[e.id]=t[n].v,s[e.id]={}}),i>=0){var f=r[i].id,m=t[i].v,p="".concat(m,";").concat(f);o.push({name:m,attributeSelector:{n:m,tid:f,eid:p,isSelectAttr:!0}})}var h,y=e.zonesModel.getDropZoneObjectsByIndex(d.METRICS);return n&&at(e)&&y.push(null===(h=e.zonesModel)||void 0===h?void 0:h.getDropZoneObjectsByIndex(d.COMPARE_WITH)[0]),e.getDocModel(),y.forEach(function(n,r){var i=a[n.id];u[n.id]=ht(t[i].v,n.id,e.metricFormattingRules).formattedValue;var o=e.dataInterface.data.gsi.mx[r].n;c.push({v:u[n.id],rv:t[i].v,id:n.id,name:o})}),{headers:o,values:c,idValueMapping:u,metricSelector:s}},Tt=function(t){var e=t.dataInterface.data.realtimeQueryInfo.columns,n=[];return e.forEach(function(t){-1===t.bfid&&n.push(t.id)}),Object.keys(n).reduce(function(t,e){return t[n[e]]=parseInt(e),t},{})},Ct=function(t,e,n){var r=e.colorThresholdsSection.thresholds,a=Et(t).sort(function(t,e){return t.primaryValue.raw-e.primaryValue.raw}),i=Et(t).sort(function(t,e){return e.primaryValue.raw-t.primaryValue.raw}),o=r.map(function(t){t.skip=!1;var e=t.advancedThreshold;if(e&&2===e.thresholdType){var n,r=null!==(n=e.rank)&&void 0!==n?n:"0",o=2===e.rankOption?a:i,l=function(t,e){return"%"===t.slice(-1)?Number(t.slice(0,-1))*e*.01:Number(t)}(r,o.length);if(l<1)return vt(vt({},t),{},{skip:!0});var c=function(t,e,n){var r=[];return t.forEach(function(t,n){if(n<=e-1){var a=t.trendChartData;r.push(a[a.length-1].raw)}}),2===n?{minValue:r[0],maxValue:r[r.length-1]}:{minValue:r[r.length-1],maxValue:r[0]}}(o,l,e.rankOption),u=c.minValue,s=c.maxValue;return vt(vt({},t),{},{min:u,max:s})}return t.min||t.max?t:vt(vt({},t),{},{min:0,max:0})}),l=function(t){return"%"==="".concat(t).slice(-1)?.01*Number(t.slice(0,-1)):t},c=function(e,r){var a=It(It(It(It(It(It(It({},2,null),3,null),4,null),5,null),6,null),7,null),8,null);return o.filter(function(a){var i=a.enabled,o=a.skip,c=a.advancedThreshold;if(!i)return!1;if(c&&3===c.thresholdType)return function(e,r){if(!n)return!1;var a=function(e){return Et(t).filter(function(t){if(t.indicator){var n=Math.sign(t.indicator.differenceBetweenPrimaryAndSecondary);return 1===e?n>0:n<0}return!1})}(e);return 0!==a.length&&a.some(function(t){return t.graphicModel.cardId===r})}(c.indicator,r);var u=parseFloat(l(a.min)||Number.NEGATIVE_INFINITY),s=parseFloat(l(a.max)||Number.POSITIVE_INFINITY);return u<=e&&s>=e&&!o}).reverse().forEach(function(t){var e=t.advancedThreshold,n=t.color;if(e){var r=e.selector,i=e.colors;1===r&&function(t,e,n,r){var a,i,o,l,c=void 0===n[1]||"INDETERMINATE"===n[1]?null:n[1];t[2]=vt(vt({},e),{},{color:null!==(a=null!=c?c:n[2])&&void 0!==a?a:r}),t[3]=vt(vt({},e),{},{color:null!==(i=null!=c?c:n[3])&&void 0!==i?i:r}),t[4]=vt(vt({},e),{},{color:null!==(o=null!=c?c:n[4])&&void 0!==o?o:r}),t[5]=vt(vt({},e),{},{color:null!==(l=null!=c?c:n[5])&&void 0!==l?l:r})}(a,t,void 0===i?{}:i,n),a[r]=t}else a[3]=t}),a};return t.map(function(t){var e=t.trendChartData,n=t.graphicModel,r=e[e.length-1].raw;return t.thresholdTarget=c(r,n.cardId),t})},Mt=function(t,e,n,r){var a=new mstrmojo.customviz.GraphicModel,i=function(t,e){var n={};return Object.keys(t).filter(function(t){return e.includes(t)}).forEach(function(e){n[e]=t[e]}),n}(e,[].concat(Et(n),[r]));return a.setSelector(t,t.isSelectAttr),a.idValueMapping=i,a},Nt=function(t,e,n,r,a){n.cardsIds||(n.cardIds=[]);var i=new mstrmojo.customviz.GraphicModel;return t?(i.setSelector(t,t.isSelectAttr),i.setCustomProperties({metricId:e,cardId:"".concat(n.id,"-").concat(e,"-").concat(t.eid)}),i.setGroupOptions([r.headers[0]]),i.setDrillOptions(t,[{dropZoneIndex:a.BREAK_BY,keepParent:!1}]),n.cardIds.push("".concat(n.id,"-").concat(e,"-").concat(t.eid))):(n.metricId=e,i.setCustomProperties({metricId:e,cardId:"".concat(n.id,"-").concat(e)}),n.cardIds.push("".concat(n.id,"-").concat(e))),i.idValueMapping=wt(r.headers),i},Ot=function(t){return t.headers.some(function(t){var e;return null===(e=t.headerObj)||void 0===e?void 0:e.h.stt})},wt=function(t){return Object.fromEntries(t.map(function(t){var e=t.attributeSelector;return[e.tid,e.n]}).slice(0,-1))};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Dt={SANITIZE_NAMED_PROPS:!0,RETURN_DOM_FRAGMENT:!0,ADD_ATTR:["target"]};function xt(t,e){if(t){if("string"==typeof t)return Lt(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Lt(t,e):void 0}}function Lt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var jt=function(t){var e,n,r,a,i,o=t.tag,l=void 0===o?"div":o,c=t.classes,u=void 0===c?[]:c,s=t.content,d=void 0===s?"":s,f=t.style,m=void 0===f?{}:f,p=t.otherAttributes,h=void 0===p?{}:p,y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=document.createElement(l);((e=v.classList).add.apply(e,function(t){if(Array.isArray(t))return Lt(t)}(i=u)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(i)||xt(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),!mstrmojo.HTMLSanitizeUtil.shouldEncodeHtmlContent()&&y&&g)?n=function(t,e){var n="",r=function(t){"_blank"===t.getAttribute("target")&&t.setAttribute("rel","noopener noreferrer"),n+=t.outerHTML},a=function(t){var e;t.nodeType===Node.ELEMENT_NODE?"IMG"===(e=t).tagName?n+="":"A"===e.tagName?r(e):e.childNodes?e.childNodes.forEach(a):n+=e.textContent:i(t)},i=function(t){n+=e?mstrmojo.string.encodeHtmlString(t.textContent):t.textContent};return t instanceof Node&&(null==t||t.childNodes.forEach(a)),n}((r=d,a=Dt,window.DOMPurify?DOMPurify.sanitize(r,a):r),y):n=y?mstrmojo.string.encodeHtmlString(d):d;return v.innerHTML=n,Object.assign(v.style,m),Object.entries(h).forEach(function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||xt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),n=e[0],r=e[1];v.setAttribute(n,mstrmojo.string.encodeHtmlString(r))}),v};function Pt(){}function Rt(t){return null==t?Pt:function(){return this.querySelector(t)}}function Vt(){return[]}function Ft(t){return null==t?Vt:function(){return this.querySelectorAll(t)}}function kt(t){return function(){return this.matches(t)}}function Bt(t){return function(e){return e.matches(t)}}var zt=Array.prototype.find;function Ut(){return this.firstElementChild}var Kt=Array.prototype.filter;function Yt(){return Array.from(this.children)}function Ht(t){return new Array(t.length)}function Gt(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}function Wt(t,e,n,r,a,i){for(var o,l=0,c=e.length,u=i.length;l<u;++l)(o=e[l])?(o.__data__=i[l],r[l]=o):n[l]=new Gt(t,i[l]);for(;l<c;++l)(o=e[l])&&(a[l]=o)}function $t(t,e,n,r,a,i,o){var l,c,u,s=new Map,d=e.length,f=i.length,m=new Array(d);for(l=0;l<d;++l)(c=e[l])&&(m[l]=u=o.call(c,c.__data__,l,e)+"",s.has(u)?a[l]=c:s.set(u,c));for(l=0;l<f;++l)u=o.call(t,i[l],l,i)+"",(c=s.get(u))?(r[l]=c,c.__data__=i[l],s.delete(u)):n[l]=new Gt(t,i[l]);for(l=0;l<d;++l)(c=e[l])&&s.get(m[l])===c&&(a[l]=c)}function Xt(t){return t.__data__}function qt(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function Zt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}Gt.prototype={constructor:Gt,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};var Qt="http://www.w3.org/1999/xhtml";const Jt={svg:"http://www.w3.org/2000/svg",xhtml:Qt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function te(t){var e=t+="",n=e.indexOf(":");return n>=0&&"xmlns"!==(e=t.slice(0,n))&&(t=t.slice(n+1)),Jt.hasOwnProperty(e)?{space:Jt[e],local:t}:t}function ee(t){return function(){this.removeAttribute(t)}}function ne(t){return function(){this.removeAttributeNS(t.space,t.local)}}function re(t,e){return function(){this.setAttribute(t,e)}}function ae(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ie(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}}function oe(t,e){return function(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function le(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ce(t){return function(){this.style.removeProperty(t)}}function ue(t,e,n){return function(){this.style.setProperty(t,e,n)}}function se(t,e,n){return function(){var r=e.apply(this,arguments);null==r?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function de(t,e){return t.style.getPropertyValue(e)||le(t).getComputedStyle(t,null).getPropertyValue(e)}function fe(t){return function(){delete this[t]}}function me(t,e){return function(){this[t]=e}}function pe(t,e){return function(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}}function he(t){return t.trim().split(/^|\s+/)}function ye(t){return t.classList||new ge(t)}function ge(t){this._node=t,this._names=he(t.getAttribute("class")||"")}function ve(t,e){for(var n=ye(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function Ee(t,e){for(var n=ye(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Ie(t){return function(){ve(this,t)}}function be(t){return function(){Ee(this,t)}}function _e(t,e){return function(){(e.apply(this,arguments)?ve:Ee)(this,t)}}function Ae(){this.textContent=""}function Se(t){return function(){this.textContent=t}}function Te(t){return function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}}function Ce(){this.innerHTML=""}function Me(t){return function(){this.innerHTML=t}}function Ne(t){return function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}}function Oe(){this.nextSibling&&this.parentNode.appendChild(this)}function we(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function De(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Qt&&e.documentElement.namespaceURI===Qt?e.createElement(t):e.createElementNS(n,t)}}function xe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Le(t){var e=te(t);return(e.local?xe:De)(e)}function je(){return null}function Pe(){var t=this.parentNode;t&&t.removeChild(this)}function Re(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ve(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Fe(t){return function(){var e=this.__on;if(e){for(var n,r=0,a=-1,i=e.length;r<i;++r)n=e[r],t.type&&n.type!==t.type||n.name!==t.name?e[++a]=n:this.removeEventListener(n.type,n.listener,n.options);++a?e.length=a:delete this.__on}}}function ke(t,e,n){return function(){var r,a=this.__on,i=function(t){return function(e){t.call(this,e,this.__data__)}}(e);if(a)for(var o=0,l=a.length;o<l;++o)if((r=a[o]).type===t.type&&r.name===t.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=i,r.options=n),void(r.value=e);this.addEventListener(t.type,i,n),r={type:t.type,name:t.name,value:e,listener:i,options:n},a?a.push(r):this.__on=[r]}}function Be(t,e,n){var r=le(t),a=r.CustomEvent;"function"==typeof a?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function ze(t,e){return function(){return Be(this,t,e)}}function Ue(t,e){return function(){return Be(this,t,e.apply(this,arguments))}}ge.prototype={add:function(t){this._names.indexOf(t)<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};var Ke=[null];function Ye(t,e){this._groups=t,this._parents=e}function He(){return new Ye([[document.documentElement]],Ke)}Ye.prototype=He.prototype={constructor:Ye,select:function(t){"function"!=typeof t&&(t=Rt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o,l=e[a],c=l.length,u=r[a]=new Array(c),s=0;s<c;++s)(i=l[s])&&(o=t.call(i,i.__data__,s,l))&&("__data__"in i&&(o.__data__=i.__data__),u[s]=o);return new Ye(r,this._parents)},selectAll:function(t){t="function"==typeof t?function(t){return function(){return null==(e=t.apply(this,arguments))?[]:Array.isArray(e)?e:Array.from(e);var e}}(t):Ft(t);for(var e=this._groups,n=e.length,r=[],a=[],i=0;i<n;++i)for(var o,l=e[i],c=l.length,u=0;u<c;++u)(o=l[u])&&(r.push(t.call(o,o.__data__,u,l)),a.push(o));return new Ye(r,a)},selectChild:function(t){return this.select(null==t?Ut:function(t){return function(){return zt.call(this.children,t)}}("function"==typeof t?t:Bt(t)))},selectChildren:function(t){return this.selectAll(null==t?Yt:function(t){return function(){return Kt.call(this.children,t)}}("function"==typeof t?t:Bt(t)))},filter:function(t){"function"!=typeof t&&(t=kt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,c=r[a]=[],u=0;u<l;++u)(i=o[u])&&t.call(i,i.__data__,u,o)&&c.push(i);return new Ye(r,this._parents)},data:function(t,e){if(!arguments.length)return Array.from(this,Xt);var n,r=e?$t:Wt,a=this._parents,i=this._groups;"function"!=typeof t&&(n=t,t=function(){return n});for(var o=i.length,l=new Array(o),c=new Array(o),u=new Array(o),s=0;s<o;++s){var d=a[s],f=i[s],m=f.length,p=qt(t.call(d,d&&d.__data__,s,a)),h=p.length,y=c[s]=new Array(h),g=l[s]=new Array(h);r(d,f,y,g,u[s]=new Array(m),p,e);for(var v,E,I=0,b=0;I<h;++I)if(v=y[I]){for(I>=b&&(b=I+1);!(E=g[b])&&++b<h;);v._next=E||null}}return(l=new Ye(l,a))._enter=c,l._exit=u,l},enter:function(){return new Ye(this._enter||this._groups.map(Ht),this._parents)},exit:function(){return new Ye(this._exit||this._groups.map(Ht),this._parents)},join:function(t,e,n){var r=this.enter(),a=this,i=this.exit();return"function"==typeof t?(r=t(r))&&(r=r.selection()):r=r.append(t+""),null!=e&&(a=e(a))&&(a=a.selection()),null==n?i.remove():n(i),r&&a?r.merge(a).order():a},merge:function(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,i=r.length,o=Math.min(a,i),l=new Array(a),c=0;c<o;++c)for(var u,s=n[c],d=r[c],f=s.length,m=l[c]=new Array(f),p=0;p<f;++p)(u=s[p]||d[p])&&(m[p]=u);for(;c<a;++c)l[c]=n[c];return new Ye(l,this._parents)},selection:function(){return this},order:function(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r,a=t[e],i=a.length-1,o=a[i];--i>=0;)(r=a[i])&&(o&&4^r.compareDocumentPosition(o)&&o.parentNode.insertBefore(r,o),o=r);return this},sort:function(t){function e(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}t||(t=Zt);for(var n=this._groups,r=n.length,a=new Array(r),i=0;i<r;++i){for(var o,l=n[i],c=l.length,u=a[i]=new Array(c),s=0;s<c;++s)(o=l[s])&&(u[s]=o);u.sort(e)}return new Ye(a,this._parents).order()},call:function(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length;a<i;++a){var o=r[a];if(o)return o}return null},size:function(){let t=0;for(const e of this)++t;return t},empty:function(){return!this.node()},each:function(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a,i=e[n],o=0,l=i.length;o<l;++o)(a=i[o])&&t.call(a,a.__data__,o,i);return this},attr:function(t,e){var n=te(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==e?n.local?ne:ee:"function"==typeof e?n.local?oe:ie:n.local?ae:re)(n,e))},style:function(t,e,n){return arguments.length>1?this.each((null==e?ce:"function"==typeof e?se:ue)(t,e,null==n?"":n)):de(this.node(),t)},property:function(t,e){return arguments.length>1?this.each((null==e?fe:"function"==typeof e?pe:me)(t,e)):this.node()[t]},classed:function(t,e){var n=he(t+"");if(arguments.length<2){for(var r=ye(this.node()),a=-1,i=n.length;++a<i;)if(!r.contains(n[a]))return!1;return!0}return this.each(("function"==typeof e?_e:e?Ie:be)(n,e))},text:function(t){return arguments.length?this.each(null==t?Ae:("function"==typeof t?Te:Se)(t)):this.node().textContent},html:function(t){return arguments.length?this.each(null==t?Ce:("function"==typeof t?Ne:Me)(t)):this.node().innerHTML},raise:function(){return this.each(Oe)},lower:function(){return this.each(we)},append:function(t){var e="function"==typeof t?t:Le(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})},insert:function(t,e){var n="function"==typeof t?t:Le(t),r=null==e?je:"function"==typeof e?e:Rt(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function(){return this.each(Pe)},clone:function(t){return this.select(t?Ve:Re)},datum:function(t){return arguments.length?this.property("__data__",t):this.node().__data__},on:function(t,e,n){var r,a,i=function(t){return t.trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");return n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),{type:t,name:e}})}(t+""),o=i.length;if(!(arguments.length<2)){for(l=e?ke:Fe,r=0;r<o;++r)this.each(l(i[r],e,n));return this}var l=this.node().__on;if(l)for(var c,u=0,s=l.length;u<s;++u)for(r=0,c=l[u];r<o;++r)if((a=i[r]).type===c.type&&a.name===c.name)return c.value},dispatch:function(t,e){return this.each(("function"==typeof e?Ue:ze)(t,e))},[Symbol.iterator]:function*(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r,a=t[e],i=0,o=a.length;i<o;++i)(r=a[i])&&(yield r)}};const Ge=He;var We={value:()=>{}};function $e(){for(var t,e=0,n=arguments.length,r={};e<n;++e){if(!(t=arguments[e]+"")||t in r||/[\s.]/.test(t))throw new Error("illegal type: "+t);r[t]=[]}return new Xe(r)}function Xe(t){this._=t}function qe(t,e){for(var n,r=0,a=t.length;r<a;++r)if((n=t[r]).name===e)return n.value}function Ze(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=We,t=t.slice(0,r).concat(t.slice(r+1));break}return null!=n&&t.push({name:e,value:n}),t}Xe.prototype=$e.prototype={constructor:Xe,on:function(t,e){var n,r,a=this._,i=(r=a,(t+"").trim().split(/^|\s+/).map(function(t){var e="",n=t.indexOf(".");if(n>=0&&(e=t.slice(n+1),t=t.slice(0,n)),t&&!r.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:e}})),o=-1,l=i.length;if(!(arguments.length<2)){if(null!=e&&"function"!=typeof e)throw new Error("invalid callback: "+e);for(;++o<l;)if(n=(t=i[o]).type)a[n]=Ze(a[n],t.name,e);else if(null==e)for(n in a)a[n]=Ze(a[n],t.name,null);return this}for(;++o<l;)if((n=(t=i[o]).type)&&(n=qe(a[n],t.name)))return n},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Xe(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var n,r,a=new Array(n),i=0;i<n;++i)a[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=0,n=(r=this._[t]).length;i<n;++i)r[i].value.apply(e,a)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};const Qe=$e;var Je,tn,en=0,nn=0,rn=0,an=0,on=0,ln=0,cn="object"==typeof performance&&performance.now?performance:Date,un="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function sn(){return on||(un(dn),on=cn.now()+ln)}function dn(){on=0}function fn(){this._call=this._time=this._next=null}function mn(t,e,n){var r=new fn;return r.restart(t,e,n),r}function pn(){on=(an=cn.now())+ln,en=nn=0;try{!function(){sn(),++en;for(var t,e=Je;e;)(t=on-e._time)>=0&&e._call.call(void 0,t),e=e._next;--en}()}finally{en=0,function(){for(var t,e,n=Je,r=1/0;n;)n._call?(r>n._time&&(r=n._time),t=n,n=n._next):(e=n._next,n._next=null,n=t?t._next=e:Je=e);tn=t,yn(r)}(),on=0}}function hn(){var t=cn.now(),e=t-an;e>1e3&&(ln-=e,an=t)}function yn(t){en||(nn&&(nn=clearTimeout(nn)),t-on>24?(t<1/0&&(nn=setTimeout(pn,t-cn.now()-ln)),rn&&(rn=clearInterval(rn))):(rn||(an=cn.now(),rn=setInterval(hn,1e3)),en=1,un(pn)))}function gn(t,e,n){var r=new fn;return e=null==e?0:+e,r.restart(n=>{r.stop(),t(n+e)},e,n),r}fn.prototype=mn.prototype={constructor:fn,restart:function(t,e,n){if("function"!=typeof t)throw new TypeError("callback is not a function");n=(null==n?sn():+n)+(null==e?0:+e),this._next||tn===this||(tn?tn._next=this:Je=this,tn=this),this._call=t,this._time=n,yn()},stop:function(){this._call&&(this._call=null,this._time=1/0,yn())}};var vn=Qe("start","end","cancel","interrupt"),En=[];function In(t,e,n,r,a,i){var o=t.__transition;if(o){if(n in o)return}else t.__transition={};!function(t,e,n){var r,a=t.__transition;function i(c){var u,s,d,f;if(1!==n.state)return l();for(u in a)if((f=a[u]).name===n.name){if(3===f.state)return gn(i);4===f.state?(f.state=6,f.timer.stop(),f.on.call("interrupt",t,t.__data__,f.index,f.group),delete a[u]):+u<e&&(f.state=6,f.timer.stop(),f.on.call("cancel",t,t.__data__,f.index,f.group),delete a[u])}if(gn(function(){3===n.state&&(n.state=4,n.timer.restart(o,n.delay,n.time),o(c))}),n.state=2,n.on.call("start",t,t.__data__,n.index,n.group),2===n.state){for(n.state=3,r=new Array(d=n.tween.length),u=0,s=-1;u<d;++u)(f=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(r[++s]=f);r.length=s+1}}function o(e){for(var a=e<n.duration?n.ease.call(null,e/n.duration):(n.timer.restart(l),n.state=5,1),i=-1,o=r.length;++i<o;)r[i].call(t,a);5===n.state&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){for(var r in n.state=6,n.timer.stop(),delete a[e],a)return;delete t.__transition}a[e]=n,n.timer=mn(function(t){n.state=1,n.timer.restart(i,n.delay,n.time),n.delay<=t&&i(t-n.delay)},0,n.time)}(t,n,{name:e,index:r,group:a,on:vn,tween:En,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:0})}function bn(t,e){var n=An(t,e);if(n.state>0)throw new Error("too late; already scheduled");return n}function _n(t,e){var n=An(t,e);if(n.state>3)throw new Error("too late; already running");return n}function An(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Sn(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var Tn,Cn=180/Math.PI,Mn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Nn(t,e,n,r,a,i){var o,l,c;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,c/=l),t*r<e*n&&(t=-t,e=-e,c=-c,o=-o),{translateX:a,translateY:i,rotate:Math.atan2(e,t)*Cn,skewX:Math.atan(c)*Cn,scaleX:o,scaleY:l}}function On(t,e,n,r){function a(t){return t.length?t.pop()+" ":""}return function(i,o){var l=[],c=[];return i=t(i),o=t(o),function(t,r,a,i,o,l){if(t!==a||r!==i){var c=o.push("translate(",null,e,null,n);l.push({i:c-4,x:Sn(t,a)},{i:c-2,x:Sn(r,i)})}else(a||i)&&o.push("translate("+a+e+i+n)}(i.translateX,i.translateY,o.translateX,o.translateY,l,c),function(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(a(n)+"rotate(",null,r)-2,x:Sn(t,e)})):e&&n.push(a(n)+"rotate("+e+r)}(i.rotate,o.rotate,l,c),function(t,e,n,i){t!==e?i.push({i:n.push(a(n)+"skewX(",null,r)-2,x:Sn(t,e)}):e&&n.push(a(n)+"skewX("+e+r)}(i.skewX,o.skewX,l,c),function(t,e,n,r,i,o){if(t!==n||e!==r){var l=i.push(a(i)+"scale(",null,",",null,")");o.push({i:l-4,x:Sn(t,n)},{i:l-2,x:Sn(e,r)})}else 1===n&&1===r||i.push(a(i)+"scale("+n+","+r+")")}(i.scaleX,i.scaleY,o.scaleX,o.scaleY,l,c),i=o=null,function(t){for(var e,n=-1,r=c.length;++n<r;)l[(e=c[n]).i]=e.x(t);return l.join("")}}}var wn=On(function(t){const e=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Mn:Nn(e.a,e.b,e.c,e.d,e.e,e.f)},"px, ","px)","deg)"),Dn=On(function(t){return null==t?Mn:(Tn||(Tn=document.createElementNS("http://www.w3.org/2000/svg","g")),Tn.setAttribute("transform",t),(t=Tn.transform.baseVal.consolidate())?Nn((t=t.matrix).a,t.b,t.c,t.d,t.e,t.f):Mn)},", ",")",")");function xn(t,e){var n,r;return function(){var a=_n(this,t),i=a.tween;if(i!==n)for(var o=0,l=(r=n=i).length;o<l;++o)if(r[o].name===e){(r=r.slice()).splice(o,1);break}a.tween=r}}function Ln(t,e,n){var r,a;if("function"!=typeof n)throw new Error;return function(){var i=_n(this,t),o=i.tween;if(o!==r){a=(r=o).slice();for(var l={name:e,value:n},c=0,u=a.length;c<u;++c)if(a[c].name===e){a[c]=l;break}c===u&&a.push(l)}i.tween=a}}function jn(t,e,n){var r=t._id;return t.each(function(){var t=_n(this,r);(t.value||(t.value={}))[e]=n.apply(this,arguments)}),function(t){return An(t,r).value[e]}}function Pn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Rn(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Vn(){}var Fn=.7,kn=1/Fn,Bn="\\s*([+-]?\\d+)\\s*",zn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Un="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Kn=/^#([0-9a-f]{3,8})$/,Yn=new RegExp(`^rgb\\(${Bn},${Bn},${Bn}\\)$`),Hn=new RegExp(`^rgb\\(${Un},${Un},${Un}\\)$`),Gn=new RegExp(`^rgba\\(${Bn},${Bn},${Bn},${zn}\\)$`),Wn=new RegExp(`^rgba\\(${Un},${Un},${Un},${zn}\\)$`),$n=new RegExp(`^hsl\\(${zn},${Un},${Un}\\)$`),Xn=new RegExp(`^hsla\\(${zn},${Un},${Un},${zn}\\)$`),qn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Zn(){return this.rgb().formatHex()}function Qn(){return this.rgb().formatRgb()}function Jn(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Kn.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?tr(e):3===n?new rr(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?er(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?er(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Yn.exec(t))?new rr(e[1],e[2],e[3],1):(e=Hn.exec(t))?new rr(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Gn.exec(t))?er(e[1],e[2],e[3],e[4]):(e=Wn.exec(t))?er(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=$n.exec(t))?ur(e[1],e[2]/100,e[3]/100,1):(e=Xn.exec(t))?ur(e[1],e[2]/100,e[3]/100,e[4]):qn.hasOwnProperty(t)?tr(qn[t]):"transparent"===t?new rr(NaN,NaN,NaN,0):null}function tr(t){return new rr(t>>16&255,t>>8&255,255&t,1)}function er(t,e,n,r){return r<=0&&(t=e=n=NaN),new rr(t,e,n,r)}function nr(t,e,n,r){return 1===arguments.length?((a=t)instanceof Vn||(a=Jn(a)),a?new rr((a=a.rgb()).r,a.g,a.b,a.opacity):new rr):new rr(t,e,n,null==r?1:r);var a}function rr(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function ar(){return`#${cr(this.r)}${cr(this.g)}${cr(this.b)}`}function ir(){const t=or(this.opacity);return`${1===t?"rgb(":"rgba("}${lr(this.r)}, ${lr(this.g)}, ${lr(this.b)}${1===t?")":`, ${t})`}`}function or(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function lr(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function cr(t){return((t=lr(t))<16?"0":"")+t.toString(16)}function ur(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new dr(t,e,n,r)}function sr(t){if(t instanceof dr)return new dr(t.h,t.s,t.l,t.opacity);if(t instanceof Vn||(t=Jn(t)),!t)return new dr;if(t instanceof dr)return t;var e=(t=t.rgb()).r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),i=Math.max(e,n,r),o=NaN,l=i-a,c=(i+a)/2;return l?(o=e===i?(n-r)/l+6*(n<r):n===i?(r-e)/l+2:(e-n)/l+4,l/=c<.5?i+a:2-i-a,o*=60):l=c>0&&c<1?0:o,new dr(o,l,c,t.opacity)}function dr(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function fr(t){return(t=(t||0)%360)<0?t+360:t}function mr(t){return Math.max(0,Math.min(1,t||0))}function pr(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function hr(t,e,n,r,a){var i=t*t,o=i*t;return((1-3*t+3*i-o)*e+(4-6*i+3*o)*n+(1+3*t+3*i-3*o)*r+o*a)/6}Pn(Vn,Jn,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Zn,formatHex:Zn,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return sr(this).formatHsl()},formatRgb:Qn,toString:Qn}),Pn(rr,nr,Rn(Vn,{brighter(t){return t=null==t?kn:Math.pow(kn,t),new rr(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=null==t?Fn:Math.pow(Fn,t),new rr(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new rr(lr(this.r),lr(this.g),lr(this.b),or(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ar,formatHex:ar,formatHex8:function(){return`#${cr(this.r)}${cr(this.g)}${cr(this.b)}${cr(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ir,toString:ir})),Pn(dr,function(t,e,n,r){return 1===arguments.length?sr(t):new dr(t,e,n,null==r?1:r)},Rn(Vn,{brighter(t){return t=null==t?kn:Math.pow(kn,t),new dr(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=null==t?Fn:Math.pow(Fn,t),new dr(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new rr(pr(t>=240?t-240:t+120,a,r),pr(t,a,r),pr(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new dr(fr(this.h),mr(this.s),mr(this.l),or(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=or(this.opacity);return`${1===t?"hsl(":"hsla("}${fr(this.h)}, ${100*mr(this.s)}%, ${100*mr(this.l)}%${1===t?")":`, ${t})`}`}}));const yr=t=>()=>t;function gr(t,e){var n=e-t;return n?function(t,e){return function(n){return t+n*e}}(t,n):yr(isNaN(t)?e:t)}const vr=function t(e){var n=function(t){return 1===(t=+t)?gr:function(e,n){return n-e?function(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}(e,n,t):yr(isNaN(e)?n:e)}}(e);function r(t,e){var r=n((t=nr(t)).r,(e=nr(e)).r),a=n(t.g,e.g),i=n(t.b,e.b),o=gr(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=a(e),t.b=i(e),t.opacity=o(e),t+""}}return r.gamma=t,r}(1);function Er(t){return function(e){var n,r,a=e.length,i=new Array(a),o=new Array(a),l=new Array(a);for(n=0;n<a;++n)r=nr(e[n]),i[n]=r.r||0,o[n]=r.g||0,l[n]=r.b||0;return i=t(i),o=t(o),l=t(l),r.opacity=1,function(t){return r.r=i(t),r.g=o(t),r.b=l(t),r+""}}}Er(function(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),a=t[r],i=t[r+1],o=r>0?t[r-1]:2*a-i,l=r<e-1?t[r+2]:2*i-a;return hr((n-r/e)*e,o,a,i,l)}}),Er(function(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),a=t[(r+e-1)%e],i=t[r%e],o=t[(r+1)%e],l=t[(r+2)%e];return hr((n-r/e)*e,a,i,o,l)}});var Ir=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,br=new RegExp(Ir.source,"g");function _r(t,e){var n,r,a,i=Ir.lastIndex=br.lastIndex=0,o=-1,l=[],c=[];for(t+="",e+="";(n=Ir.exec(t))&&(r=br.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),l[o]?l[o]+=a:l[++o]=a),(n=n[0])===(r=r[0])?l[o]?l[o]+=r:l[++o]=r:(l[++o]=null,c.push({i:o,x:Sn(n,r)})),i=br.lastIndex;return i<e.length&&(a=e.slice(i),l[o]?l[o]+=a:l[++o]=a),l.length<2?c[0]?function(t){return function(e){return t(e)+""}}(c[0].x):function(t){return function(){return t}}(e):(e=c.length,function(t){for(var n,r=0;r<e;++r)l[(n=c[r]).i]=n.x(t);return l.join("")})}function Ar(t,e){var n;return("number"==typeof e?Sn:e instanceof Jn?vr:(n=Jn(e))?(e=n,vr):_r)(t,e)}function Sr(t){return function(){this.removeAttribute(t)}}function Tr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Cr(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Mr(t,e,n){var r,a,i=n+"";return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function Nr(t,e,n){var r,a,i;return function(){var o,l,c=n(this);if(null!=c)return(o=this.getAttribute(t))===(l=c+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,c));this.removeAttribute(t)}}function Or(t,e,n){var r,a,i;return function(){var o,l,c=n(this);if(null!=c)return(o=this.getAttributeNS(t.space,t.local))===(l=c+"")?null:o===r&&l===a?i:(a=l,i=e(r=o,c));this.removeAttributeNS(t.space,t.local)}}function wr(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&function(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}(t,a)),n}return a._value=e,a}function Dr(t,e){var n,r;function a(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&function(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}(t,a)),n}return a._value=e,a}function xr(t,e){return function(){bn(this,t).delay=+e.apply(this,arguments)}}function Lr(t,e){return e=+e,function(){bn(this,t).delay=e}}function jr(t,e){return function(){_n(this,t).duration=+e.apply(this,arguments)}}function Pr(t,e){return e=+e,function(){_n(this,t).duration=e}}var Rr=Ge.prototype.constructor;function Vr(t){return function(){this.style.removeProperty(t)}}var Fr=0;function kr(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Br(){return++Fr}var zr=Ge.prototype;kr.prototype=function(t){return Ge().transition(t)}.prototype={constructor:kr,select:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Rt(t));for(var r=this._groups,a=r.length,i=new Array(a),o=0;o<a;++o)for(var l,c,u=r[o],s=u.length,d=i[o]=new Array(s),f=0;f<s;++f)(l=u[f])&&(c=t.call(l,l.__data__,f,u))&&("__data__"in l&&(c.__data__=l.__data__),d[f]=c,In(d[f],e,n,f,d,An(l,n)));return new kr(i,this._parents,e,n)},selectAll:function(t){var e=this._name,n=this._id;"function"!=typeof t&&(t=Ft(t));for(var r=this._groups,a=r.length,i=[],o=[],l=0;l<a;++l)for(var c,u=r[l],s=u.length,d=0;d<s;++d)if(c=u[d]){for(var f,m=t.call(c,c.__data__,d,u),p=An(c,n),h=0,y=m.length;h<y;++h)(f=m[h])&&In(f,e,n,h,m,p);i.push(m),o.push(c)}return new kr(i,o,e,n)},selectChild:zr.selectChild,selectChildren:zr.selectChildren,filter:function(t){"function"!=typeof t&&(t=kt(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i,o=e[a],l=o.length,c=r[a]=[],u=0;u<l;++u)(i=o[u])&&t.call(i,i.__data__,u,o)&&c.push(i);return new kr(r,this._parents,this._name,this._id)},merge:function(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),o=new Array(r),l=0;l<i;++l)for(var c,u=e[l],s=n[l],d=u.length,f=o[l]=new Array(d),m=0;m<d;++m)(c=u[m]||s[m])&&(f[m]=c);for(;l<r;++l)o[l]=e[l];return new kr(o,this._parents,this._name,this._id)},selection:function(){return new Rr(this._groups,this._parents)},transition:function(){for(var t=this._name,e=this._id,n=Br(),r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],c=l.length,u=0;u<c;++u)if(o=l[u]){var s=An(o,e);In(o,t,n,u,l,{time:s.time+s.delay+s.duration,delay:0,duration:s.duration,ease:s.ease})}return new kr(r,this._parents,t,n)},call:zr.call,nodes:zr.nodes,node:zr.node,size:zr.size,empty:zr.empty,each:zr.each,on:function(t,e){var n=this._id;return arguments.length<2?An(this.node(),n).on.on(t):this.each(function(t,e,n){var r,a,i=function(t){return(t+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||"start"===t})}(e)?bn:_n;return function(){var o=i(this,t),l=o.on;l!==r&&(a=(r=l).copy()).on(e,n),o.on=a}}(n,t,e))},attr:function(t,e){var n=te(t),r="transform"===n?Dn:Ar;return this.attrTween(t,"function"==typeof e?(n.local?Or:Nr)(n,r,jn(this,"attr."+t,e)):null==e?(n.local?Tr:Sr)(n):(n.local?Mr:Cr)(n,r,e))},attrTween:function(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==e)return this.tween(n,null);if("function"!=typeof e)throw new Error;var r=te(t);return this.tween(n,(r.local?wr:Dr)(r,e))},style:function(t,e,n){var r="transform"==(t+="")?wn:Ar;return null==e?this.styleTween(t,function(t,e){var n,r,a;return function(){var i=de(this,t),o=(this.style.removeProperty(t),de(this,t));return i===o?null:i===n&&o===r?a:a=e(n=i,r=o)}}(t,r)).on("end.style."+t,Vr(t)):"function"==typeof e?this.styleTween(t,function(t,e,n){var r,a,i;return function(){var o=de(this,t),l=n(this),c=l+"";return null==l&&(this.style.removeProperty(t),c=l=de(this,t)),o===c?null:o===r&&c===a?i:(a=c,i=e(r=o,l))}}(t,r,jn(this,"style."+t,e))).each(function(t,e){var n,r,a,i,o="style."+e,l="end."+o;return function(){var c=_n(this,t),u=c.on,s=null==c.value[o]?i||(i=Vr(e)):void 0;u===n&&a===s||(r=(n=u).copy()).on(l,a=s),c.on=r}}(this._id,t)):this.styleTween(t,function(t,e,n){var r,a,i=n+"";return function(){var o=de(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}(t,r,e),n).on("end.style."+t,null)},styleTween:function(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==e)return this.tween(r,null);if("function"!=typeof e)throw new Error;return this.tween(r,function(t,e,n){var r,a;function i(){var i=e.apply(this,arguments);return i!==a&&(r=(a=i)&&function(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}(t,i,n)),r}return i._value=e,i}(t,e,null==n?"":n))},text:function(t){return this.tween("text","function"==typeof t?function(t){return function(){var e=t(this);this.textContent=null==e?"":e}}(jn(this,"text",t)):function(t){return function(){this.textContent=t}}(null==t?"":t+""))},textTween:function(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(null==t)return this.tween(e,null);if("function"!=typeof t)throw new Error;return this.tween(e,function(t){var e,n;function r(){var r=t.apply(this,arguments);return r!==n&&(e=(n=r)&&function(t){return function(e){this.textContent=t.call(this,e)}}(r)),e}return r._value=t,r}(t))},remove:function(){return this.on("end.remove",function(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}(this._id))},tween:function(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r,a=An(this.node(),n).tween,i=0,o=a.length;i<o;++i)if((r=a[i]).name===t)return r.value;return null}return this.each((null==e?xn:Ln)(n,t,e))},delay:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?xr:Lr)(e,t)):An(this.node(),e).delay},duration:function(t){var e=this._id;return arguments.length?this.each(("function"==typeof t?jr:Pr)(e,t)):An(this.node(),e).duration},ease:function(t){var e=this._id;return arguments.length?this.each(function(t,e){if("function"!=typeof e)throw new Error;return function(){_n(this,t).ease=e}}(e,t)):An(this.node(),e).ease},easeVarying:function(t){if("function"!=typeof t)throw new Error;return this.each(function(t,e){return function(){var n=e.apply(this,arguments);if("function"!=typeof n)throw new Error;_n(this,t).ease=n}}(this._id,t))},end:function(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(i,o){var l={value:o},c={value:function(){0===--a&&i()}};n.each(function(){var n=_n(this,r),a=n.on;a!==t&&((e=(t=a).copy())._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),n.on=e}),0===a&&i()})},[Symbol.iterator]:zr[Symbol.iterator]};var Ur={time:null,delay:0,duration:250,ease:function(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}};function Kr(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}Ge.prototype.interrupt=function(t){return this.each(function(){!function(t,e){var n,r,a,i=t.__transition,o=!0;if(i){for(a in e=null==e?null:e+"",i)(n=i[a]).name===e?(r=n.state>2&&n.state<5,n.state=6,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[a]):o=!1;o&&delete t.__transition}}(this,t)})},Ge.prototype.transition=function(t){var e,n;t instanceof kr?(e=t._id,t=t._name):(e=Br(),(n=Ur).time=sn(),t=null==t?null:t+"");for(var r=this._groups,a=r.length,i=0;i<a;++i)for(var o,l=r[i],c=l.length,u=0;u<c;++u)(o=l[u])&&In(o,t,e,u,l,n||Kr(o,e));return new kr(r,this._parents,t,e)};const{abs:Yr,max:Hr,min:Gr}=Math;function Wr(t){return{type:t}}function $r(t){return"string"==typeof t?new Ye([[document.querySelector(t)]],[document.documentElement]):new Ye([[t]],Ke)}function Xr(t,e){if(t=function(t){let e;for(;e=t.sourceEvent;)t=e;return t}(t),void 0===e&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,[(r=r.matrixTransform(e.getScreenCTM().inverse())).x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}["w","e"].map(Wr),["n","s"].map(Wr),["n","w","e","s","nw","ne","sw","se"].map(Wr);const qr={passive:!1},Zr={capture:!0,passive:!1};function Qr(t){t.stopImmediatePropagation()}function Jr(t){t.preventDefault(),t.stopImmediatePropagation()}const ta=t=>()=>t;function ea(t,{sourceEvent:e,subject:n,target:r,identifier:a,active:i,x:o,y:l,dx:c,dy:u,dispatch:s}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:r,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:i,enumerable:!0,configurable:!0},x:{value:o,enumerable:!0,configurable:!0},y:{value:l,enumerable:!0,configurable:!0},dx:{value:c,enumerable:!0,configurable:!0},dy:{value:u,enumerable:!0,configurable:!0},_:{value:s}})}function na(t){return!t.ctrlKey&&!t.button}function ra(){return this.parentNode}function aa(t,e){return null==e?{x:t.x,y:t.y}:e}function ia(){return navigator.maxTouchPoints||"ontouchstart"in this}function oa(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t)}return this}ea.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};class la extends Map{constructor(t,e=ua){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}}),null!=t)for(const[e,n]of t)this.set(e,n)}get(t){return super.get(ca(this,t))}has(t){return super.has(ca(this,t))}set(t,e){return super.set(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):(t.set(r,n),n)}(this,t),e)}delete(t){return super.delete(function({_intern:t,_key:e},n){const r=e(n);return t.has(r)&&(n=t.get(r),t.delete(r)),n}(this,t))}}function ca({_intern:t,_key:e},n){const r=e(n);return t.has(r)?t.get(r):n}function ua(t){return null!==t&&"object"==typeof t?t.valueOf():t}Set;const sa=Symbol("implicit");function da(){var t=new la,e=[],n=[],r=sa;function a(a){let i=t.get(a);if(void 0===i){if(r!==sa)return r;t.set(a,i=e.push(a)-1)}return n[i%n.length]}return a.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new la;for(const r of n)t.has(r)||t.set(r,e.push(r)-1);return a},a.range=function(t){return arguments.length?(n=Array.from(t),a):n.slice()},a.unknown=function(t){return arguments.length?(r=t,a):r},a.copy=function(){return da(e,n).unknown(r)},oa.apply(a,arguments),a}function fa(){var t,e,n=da().unknown(void 0),r=n.domain,a=n.range,i=0,o=1,l=!1,c=0,u=0,s=.5;function d(){var n=r().length,d=o<i,f=d?o:i,m=d?i:o;t=(m-f)/Math.max(1,n-c+2*u),l&&(t=Math.floor(t)),f+=(m-f-t*(n-c))*s,e=t*(1-c),l&&(f=Math.round(f),e=Math.round(e));var p=function(t,e,n){t=+t,e=+e,n=(a=arguments.length)<2?(e=t,t=0,1):a<3?1:+n;for(var r=-1,a=0|Math.max(0,Math.ceil((e-t)/n)),i=new Array(a);++r<a;)i[r]=t+r*n;return i}(n).map(function(e){return f+t*e});return a(d?p.reverse():p)}return delete n.unknown,n.domain=function(t){return arguments.length?(r(t),d()):r()},n.range=function(t){return arguments.length?([i,o]=t,i=+i,o=+o,d()):[i,o]},n.rangeRound=function(t){return[i,o]=t,i=+i,o=+o,l=!0,d()},n.bandwidth=function(){return e},n.step=function(){return t},n.round=function(t){return arguments.length?(l=!!t,d()):l},n.padding=function(t){return arguments.length?(c=Math.min(1,u=+t),d()):c},n.paddingInner=function(t){return arguments.length?(c=Math.min(1,t),d()):c},n.paddingOuter=function(t){return arguments.length?(u=+t,d()):u},n.align=function(t){return arguments.length?(s=Math.max(0,Math.min(1,t)),d()):s},n.copy=function(){return fa(r(),[i,o]).round(l).paddingInner(c).paddingOuter(u).align(s)},oa.apply(d(),arguments)}const ma=Math.sqrt(50),pa=Math.sqrt(10),ha=Math.sqrt(2);function ya(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),i=r/Math.pow(10,a),o=i>=ma?10:i>=pa?5:i>=ha?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/o,l=Math.round(t*u),c=Math.round(e*u),l/u<t&&++l,c/u>e&&--c,u=-u):(u=Math.pow(10,a)*o,l=Math.round(t/u),c=Math.round(e/u),l*u<t&&++l,c*u>e&&--c),c<l&&.5<=n&&n<2?ya(t,e,2*n):[l,c,u]}function ga(t,e,n){return ya(t=+t,e=+e,n=+n)[2]}function va(t,e){return null==t||null==e?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ea(t,e){return null==t||null==e?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ia(t){let e,n,r;function a(t,r,a=0,i=t.length){if(a<i){if(0!==e(r,r))return i;do{const e=a+i>>>1;n(t[e],r)<0?a=e+1:i=e}while(a<i)}return a}return 2!==t.length?(e=va,n=(e,n)=>va(t(e),n),r=(e,n)=>t(e)-n):(e=t===va||t===Ea?t:ba,n=t,r=t),{left:a,center:function(t,e,n=0,i=t.length){const o=a(t,e,n,i-1);return o>n&&r(t[o-1],e)>-r(t[o],e)?o-1:o},right:function(t,r,a=0,i=t.length){if(a<i){if(0!==e(r,r))return i;do{const e=a+i>>>1;n(t[e],r)<=0?a=e+1:i=e}while(a<i)}return a}}}function ba(){return 0}const _a=Ia(va),Aa=_a.right,Sa=(_a.left,Ia(function(t){return null===t?NaN:+t}).center,Aa);function Ta(t,e){var n,r=e?e.length:0,a=t?Math.min(r,t.length):0,i=new Array(a),o=new Array(r);for(n=0;n<a;++n)i[n]=Oa(t[n],e[n]);for(;n<r;++n)o[n]=e[n];return function(t){for(n=0;n<a;++n)o[n]=i[n](t);return o}}function Ca(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Ma(t,e){var n,r={},a={};for(n in null!==t&&"object"==typeof t||(t={}),null!==e&&"object"==typeof e||(e={}),e)n in t?r[n]=Oa(t[n],e[n]):a[n]=e[n];return function(t){for(n in r)a[n]=r[n](t);return a}}function Na(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,a=e.slice();return function(i){for(n=0;n<r;++n)a[n]=t[n]*(1-i)+e[n]*i;return a}}function Oa(t,e){var n,r,a=typeof e;return null==e||"boolean"===a?yr(e):("number"===a?Sn:"string"===a?(n=Jn(e))?(e=n,vr):_r:e instanceof Jn?vr:e instanceof Date?Ca:(r=e,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(e)?Ta:"function"!=typeof e.valueOf&&"function"!=typeof e.toString||isNaN(e)?Ma:Sn:Na))(t,e)}function wa(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Da(t){return+t}var xa=[0,1];function La(t){return t}function ja(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:(n=isNaN(e)?NaN:.5,function(){return n});var n}function Pa(t,e,n){var r=t[0],a=t[1],i=e[0],o=e[1];return a<r?(r=ja(a,r),i=n(o,i)):(r=ja(r,a),i=n(i,o)),function(t){return i(r(t))}}function Ra(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),i=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)a[o]=ja(t[o],t[o+1]),i[o]=n(e[o],e[o+1]);return function(e){var n=Sa(t,e,1,r)-1;return i[n](a[n](e))}}var Va,Fa=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ka(t){if(!(e=Fa.exec(t)))throw new Error("invalid format: "+t);var e;return new Ba({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function Ba(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function za(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Ua(t){return(t=za(Math.abs(t)))?t[1]:NaN}function Ka(t,e){var n=za(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}ka.prototype=Ba.prototype,Ba.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ya={"%":(t,e)=>(100*t).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:function(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)},e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Ka(100*t,e),r:Ka,s:function(t,e){var n=za(t,e);if(!n)return t+"";var r=n[0],a=n[1],i=a-(Va=3*Math.max(-8,Math.min(8,Math.floor(a/3))))+1,o=r.length;return i===o?r:i>o?r+new Array(i-o+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+za(t,Math.max(0,e+i-1))[0]},X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Ha(t){return t}var Ga,Wa,$a,Xa=Array.prototype.map,qa=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function Za(t){var e=t.domain;return t.ticks=function(t){var n=e();return function(t,e,n){if(!((n=+n)>0))return[];if((t=+t)===(e=+e))return[t];const r=e<t,[a,i,o]=r?ya(e,t,n):ya(t,e,n);if(!(i>=a))return[];const l=i-a+1,c=new Array(l);if(r)if(o<0)for(let t=0;t<l;++t)c[t]=(i-t)/-o;else for(let t=0;t<l;++t)c[t]=(i-t)*o;else if(o<0)for(let t=0;t<l;++t)c[t]=(a+t)/-o;else for(let t=0;t<l;++t)c[t]=(a+t)*o;return c}(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return function(t,e,n,r){var a,i=function(t,e,n){n=+n;const r=(e=+e)<(t=+t),a=r?ga(e,t,n):ga(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}(t,e,n);switch((r=ka(null==r?",f":r)).type){case"s":var o=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(a=function(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(Ua(e)/3)))-Ua(Math.abs(t)))}(i,o))||(r.precision=a),$a(r,o);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(a=function(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ua(e)-Ua(t))+1}(i,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=a-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(a=function(t){return Math.max(0,-Ua(Math.abs(t)))}(i))||(r.precision=a-2*("%"===r.type))}return Wa(r)}(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,a,i=e(),o=0,l=i.length-1,c=i[o],u=i[l],s=10;for(u<c&&(a=c,c=u,u=a,a=o,o=l,l=a);s-- >0;){if((a=ga(c,u,n))===r)return i[o]=c,i[l]=u,e(i);if(a>0)c=Math.floor(c/a)*a,u=Math.ceil(u/a)*a;else{if(!(a<0))break;c=Math.ceil(c*a)/a,u=Math.floor(u*a)/a}r=a}return t},t}function Qa(){var t=function(){var t,e,n,r,a,i,o=xa,l=xa,c=Oa,u=La;function s(){var t,e,n,c=Math.min(o.length,l.length);return u!==La&&(t=o[0],e=o[c-1],t>e&&(n=t,t=e,e=n),u=function(n){return Math.max(t,Math.min(e,n))}),r=c>2?Ra:Pa,a=i=null,d}function d(e){return null==e||isNaN(e=+e)?n:(a||(a=r(o.map(t),l,c)))(t(u(e)))}return d.invert=function(n){return u(e((i||(i=r(l,o.map(t),Sn)))(n)))},d.domain=function(t){return arguments.length?(o=Array.from(t,Da),s()):o.slice()},d.range=function(t){return arguments.length?(l=Array.from(t),s()):l.slice()},d.rangeRound=function(t){return l=Array.from(t),c=wa,s()},d.clamp=function(t){return arguments.length?(u=!!t||La,s()):u!==La},d.interpolate=function(t){return arguments.length?(c=t,s()):c},d.unknown=function(t){return arguments.length?(n=t,d):n},function(n,r){return t=n,e=r,s()}}()(La,La);return t.copy=function(){return e=t,Qa().domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown());var e},oa.apply(t,arguments),Za(t)}function Ja(t){return"object"==typeof t&&"length"in t?t:Array.from(t)}function ti(t){return function(){return t}}function ei(t){this._context=t}function ni(t){return new ei(t)}Ga=function(t){var e,n,r=void 0===t.grouping||void 0===t.thousands?Ha:(e=Xa.call(t.grouping,Number),n=t.thousands+"",function(t,r){for(var a=t.length,i=[],o=0,l=e[0],c=0;a>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),i.push(t.substring(a-=l,a+l)),!((c+=l+1)>r));)l=e[o=(o+1)%e.length];return i.reverse().join(n)}),a=void 0===t.currency?"":t.currency[0]+"",i=void 0===t.currency?"":t.currency[1]+"",o=void 0===t.decimal?".":t.decimal+"",l=void 0===t.numerals?Ha:function(t){return function(e){return e.replace(/[0-9]/g,function(e){return t[+e]})}}(Xa.call(t.numerals,String)),c=void 0===t.percent?"%":t.percent+"",u=void 0===t.minus?"":t.minus+"",s=void 0===t.nan?"NaN":t.nan+"";function d(t){var e=(t=ka(t)).fill,n=t.align,d=t.sign,f=t.symbol,m=t.zero,p=t.width,h=t.comma,y=t.precision,g=t.trim,v=t.type;"n"===v?(h=!0,v="g"):Ya[v]||(void 0===y&&(y=12),g=!0,v="g"),(m||"0"===e&&"="===n)&&(m=!0,e="0",n="=");var E="$"===f?a:"#"===f&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",I="$"===f?i:/[%p]/.test(v)?c:"",b=Ya[v],_=/[defgprs%]/.test(v);function A(t){var a,i,c,f=E,A=I;if("c"===v)A=b(t)+A,t="";else{var S=(t=+t)<0||1/t<0;if(t=isNaN(t)?s:b(Math.abs(t),y),g&&(t=function(t){t:for(var e,n=t.length,r=1,a=-1;r<n;++r)switch(t[r]){case".":a=e=r;break;case"0":0===a&&(a=r),e=r;break;default:if(!+t[r])break t;a>0&&(a=0)}return a>0?t.slice(0,a)+t.slice(e+1):t}(t)),S&&0===+t&&"+"!==d&&(S=!1),f=(S?"("===d?d:u:"-"===d||"("===d?"":d)+f,A=("s"===v?qa[8+Va/3]:"")+A+(S&&"("===d?")":""),_)for(a=-1,i=t.length;++a<i;)if(48>(c=t.charCodeAt(a))||c>57){A=(46===c?o+t.slice(a+1):t.slice(a))+A,t=t.slice(0,a);break}}h&&!m&&(t=r(t,1/0));var T=f.length+t.length+A.length,C=T<p?new Array(p-T+1).join(e):"";switch(h&&m&&(t=r(C+t,C.length?p-A.length:1/0),C=""),n){case"<":t=f+t+A+C;break;case"=":t=f+C+t+A;break;case"^":t=C.slice(0,T=C.length>>1)+f+t+A+C.slice(T);break;default:t=C+f+t+A}return l(t)}return y=void 0===y?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y)),A.toString=function(){return t+""},A}return{format:d,formatPrefix:function(t,e){var n=d(((t=ka(t)).type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(Ua(e)/3))),a=Math.pow(10,-r),i=qa[8+r/3];return function(t){return n(a*t)+i}}}}({thousands:",",grouping:[3],currency:["$",""]}),Wa=Ga.format,$a=Ga.formatPrefix,Array.prototype.slice,ei.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e)}}};const ri=Math.PI,ai=2*ri,ii=1e-6,oi=ai-ii;function li(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}class ci{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?li:function(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return li;const n=10**e;return function(t){this._+=t[0];for(let e=1,r=t.length;e<r;++e)this._+=Math.round(arguments[e]*n)/n+t[e]}}(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,n,r){this._append`Q${+t},${+e},${this._x1=+n},${this._y1=+r}`}bezierCurveTo(t,e,n,r,a,i){this._append`C${+t},${+e},${+n},${+r},${this._x1=+a},${this._y1=+i}`}arcTo(t,e,n,r,a){if(t=+t,e=+e,n=+n,r=+r,(a=+a)<0)throw new Error(`negative radius: ${a}`);let i=this._x1,o=this._y1,l=n-t,c=r-e,u=i-t,s=o-e,d=u*u+s*s;if(null===this._x1)this._append`M${this._x1=t},${this._y1=e}`;else if(d>ii)if(Math.abs(s*l-c*u)>ii&&a){let f=n-i,m=r-o,p=l*l+c*c,h=f*f+m*m,y=Math.sqrt(p),g=Math.sqrt(d),v=a*Math.tan((ri-Math.acos((p+d-h)/(2*y*g)))/2),E=v/g,I=v/y;Math.abs(E-1)>ii&&this._append`L${t+E*u},${e+E*s}`,this._append`A${a},${a},0,0,${+(s*f>u*m)},${this._x1=t+I*l},${this._y1=e+I*c}`}else this._append`L${this._x1=t},${this._y1=e}`}arc(t,e,n,r,a,i){if(t=+t,e=+e,i=!!i,(n=+n)<0)throw new Error(`negative radius: ${n}`);let o=n*Math.cos(r),l=n*Math.sin(r),c=t+o,u=e+l,s=1^i,d=i?r-a:a-r;null===this._x1?this._append`M${c},${u}`:(Math.abs(this._x1-c)>ii||Math.abs(this._y1-u)>ii)&&this._append`L${c},${u}`,n&&(d<0&&(d=d%ai+ai),d>oi?this._append`A${n},${n},0,1,${s},${t-o},${e-l}A${n},${n},0,1,${s},${this._x1=c},${this._y1=u}`:d>ii&&this._append`A${n},${n},0,${+(d>=ri)},${s},${this._x1=t+n*Math.cos(a)},${this._y1=e+n*Math.sin(a)}`)}rect(t,e,n,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${n=+n}v${+r}h${-n}Z`}toString(){return this._}}function ui(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(null==n)e=null;else{const t=Math.floor(n);if(!(t>=0))throw new RangeError(`invalid digits: ${n}`);e=t}return t},()=>new ci(e)}function si(t){return t[0]}function di(t){return t[1]}function fi(t,e){var n=ti(!0),r=null,a=ni,i=null,o=ui(l);function l(l){var c,u,s,d=(l=Ja(l)).length,f=!1;for(null==r&&(i=a(s=o())),c=0;c<=d;++c)!(c<d&&n(u=l[c],c,l))===f&&((f=!f)?i.lineStart():i.lineEnd()),f&&i.point(+t(u,c,l),+e(u,c,l));if(s)return i=null,s+""||null}return t="function"==typeof t?t:void 0===t?si:ti(t),e="function"==typeof e?e:void 0===e?di:ti(e),l.x=function(e){return arguments.length?(t="function"==typeof e?e:ti(+e),l):t},l.y=function(t){return arguments.length?(e="function"==typeof t?t:ti(+t),l):e},l.defined=function(t){return arguments.length?(n="function"==typeof t?t:ti(!!t),l):n},l.curve=function(t){return arguments.length?(a=t,null!=r&&(i=a(r)),l):a},l.context=function(t){return arguments.length?(null==t?r=i=null:i=a(r=t),l):r},l}function mi(t,e,n){var r=null,a=ti(!0),i=null,o=ni,l=null,c=ui(u);function u(u){var s,d,f,m,p,h=(u=Ja(u)).length,y=!1,g=new Array(h),v=new Array(h);for(null==i&&(l=o(p=c())),s=0;s<=h;++s){if(!(s<h&&a(m=u[s],s,u))===y)if(y=!y)d=s,l.areaStart(),l.lineStart();else{for(l.lineEnd(),l.lineStart(),f=s-1;f>=d;--f)l.point(g[f],v[f]);l.lineEnd(),l.areaEnd()}y&&(g[s]=+t(m,s,u),v[s]=+e(m,s,u),l.point(r?+r(m,s,u):g[s],n?+n(m,s,u):v[s]))}if(p)return l=null,p+""||null}function s(){return fi().defined(a).curve(o).context(i)}return t="function"==typeof t?t:void 0===t?si:ti(+t),e="function"==typeof e?e:ti(void 0===e?0:+e),n="function"==typeof n?n:void 0===n?di:ti(+n),u.x=function(e){return arguments.length?(t="function"==typeof e?e:ti(+e),r=null,u):t},u.x0=function(e){return arguments.length?(t="function"==typeof e?e:ti(+e),u):t},u.x1=function(t){return arguments.length?(r=null==t?null:"function"==typeof t?t:ti(+t),u):r},u.y=function(t){return arguments.length?(e="function"==typeof t?t:ti(+t),n=null,u):e},u.y0=function(t){return arguments.length?(e="function"==typeof t?t:ti(+t),u):e},u.y1=function(t){return arguments.length?(n=null==t?null:"function"==typeof t?t:ti(+t),u):n},u.lineX0=u.lineY0=function(){return s().x(t).y(e)},u.lineY1=function(){return s().x(t).y(n)},u.lineX1=function(){return s().x(r).y(e)},u.defined=function(t){return arguments.length?(a="function"==typeof t?t:ti(!!t),u):a},u.curve=function(t){return arguments.length?(o=t,null!=i&&(l=o(i)),u):o},u.context=function(t){return arguments.length?(null==t?i=l=null:l=o(i=t),u):i},u}function pi(t){return t<0?-1:1}function hi(t,e,n){var r=t._x1-t._x0,a=e-t._x1,i=(t._y1-t._y0)/(r||a<0&&-0),o=(n-t._y1)/(a||r<0&&-0),l=(i*a+o*r)/(r+a);return(pi(i)+pi(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(l))||0}function yi(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function gi(t,e,n){var r=t._x0,a=t._y0,i=t._x1,o=t._y1,l=(i-r)/3;t._context.bezierCurveTo(r+l,a+l*e,i-l,o-l*n,i,o)}function vi(t){this._context=t}function Ei(t){this._context=t}function Ii(t){return new vi(t)}function bi(t,e,n){this.k=t,this.x=e,this.y=n}function _i(t){return _i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_i(t)}function Ai(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Si(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ai(Object(n),!0).forEach(function(e){Ti(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ai(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function Ti(t,e,n){return(e=function(t){var e=function(t){if("object"!=_i(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=_i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==_i(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}vi.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:gi(this,this._t0,yi(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){var n=NaN;if(e=+e,(t=+t)!==this._x1||e!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3,gi(this,yi(this,n=hi(this,t,e)),n);break;default:gi(this,this._t0,n=hi(this,t,e))}this._x0=this._x1,this._x1=t,this._y0=this._y1,this._y1=e,this._t0=n}}},(function(t){this._context=new Ei(t)}.prototype=Object.create(vi.prototype)).point=function(t,e){vi.prototype.point.call(this,e,t)},Ei.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,r,a,i){this._context.bezierCurveTo(e,t,r,n,i,a)}},bi.prototype={constructor:bi,scale:function(t){return 1===t?this:new bi(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new bi(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}},new bi(1,0,0),bi.prototype,mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Ci=function(t,e,n,r){var a=t.xScale,i=t.yScale,o=fi().curve(Ii).x(function(t){return a(t.index)}).y(function(t){return i(t.value)});e.append("path").datum(n).attr("fill","none").attr("stroke",r).attr("stroke-width",.75).attr("d",o)},Mi=function(t,e,n){t.attr("width",0).transition().duration(n).attr("width",e)},Ni=function(t,e,n,a){var i=e.xScale,o=e.yScale,l=t.append("circle").attr("class","trend-graph__tooltip-marker").attr("fill",r);return{tooltipHandler:function(t){var e,r=t.detail,c=r.evt,u=r.returnObject,s=c.e.offsetX||c.layerX||0,d=Math.round(i.invert(s));parseFloat(l.attr("cx"))!==i(d)&&l.attr("cx",i(d)).attr("cy",o(n[d].value)).attr("r",0).transition().duration(300).attr("r",5),u.graphicModel=null===(e=a[d])||void 0===e?void 0:e.graphicModel},resetHighlight:function(){l.transition().duration(0).attr("r",0)}}};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Oi=function(t,e,n,r){var a=e.xBarScale,i=t.selectAll(".trend__bar"),o=a.step();return{tooltipHandler:function(t){var e,a,l,c,u=t.detail,s=u.evt,d=u.returnObject,f=(c=(null===(l=(a=s).e)||void 0===l?void 0:l.offsetX)||a.layerX,Math.floor(c/o));i.attr("fill-opacity",n),$r(i.nodes()[f]).attr("fill-opacity",.4*n),d.graphicModel=null===(e=r[f])||void 0===e?void 0:e.graphicModel},resetHighlight:function(){i.attr("fill-opacity",n)}}};function wi(t){return function(t){if(Array.isArray(t))return Di(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Di(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Di(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Di(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var xi=A.TREND_SHAPE,Li=xi.LINE,ji=xi.AREA,Pi=xi.BAR;var Ri=function(t,e,n,r,a,i,o){var l=t.cardDimensions,c=l.cardWidth,u=l.cardHeight,s=o.minValue,d=o.maxValue,f=(n?24:28)/100,m=Math.min(.08*Math.min(c,u),30),p=r/100,h=(u-2*m-2)*f,y=a===Pi?.01*h:5,g=c-2*m-2,v=null!=i&&i.value?Math.min(s,i.value):s,E=function(t,e,n,r,a,i){var o=Qa().domain([0,t.length-1]).range([0,e]),l=Qa().domain([n,r>=0?r:0]).range([a-i,i]),c=fa().domain(t.map(function(t,e){return e})).range([0,e]).padding(.1).align(.5);return{xScale:o,yScale:l,xBarScale:c,heightScale:function(t){return Math.abs(l(0)-l(t))},barYScale:function(t){return l(t>=0?t:0)}}}(e,g,v,null!=i&&i.value?Math.max(d,i.value):d,h,y);return{scales:E,graphData:e.map(function(t,e){return{index:e,value:t.raw}}),trendFillOpacityFraction:p,trendWidth:g,scaledMinValue:v,trendVerticalMargin:y,SVGHeight:h}};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Vi=function(t,e,n,r){var a=t.sourceEvent||t;if(!e.isAndroid||!a.target.classList.contains("trend__body")){Yi(e);var i=e.selectedCardsGraphicModels;if(e.clearSelections(),e.isIOS&&(e.handleContextMenuSelection(a),e.trendSVGs.forEach(function(t){return t.dispatch("mouseout")})),i=Ui(a,i,n),e.selectedCardsGraphicModels=i,Ki(e),"A"===(null==r?void 0:r.tagName)&&window.open(r.href,"_blank"),i.length>0){var o=l(e.KPIType),c=K(e,o.TREND),u=K(e,o.BREAK_BY);(c||u)&&Fi(e,i)}else ki(e,n)}},Fi=function(t,e){t.isIOS?e.forEach(function(t){var e=t.getSelector();e.messageType="selection",window.webkit.messageHandlers.selectionDataJSONString.postMessage(e)}):t.applySelection(e.map(function(t){return t.getSelector()}))},ki=function(t,e){if(t.isIOS){var n=e.getSelector();n.messageType="deselection",window.webkit.messageHandlers.selectionDataJSONString.postMessage(n)}else t.clearSelections(),t.endSelections()},Bi=function(t){var e=t.cardId;return document.getElementById(mstrmojo.string.encodeHtmlString(e))},zi=function(t){null==t||t.classList.remove("card--selected"),null==t||t.classList.remove("card--unselected"),null==t||t.classList.remove("card--selected-no-hover")},Ui=function(t,e,n){var r=e.map(function(t){return t.cardId}),a=r.indexOf(n.cardId);if(!0===t.ctrlKey||!0===t.metaKey)-1!==a?e.splice(a,1):e.push(n);else{var i=-1===a||r.length>1&&-1!==a;e.length=0,i&&e.push(n)}return e},Ki=function(t,e){var n=t.selectedCardsGraphicModels,r=t.isSingleCardDisplayed;if(null!=e&&e.length&&(n=e),t.getGraphicModels().forEach(function(t){var e=Bi(t);r?null==e||e.classList.add("card--no-hover"):null==e||e.classList.remove("card--no-hover")}),0!==n.length){var a=n.map(function(t){return t.cardId});t.getGraphicModels().forEach(function(t){var e=Bi(t);a.includes(t.cardId)?null!=e&&e.classList.contains("card--selected-context-menu")||function(t,e){null==t||t.classList.add(e?"card--selected-no-hover":"card--selected"),null==t||t.classList.remove("card--unselected")}(e,r):function(t,e){null==t||t.classList.remove("card--selected"),e||null==t||t.classList.add("card--unselected")}(e,r)})}else t.getGraphicModels().forEach(function(t){var e=Bi(t);zi(e)})},Yi=function(t){t.contextMenuCardsGraphicModels.forEach(function(t){var e=Bi(t);null==e||e.classList.remove("card--selected-context-menu")}),t.contextMenuCardsGraphicModels=[]};function Hi(t){return function(t){if(Array.isArray(t))return Gi(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Gi(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gi(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Wi=function(t,e){return{tag:"button",content:"",classes:["controls__dot-indicator"],style:{color:e},otherAttributes:{id:t}}},$i=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return{tag:"button",classes:["controls__".concat(t,"-arrow")].concat(Hi(n),Hi(r)),content:e}};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Xi="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjMiIGhlaWdodD0iMjMiIHZpZXdCb3g9IjAgMCAyMyAyMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3QgeD0iMS44NjEzNyIgeT0iMS41ODA3MyIgd2lkdGg9IjE5Ljg0IiBoZWlnaHQ9IjE5Ljg0IiByeD0iMi44OCIgc3Ryb2tlPSIjQTlBREIxIiBzdHJva2Utd2lkdGg9IjEuOTIiLz4KPHBhdGggZD0iTTE1Ljg1NDcgMTAuMDMzOEMxNi42MzA4IDkuNDA0ODIgMTcuNzQxNSA5LjQzMzU5IDE4LjQ4NDQgMTAuMTAyNEwyMi42NjE0IDEzLjg2NDFWMTguNTQwN0MyMi42NjE0IDIwLjY2MTUgMjAuOTQyMSAyMi4zODA3IDE4LjgyMTQgMjIuMzgwN0g0Ljc0MTM3QzIuNjIwNTkgMjIuMzgwNyAwLjkwMTM2NyAyMC42NjE1IDAuOTAxMzY3IDE4LjU0MDdWMTYuNjIwOEw0LjgyMDY2IDEzLjE0ODNDNS40MTExNSAxMi42MjUyIDYuMjQ1NzcgMTIuNDkxMSA2Ljk2NjkxIDEyLjgwMzlMOC42NTQ5NiAxMy41MzcyQzkuODA3NzQgMTQuMDM3NiAxMS4xMzk0IDEzLjg1NDYgMTIuMTE4NyAxMy4wNjA5TDE1Ljg1NDcgMTAuMDMzOFoiIGZpbGw9IiNBOUFEQjEiLz4KPGNpcmNsZSBjeD0iNy4zMDA4NiIgY3k9IjYuMzgwNzQiIHI9IjEuOTIiIGZpbGw9IiNBOUFEQjEiLz4KPC9zdmc+Cg==";mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var qi=function(t,e){var n=jt({tag:"div",classes:["trend-indicator__icon-wrapper"]}),r=jt({tag:"div",classes:["trend-indicator__icon"]});return r.style.maskImage="url(".concat(1===e?"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTMiIHZpZXdCb3g9IjAgMCAxMiAxMyIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0xMS4yMTE3IDMuNzAxNThDMTEuMTYxMiAzLjU3OTA4IDExLjA2MzcgMy40ODE1OCAxMC45NDEyIDMuNDMxMDhDMTAuODgwMiAzLjQwNTU4IDEwLjgxNTIgMy4zOTI1OCAxMC43NTAyIDMuMzkyNThIOC4yOTU3QzguMDE5MiAzLjM5MjU4IDcuNzk1NyAzLjYxNjA4IDcuNzk1NyAzLjg5MjU4QzcuNzk1NyA0LjE2OTA4IDguMDE5MiA0LjM5MjU4IDguMjk1NyA0LjM5MjU4SDkuNTQyN0w2Ljg2MzcgNy4wNzA1Nkw1LjE3MjIgNS4zNzg1NkM0Ljk4NDY5IDUuMTkxMDggNC42NTMxOSA1LjE5MTA4IDQuNDY1MTkgNS4zNzg1NkwxLjM5NjE5IDguNDQ5MDZDMS4yMDExOSA4LjY0NDU2IDEuMjAxMTkgOC45NjEwNiAxLjM5NjY5IDkuMTU2MDZDMS40OTQxOSA5LjI1MzU2IDEuNjIyMTkgOS4zMDI1NiAxLjc1MDE5IDkuMzAyNTZDMS44NzgxOSA5LjMwMjU2IDIuMDA2MTkgOS4yNTM1NiAyLjEwMzY5IDkuMTU2MDZMNC44MTg2OSA2LjQzOTU2TDYuNTA5NyA4LjEzMTA2QzYuNzA1MiA4LjMyNjU2IDcuMDIxNyA4LjMyNjU2IDcuMjE3MiA4LjEzMTA2TDEwLjI1MDIgNS4wOTkwOFY2LjM0NzU2QzEwLjI1MDIgNi42MjQwNiAxMC40NzM3IDYuODQ3NTYgMTAuNzUwMiA2Ljg0NzU2QzExLjAyNjcgNi44NDc1NiAxMS4yNTAyIDYuNjI0MDYgMTEuMjUwMiA2LjM0NzU2VjMuODkyNThDMTEuMjUwMiAzLjgyNzU4IDExLjIzNjcgMy43NjI1OCAxMS4yMTE3IDMuNzAxNThaIiBmaWxsPSIjMjBBNzZDIi8+Cjwvc3ZnPgo=":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI1IiB2aWV3Qm94PSIwIDAgOCA1IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTcuMDU1NTggNC4wMzk3OUM3LjAyMjUzIDQuMTE5OTYgNi45NTg3MyA0LjE4Mzc2IDYuODc4NTYgNC4yMTY4MUM2LjgzODY0IDQuMjMzNSA2Ljc5NjExIDQuMjQyIDYuNzUzNTcgNC4yNDJINS4xNDczNEM0Ljk2NjQgNC4yNDIgNC44MjAxNCA0LjA5NTc1IDQuODIwMTQgMy45MTQ4QzQuODIwMTQgMy43MzM4NiA0Ljk2NjQgMy41ODc2IDUuMTQ3MzQgMy41ODc2SDUuOTYzMzhMNC4yMTAyNCAxLjgzNTEzTDMuMTAzMzIgMi45NDIzN0MyLjk4MDYxIDMuMDY1MDYgMi43NjM2NyAzLjA2NTA2IDIuNjQwNjUgMi45NDIzN0wwLjYzMjI4NyAwLjkzMzAzM0MwLjUwNDY3OCAwLjgwNTA5NyAwLjUwNDY3OCAwLjU5Nzk3OSAwLjYzMjYxNCAwLjQ3MDM3MUMwLjY5NjQxOCAwLjQwNjU2NiAwLjc4MDE4MSAwLjM3NDUwMSAwLjg2Mzk0NSAwLjM3NDUwMUMwLjk0NzcwOCAwLjM3NDUwMSAxLjAzMTQ3IDAuNDA2NTY2IDEuMDk1MjggMC40NzAzNzFMMi44NzE5OCAyLjI0ODA1TDMuOTc4NTggMS4xNDExM0M0LjEwNjUxIDEuMDEzMiA0LjMxMzYzIDEuMDEzMiA0LjQ0MTU3IDEuMTQxMTNMNi40MjYzNyAzLjEyNTI3VjIuMzA4MjZDNi40MjYzNyAyLjEyNzMyIDYuNTcyNjMgMS45ODEwNiA2Ljc1MzU3IDEuOTgxMDZDNi45MzQ1MSAxLjk4MTA2IDcuMDgwNzcgMi4xMjczMiA3LjA4MDc3IDIuMzA4MjZWMy45MTQ4QzcuMDgwNzcgMy45NTczNCA3LjA3MTk0IDMuOTk5ODggNy4wNTU1OCA0LjAzOTc5WiIgZmlsbD0iI0Q5MjMyRSIvPgo8L3N2Zz4K",")"),r.style.maskSize="100%",r.style.maskRepeat="no-repeat",r.style.maskPosition="center",r.style.maskColor=t,r.style.background=t,n.appendChild(r),n.outerHTML},Zi=function(t,e,n,r){var a,i=e.trendIncreaseBackgroundColor,o=e.trendDecreaseBackgroundColor,l=e.trendConstantBackgroundColor,u=e.trendIndicatorShape,s=e.trendIndicatorValueType,d=A.TREND_INDICATOR_SHAPE.BADGE,f=A.TREND_INDICATOR_VALUE_TYPE.NUMERIC,m=null===(a=r[5])||void 0===a?void 0:a.color;return 0===t?{indicatorColor:null!=m?m:l,valueSign:"",arrowType:null}:t<0?{indicatorColor:null!=m?m:o,valueSign:n===c||s===f?"":"-",arrowType:-1}:{indicatorColor:null!=m?m:i,valueSign:n===c||u!==d?"":"+",arrowType:1}};function Qi(t){return Qi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qi(t)}function Ji(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function to(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ji(Object(n),!0).forEach(function(e){eo(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ji(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function eo(t,e,n){return(e=function(t){var e=function(t){if("object"!=Qi(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Qi(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Qi(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function no(t){return no="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},no(t)}function ro(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ao(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ro(Object(n),!0).forEach(function(e){io(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ro(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function io(t,e,n){return(e=function(t){var e=function(t){if("object"!=no(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=no(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==no(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var oo=function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000000",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,i=document.createElement("div");i.classList.add("card__img-wrapper");var o=document.createElement("div");o.classList.add("card__img-container"),i.appendChild(o);var l=document.createElement("div");l.classList.add("icon-img");var c,u,s=t||Xi;return u=s,nt.test(u)?s="".concat(mstrmojo.getStyleRoot(),"/..").concat(s):null!==(e=s)&&void 0!==e&&e.startsWith("http")||(c=s)&&(c.startsWith("data:image/svg+xml;base64,")||c.startsWith("data:image/png;base64,")||c.startsWith("data:image/jpeg;base64,")||c.startsWith("data:image/gif;base64,")||c.startsWith("data:image/webp;base64,")||c.startsWith("data:image/bmp;base64,"))||(s="".concat(mstrmojo.getStyleRoot(),"/../images/material-symbols/400/rounded/").concat(s)),function(t){return!!t&&(t.endsWith(".svg")||function(t){if(!t)return!1;if(t.endsWith(".svg"))return!0;if(t.startsWith("data:image/svg+xml;base64,"))return!0;if(t.match(/^data:image\/(jpeg|jpg|png|gif|webp|bmp);base64,/))return!1;try{var e=t.replace(/^data:image\/[^;]+;base64,/,""),n=atob(e).trim().toLowerCase();return n.startsWith("<svg")||n.includes("<svg")}catch(t){return!1}}(t))}(s)?(l.style.maskImage="url(".concat(s,")"),l.style.maskSize="contain",l.style.maskRepeat="no-repeat",l.style.maskPosition="center",l.style.backgroundColor=s===Xi?et(a,100):et(n,r)):(l.style.background="url(".concat(s,")"),l.style.backgroundSize="contain",l.style.backgroundRepeat="no-repeat",l.style.backgroundPosition="center"),o.appendChild(l),i},lo=function(t,e,n,r){var a,i,o,l,c,s,d,f,m,p,h,y,g,v,E=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],I=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],b=arguments.length>6?arguments[6]:void 0,_=arguments.length>7?arguments[7]:void 0,S=e.isComparisonKPI,T=e.isRealTime,C=e.cardProperties,M=t.secondaryValue,N=t.indicator,O=t.trend,w=t.trendChartData,D=t.graphicModel,x=t.referenceLine,L=t.thresholdTarget,j=t.trendAttributeFormType,P=t.metricFormType,R=n.secondaryValueFontOptions,V=n.trendIndicatorEnabled,F=n.comparisonIndicatorEnabled,k=C.cssModifiers,B=C.isTrendIndicatorOnTop,z=C.showSecondaryValue,U=C.isComparisonMetricAdded,K=D.cardId,Y=[];if(M&&z&&E)if(i=function(t,e,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0,c=t.label,u=t.value;a&&(u+="");var s=c?"".concat(c,": ").concat(u):u,d=H(n,r,l,"SECONDARY_VALUE"),f=jt(function(t,e,n,r){var a=n.cardElementsModifier,i=n.indicatorPosition,o=n.cardAlignment,l=n.cardDirection;return r[4]&&(t.color=r[4].color),{classes:["card__secondary-value","card__secondary-value--".concat(a),"card__secondary-value--".concat(i),"card__secondary-value--".concat(o),"card__secondary-value--".concat(l)],content:e,style:t}}(d,s,e,i),!0,o);return f.secondaryValueData={labelTitle:c,labelValue:u,wholeLabel:s,shouldSanitizeSecondaryValue:o},f}(M,k,R,e,U,L,j===(null!==(m=null===(p=mstrmojo)||void 0===p||null===(h=p.chart)||void 0===h||null===(y=h.model)||void 0===y||null===(g=y.enums)||void 0===g||null===(v=g.EnumDSSBaseFormType)||void 0===v?void 0:v.DssBaseFormHTMLTag)&&void 0!==m?m:7)||void 0!==P,b),e.components.cardSecondaryValues.push(i),T&&(e.parsedData[r].secondaryValueComponentIndex=e.components.cardSecondaryValues.length-1,e.isSecondaryLabelUpdated=!0),U){var G=jt((s=(c=k).cardAlignment,d=c.cardDirection,{tag:"div",classes:["card__secondary-value-with-indicator-wrapper","card__secondary-value-with-indicator-wrapper--".concat(s),"card__secondary-value-with-indicator-wrapper--".concat(d)]}));G.append(i),Y.push(G),e.components.cardSecondaryValueWithIndicatorWrappers.push(G),F&&(l=function(t,e,n,r){var a=e.indicatorFontOptions,i=e.trendIndicatorValueType,o=t.differenceBetweenPrimaryAndSecondary,l=t[i],c=Zi(o,e,l,r),u=c.indicatorColor,s=c.valueSign,d=H(a,n),f=jt(function(t,e){return{tag:"div",classes:["card__comparison-indicator"],content:e,style:t}}(to(to({},d),{},{color:u}),i===A.TREND_INDICATOR_VALUE_TYPE.PERCENT?"(".concat(s).concat(l,")"):"".concat(s).concat(l)));return f}(N,n,e,L),G.append(l),e.components.cardIndicators.push(l),e.cardComponentReferences[K].trendIndicator={cssModifiers:k,indicator:N})}else{var $=jt({tag:"div",classes:["secondary-value-indicator-wrapper"]});if($.appendChild(i),V){o=function(t,e,n,r,a,i){var o,l=n.trendIndicatorValueType,c=(n.trendIndicatorShape,n.indicatorFontOptions),u=(A.TREND_INDICATOR_VALUE_TYPE.NUMERIC,e.differenceBetweenPrimaryAndSecondary),s=mstrmojo.string.encodeHtmlString(e[l]),d=s,f=Zi(u,n,d,{}),m=f.arrowType,p=f.indicatorColor,h=(f.valueSign,H(c,r,i,"TREND_INDICATOR")),y=null===(o=a[8])||void 0===o?void 0:o.color,g=m?qi(p,m):"",v="".concat(g,' <span class="trend-indicator__value---with-icon">').concat(s,"</span>");return h.color=null!=y?y:p,h.background=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=t.trim().replace(/^#/,""),r=3===n.length?n.split("").map(function(t){return t+t}).join(""):n.slice(0,6),a=parseInt(r.slice(0,2),16),i=parseInt(r.slice(2,4),16),o=parseInt(r.slice(4,6),16),l=e,c=function(t){return Math.round(255*(1-l)+l*t)},u=c(a),s=c(i),d=c(o);return"#".concat(u.toString(16).padStart(2,"0")).concat(s.toString(16).padStart(2,"0")).concat(d.toString(16).padStart(2,"0")).toUpperCase()}(p),jt(function(t,e,n,r,a){var i=e.indicatorPosition,o=e.cardElementsModifier,l=e.cardAlignment,c=e.cardDirection;return a[5]&&(t.color=a[5].color),{classes:["card__trend-indicator","card__trend-indicator--".concat(o),"card__trend-indicator--".concat(i),"card__trend-indicator--".concat(l),"card__trend-indicator--".concat(c)],content:r,style:t,otherAttributes:{title:n}}}(h,t,d,v,a),!1)}(k,N,n,e,L,b);var q="horizontal-card"===k.cardDirection;B&&!q?e.cardComponentReferences[K].cardBody.append(o):$.appendChild(o),e.components.cardIndicators.push(o),T&&(e.parsedData[r].trendIndicatorComponentIndex=e.components.cardIndicators-1),e.cardComponentReferences[K].trendIndicator={cssModifiers:k,indicator:N}}Y.push($)}if(!_&&M&&O&&I){f=jt(function(t){var e=t.indicatorPosition,n=t.cardDirection;return{classes:["card__trend-graph","card__trend-graph--".concat(e),"card__trend-graph--".concat(n)]}}(k));var Z=function(t,e,n,r,a,i,o,l){var c,s=n.minValue,d=n.maxValue,f=i.trendShape,m=i.trendFillColor,p=i.trendFillOpacity;l[6]&&(m=l[6].color,p=null!==(c=l[6].opacity)&&void 0!==c?c:100);var h,y=Ri(o,e,r,p,f,a,{minValue:s,maxValue:d}),g=y.scales,v=y.graphData,E=y.trendFillOpacityFraction,I=y.trendWidth,b=y.scaledMinValue,_=y.trendVerticalMargin,S=y.SVGHeight,T=$r(t).append("svg");switch(T.attr("width",I).attr("height",S),f){case Li:Ci(g,T,v,W(m,p)),Mi(T,I,o.animationDuration),h=Ni(T,g,v,e);break;case ji:!function(t,e,n,r,a,i,o){var l=t.xScale,c=t.yScale,u="area-gradient-".concat(Math.random().toString(36).substring(7)),s=e.append("defs").append("linearGradient").attr("id",u).attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");s.append("stop").attr("offset","0%").attr("stop-color",r).attr("stop-opacity",a),s.append("stop").attr("offset","100%").attr("stop-color",r).attr("stop-opacity","0");var d=mi().curve(Ii).x(function(t){return l(t.index)}).y1(function(t){return c(t.value)}).y0(i>=0?c(i)+o:c(0));e.append("path").datum(n).attr("fill","url(#".concat(u,")")).attr("stroke","none").attr("d",d)}(g,T,v,m,E,b,_),Ci(g,T,v,m),Mi(T,I,o.animationDuration),h=Ni(T,g,v,e);break;case Pi:!function(t,e,n,r,a,i){var o=e.xBarScale,l=e.heightScale,c=e.barYScale;t.selectAll("bars").data(n).enter().append("rect").attr("class","trend__bar").attr("x",function(t){return o(t.index)}).attr("y",function(){return c(0)}).attr("width",o.bandwidth()).attr("fill",r).attr("fill-opacity",a).attr("stroke",r).attr("stroke-width",1.5).attr("height",0).transition().duration(i).attr("y",function(t){return c(t.value)}).attr("height",function(t){return l(t.value)})}(T,g,v,m,E,o.animationDuration),h=Oi(T,g,E,e)}a&&function(t,e,n,r,a){var i,o=t.line,l=o.color,c=o.shape,s=t.value,d=t.formattedValue,f=t.label,m=t.font,p=H(m,a),h=e.yScale,y=A.SELECTED_REFERENCE_LINE_SHAPE,g=c===y.THICK_LINE_TYPE?2:1;switch(c){case y.DOTTED_LINE_TYPE:i="1 1";break;case y.DASHED_LINE_TYPE:i="3 3";break;case y.THIN_LINE_TYPE:case y.THICK_LINE_TYPE:i="1 0"}n.append("line").attr("stroke",l).attr("x1",0).attr("x2",r).attr("y1",h(s)).attr("y2",h(s)).attr("stroke-width",g).attr("stroke-dasharray",i);var v=f?"".concat(f," ").concat(d):d,E=mstrmojo.VisUtility.measureTextWidth(v+u,Si(Si({},p),{},{lineHeight:1})),I=parseFloat(p.fontSize),b=n.append("text").attr("x",Math.max(r-E-2,2)).attr("y",h(s)-4-I>0?h(s)-4:h(s)+4+I);b.attr("class","card__reference-line-label").text(v).attr("font-family",p.fontFamily).attr("fill",p.color).attr("font-weight",p.fontWeight).attr("font-style",p.fontStyle).attr("text-decoration",p.textDecoration).attr("font-size",p.fontSize);var _=document.createElement("span");if(E>r){var S=X({container:_,maxTextWidth:r-4,textData:{label:f,value:d,connector:" "},fontSize:parseInt(p.fontSize),fontStyle:p}).truncatedLabelWithValue;b.text(S)}_.remove()}(a,g,T,I,o),T.append("rect").attr("x",0).attr("y",0).attr("height",S).attr("width",I).style("fill","transparent").attr("class","trend__body");var C=h,M=C.tooltipHandler,N=C.resetHighlight;return T.on("tooltip",M).on("mouseout",function(){N(),o.tooltipInfo={isVisible:!1,isPositionFixed:!1,position:{},graphicModel:{}},o.hideTooltip(!1)}),T}(f,w,O,B,x,n,e,L);e.trendSVGs.push(Z),Y.push(f),T&&(e.parsedData[r].trendComponentIndex=e.trendSVGs.length-1)}var Q=jt("div");return Q.classList.add("overlay-fill"),e.isMobile||Q.classList.add("overlay-fill--not-mobile"),Y.push(Q),(a=e.cardComponentReferences[K].cardComponent).append.apply(a,Y),E&&(o=S&&U?l:o,e.cardComponentReferences[K]=ao(ao({},e.cardComponentReferences[K]),{},{cardSecondaryValue:i,cardIndicator:o})),I&&(e.cardComponentReferences[K]=ao(ao({},e.cardComponentReferences[K]),{},{cardTrendGraph:f,cardTrendGraphData:{trendChartData:[],trend:O,isTrendIndicatorOnTop:B,referenceLine:x,properties:n}})),e.cardComponentReferences[K].cardComponent};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var co="slider--sliding",uo="controls__dot-indicator--active",so="prev",fo="next",mo="arrow",po=["ArrowLeft","ArrowRight","Delete","Enter","Backspace","End","Home"],ho="small",yo="medium",go="large",vo="-dot-indicator";mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Eo=function(t){var e=t.sliderState,r=t.controlsLayout,a=t.vizHeight,i=t.cardWidth,o=t.cardsCount,l=t.elementRefs,c=t.properties,u=t.slideCard,s=1===c.cardStyle?n.LIGHT:n.NIGHT;return l.controlsContainer=jt({classes:["controls"]}),r===mo?function(t,e,n,r,a,i,o){var l=function(t){return t===fo?'<svg width="18" height="16" viewBox="0 0 18 16"><polygon id="Fill-3" fill="'.concat(i,'" points="5 16 13 9 5 2"></polygon></svg>'):'\n\t\t\t<svg width="18px" height="16px" viewBox="0 0 18 16"><polygon id="Fill-3" fill="'.concat(i,'" transform="translate(9.000000, 9.000000) scale(-1, 1) translate(-9.000000, -9.000000) " points="5 16 13 9 5 2"></polygon></svg>\n\t\t')},c=n<150||e<100?ho:n>300&&e>300?go:yo;c===go?a.controlsContainer.classList.add("controls--arrow-indicators"):a.controlsContainer.classList.add("controls--smaller");var u=["controls__arrow"];c!==go&&u.push("controls__arrow--smaller");var s=c===ho?["controls__prev-arrow--smaller"]:[];a.prevArrowControl=a.controlsContainer.appendChild(jt($i(so,l(so),u,s),!1)),c!==ho&&function(t,e,n,r,a,i){var o=function(t){var e=t.target,r=t.key,a=e.textContent,i=n.toString().length;"ENTER"===r?e.blur():a.length>i&&(e.textContent=a.substring(0,i))},l=t.activeCardIndex,c=["controls__text-indicators"];e===yo&&c.push("controls__text-indicators--smaller"),r.textIndicator=r.controlsContainer.appendChild(jt({classes:c,style:{color:a}})),r.activeCardTextIndicator=r.textIndicator.appendChild(jt({classes:["controls__active-card"],content:l,style:{borderBottom:"1px solid ".concat(a)},otherAttributes:{contentEditable:""}})),r.activeCardTextIndicator.addEventListener("keydown",function(e){var n=t.sliding,r=e.key,a=e.shiftKey;isNaN(parseInt(r))&&!po.includes(r)||a||n?e.preventDefault():o(e)}),r.activeCardTextIndicator.addEventListener("keyup",o),r.activeCardTextIndicator.addEventListener("blur",function(e){var r=t.activeCardIndex,a=e.target,o=parseInt(a.textContent);o>n?a.textContent=r:i(o)}),r.textIndicator.appendChild(jt({classes:["controls__slash"],content:"/"})),r.textIndicator.appendChild(jt({classes:["controls__total-cards"],content:n}))}(t,c,r,a,i,o),a.nextArrowControl=a.controlsContainer.appendChild(jt($i(fo,l(fo),u),!1)),a.prevArrowControl.addEventListener("click",function(){return o(t.activeCardIndex-1)}),a.nextArrowControl.addEventListener("click",function(){return o(t.activeCardIndex+1)})}(e,a,i,o,l,s,u):function(t,e,n,r,a){var i=A.FIRST_CARD_INDEX,o=t.activeCardIndex;n.controlsContainer.classList.add("controls--dot-indicators");for(var l=i;l<=e;l++){var c="".concat(l).concat(vo),u=n.controlsContainer.appendChild(jt(Wi(c,r)));l===o&&u.classList.add(uo)}n.controlsContainer.addEventListener("click",function(e){var n=t.activeCardIndex,r=e.target;if(r.classList.contains("controls__dot-indicator")){var i=parseInt(r.id);if(i===n)return;a(i)}})}(e,o,l,s,u),l.controlsContainer};function Io(t){return Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Io(t)}function bo(t,e,n){return(e=function(t){var e=function(t){if("object"!=Io(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Io(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Io(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var _o={CARD_LABELS:"cardLabels",CARD_PRIMARY_VALUES:"cardPrimaryValues",CARD_SECONDARY_VALUES:"cardSecondaryValues",CARD_BODIES:"cardBodies",CARD_INDICATORS:"cardIndicators",CARD_SECONDARY_VALUE_WITH_INDICATOR_WRAPPERS:"cardSecondaryValueWithIndicatorWrappers"},Ao=bo(bo(bo(bo({},_o.CARD_LABELS,"labelFontOptions"),_o.CARD_PRIMARY_VALUES,"primaryValueFontOptions"),_o.CARD_SECONDARY_VALUES,"secondaryValueFontOptions"),_o.CARD_INDICATORS,"indicatorFontOptions");function So(t){return So="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},So(t)}function To(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Co(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function Mo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Co(Object(n),!0).forEach(function(e){No(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Co(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function No(t,e,n){return(e=function(t){var e=function(t){if("object"!=So(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=So(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==So(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}_o.CARD_LABELS,_o.CARD_PRIMARY_VALUES,_o.CARD_SECONDARY_VALUES,_o.CARD_INDICATORS,mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Oo=function(t,e,n,r,a,i){var o=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=u.sliding,a=u.activeCardIndex,o=i.intervalAutoPlayId;r||e===a||(!n&&o&&(clearInterval(o),i.intervalAutoPlayId=null),u.sliding=!0,u.activeCardIndex=e,s.slider.classList.add(co),s.slider.style.transform="translate(-".concat(t*e,"px)"))},l=function(){i.intervalAutoPlayId=setInterval(function(){var t=i.tooltipInfo,e=i.autoPlayEnabled,n=u.sliding;!e||n||t.isVisible||o(u.activeCardIndex+1,!0)},3400)},c=a.activeCardIndex,u={activeCardIndex:i.activeCardIndex||c,sliding:!1},s={vizContainer:null,slider:null,clonedFirstCard:null,clonedLastCard:null,controlsContainer:null,prevArrowControl:null,nextArrowControl:null,textIndicator:null,activeCardTextIndicator:null};u.activeCardIndex>n&&(u.activeCardIndex=n);var d=30*n>t?mo:"dot";return a.stackedAutoPlay&&l(),s.vizContainer=jt({tag:"div",classes:["stacked-container"],style:{width:"".concat(t,"px")}}),s.vizContainer.append(function(t,e,n,r,a,i,o){var l,c,u,s,d=A.FIRST_CARD_INDEX,f=30*r>n?mo:"dot",m=function(){var i=t.activeCardIndex;e.slider.classList.remove(co),0===i?(i=r,e.slider.style.transform="translate(-".concat(n*i,"px)")):i===a.length+1&&(i=d,e.slider.style.transform="translate(-".concat(n*i,"px)")),t.activeCardIndex=i},p=function(){var n=t.activeCardIndex,r=e.activeCardTextIndicator;r&&(r.innerHTML="".concat(n))},h=function(){var n=t.activeCardIndex;e.controlsContainer.querySelector(".".concat(uo)).classList.remove(uo),document.getElementById("".concat(n).concat(vo)).classList.add(uo)},y=function(t,e){[{selector:".card__label",componentPropertyName:_o.CARD_LABELS},{selector:".card__primary-value",componentPropertyName:_o.CARD_PRIMARY_VALUES},{selector:".card__body",componentPropertyName:_o.CARD_BODIES},{selector:".card__trend-indicator",componentPropertyName:_o.CARD_INDICATORS},{selector:".card__secondary-value",componentPropertyName:_o.CARD_SECONDARY_VALUES}].forEach(function(n){var r=n.selector,a=n.componentPropertyName,o=t.querySelector(r);if(o){if(a===_o.CARD_SECONDARY_VALUES){var l=i.components[a][e].secondaryValueData;o.secondaryValueData=l}i.components[a].push(o)}})};return c=t.activeCardIndex,u=n*(r+2),e.slider=e.vizContainer.appendChild(jt({tag:"section",classes:["slider"],style:{width:"".concat(u,"px")}})),e.clonedFirstCard=a[0].cloneNode(!0),y(e.clonedFirstCard,0),e.clonedLastCard=a[a.length-1].cloneNode(!0),y(e.clonedLastCard,a.length-1),(l=e.slider).append.apply(l,function(t){if(Array.isArray(t))return To(t)}(s=a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(s)||function(t,e){if(t){if("string"==typeof t)return To(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?To(t,e):void 0}}(s)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e.slider.insertAdjacentElement("afterbegin",e.clonedLastCard),e.slider.append(e.clonedFirstCard),e.slider.addEventListener("transitionend",function(){var e=t.activeCardIndex,n=i.autoPlayEnabled,r=i.intervalAutoPlayId;t.sliding=!1,m(),f===mo?p():h(),i.activeCardIndex=e;var a=JSON.parse(i.getProperty(O));n||i.setProperty(O,JSON.stringify(Mo(Mo({},a),{},No({},T.ACTIVE_CARD_INDEX.name,e))),{suppressData:!0,clientUndoRedoCallback:function(){return i.refresh()}}),n&&!r&&o()}),e.slider.style.transform="translate(-".concat(n*c,"px)"),e.slider}(u,s,t,n,r,i,l)),s.vizContainer.append(Eo({sliderState:u,controlsLayout:d,vizHeight:e,cardWidth:t,cardsCount:n,elementRefs:s,properties:a,slideCard:o})),s.vizContainer};function wo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Do=function(t,e,n){var r=n.gridFixCardHeightEnabled,a=n.layoutType,i=n.cardAlignment,o=n.noTrendGraph,c=A.LAYOUT_TYPES,u=t.domNode,s=u.clientWidth,d=u.clientHeight,f=parseInt(a===c.GRID?4:0),E=e.length,I=xo(n,E),b=r?0:d,_=a===c.STACKED?s:s/I+f/I-f,S=Lo(n,d,E,I,f,t);t.gridFixCardHeight=S,t.cardDimensions={cardWidth:_,cardHeight:S};var T,C,M=t.isComparisonMetricAdded,N=M,O=l(t.KPIType),w=K(t,O.TREND),D=M||w,x={cssModifiers:(C=(T={isTrendIndicatorOnTop:N,showSecondaryValue:D,isTrendPopulatedInDropZone:w,cardAlignment:i,isComparisonMetricAdded:M,isCardVertical:w&&!o?d>s:d/s>2/3}).showSecondaryValue?"with-secondary":"no-trend",{cardAlignment:"left-alignment",cardElementsModifier:C=T.isTrendPopulatedInDropZone?"with-trend":C,indicatorPosition:T.isTrendIndicatorOnTop?"kpi-on-top":"kpi-on-bottom",comparisonIndicator:T.isComparisonMetricAdded?"with-comparison":"no-comparison",cardDirection:T.isCardVertical?"vertical-card":"horizontal-card"}),isTrendIndicatorOnTop:N,cardAlignment:i,showSecondaryValue:D,isComparisonMetricAdded:M,isStackedLayout:a===c.STACKED};t.cardProperties=x,t.cardComponentReferences={};var L,j,P,R=e.map(function(e,r){return function(t,e,n,r,a){var i,o,l,c,u,s,d,f,E,I,b,_=null!==(i=null===(o=mstrmojo)||void 0===o||null===(l=o.chart)||void 0===l||null===(c=l.model)||void 0===c||null===(u=c.enums)||void 0===u||null===(s=u.EnumDSSBaseFormType)||void 0===s?void 0:s.DssBaseFormHTMLTag)&&void 0!==i?i:7,A=t.label,S=t.primaryValue,T=t.graphicModel,C=t.thresholdTarget,M=t.breakByAttributeFormType,N=t.metricFormType,O=t.trend,w=e.showMetricName,D=e.primaryValueFontOptions,x=e.labelFontOptions,L=e.imageSrc,j=e.searchIcon,P=e.noTrendGraph,R=n.cardDimensions,V=R.cardWidth,F=R.cardHeight,k=n.cardProperties,B=k.cssModifiers,z=k.isStackedLayout,U=!O,K=mstrmojo.color.decodeColor(null==n||null===(d=n.model)||void 0===d||null===(f=d.docModel)||void 0===f||null===(E=f.plt)||void 0===E||null===(I=E.colors)||void 0===I?void 0:I[0]),Y=P||F<150,G=ao({},e);"AUTO"===G.imgFillColor&&(G.imgFillColor=K),"AUTO"===G.areaFillColor&&U&&(G.areaFillColor=K),"AUTO"===G.trendFillColor&&(G.trendFillColor=K);var $=oo(L||j,G.imgFillColor,G.imgFillOpacity),X=w?"<span class='card__label-text'>".concat(A.withMetricName,"</span>"):A.withoutMetricName,q=[],Z=T.cardId,Q=function(t,e,n,r){var a=["card"];return t?(e||(a.push(v),1===r&&a.push("card-horizontal-no-trend-single-card")),e&&!n&&a.push(y),e&&n&&a.push(g)):(e||a.push(h),e&&!n&&a.push(m),e&&n&&a.push(p)),a}("horizontal-card"===B.cardDirection,!U,Y,a),J=z?"".concat(V,"px"):"auto",tt=C[7]?W(C[7].color,null!==(b=C[7].opacity)&&void 0!==b?b:100):W(G.areaFillColor,G.areaFillOpacity),et=jt(function(t,e,n,r,a){return{tag:"article",classes:a,style:{height:e,width:n,background:t,boxSizing:"border-box"},otherAttributes:{id:r}}}(tt,"".concat(F,"px"),J,Z,Q));n.cardComponentReferences[Z]={},et.addEventListener("click",function(t){return Vi(t,n,T)});var nt,rt,at,it,ot,lt=H(x,n,Q[1],"LABEL"),ct=M?M===_:void 0!==N,ut=jt(function(t,e,n,r){var a=r.indicatorPosition,i=r.cardAlignment,o=r.cardElementsModifier,l=r.cardDirection;return n[2]&&(t.color=n[2].color),{tag:"header",classes:["card__label","card__label--".concat(i),"card__label--".concat(a),"card__label--".concat(o),"card__label--".concat(l)],content:e,style:t,otherAttributes:{title:e}}}(lt,X,C,B),!1,ct),st=jt((rt=(nt=B).indicatorPosition,at=nt.cardAlignment,it=nt.cardElementsModifier,ot=nt.cardDirection,{tag:"div",classes:["card__body","card__body--".concat(rt),"card__body--".concat(at),"card__body--".concat(it),"card__body--".concat(ot)],content:null})),dt=H(D,n,Q[1],"PRIMARY_VALUE"),ft=void 0!==N,mt=jt(function(t,e,n,r){var a=r.cardElementsModifier,i=r.comparisonIndicator,o=r.cardDirection;return e.color&&(t.color=e.color),n[3]&&(t.color=n[3].color),{classes:["card__primary-value","card__primary-value--".concat(a),"card__primary-value--".concat(i),"card__primary-value--".concat(o)],content:e.formatted,style:t,otherAttributes:{title:e.formatted}}}(dt,S,C,B),!0,ft);st.append(mt);var pt=jt("div");if(pt.appendChild(ut),pt.appendChild(st),pt.classList.add("card__label-body-wrapper"),n.components.cardBodies.push(st),n.components.cardLabels.push(ut),n.components.cardPrimaryValues.push(mt),U)q.push($),q.push(pt);else{var ht=jt({tag:"div",classes:["img-primary-label-wrapper"]});ht.appendChild($),ht.appendChild(pt),q.push(ht)}var yt=jt("div");yt.classList.add("overlay-fill"),n.isMobile||yt.classList.add("overlay-fill--not-mobile"),q.push(yt),et.append.apply(et,q),n.cardComponentReferences[Z]=ao(ao({},n.cardComponentReferences[Z]),{},{cardLabel:ut,cardPrimaryValue:mt,cardBody:st,cardComponent:et,cardImgWrapper:$}),lo(t,n,G,r,void 0,void 0,Q[1],Y),null!=t&&t.isCardOld&&et.classList.add("card--old-card");var gt=jt({tag:"div",classes:["card-wrapper"],style:{height:"".concat(F,"px"),width:J,backgroundColor:"#ffffff"}});return gt.appendChild(et),gt}(e,n,t,r,E)});if(a===c.STACKED&&E>1)L=Oo(_,d,E,R,n,t);else{var V,F=["container"];a===c.HORIZONTAL?F.push("container--horizontal"):a===c.VERTICAL&&F.push("container--vertical"),(V=L=jt((j=b,{tag:"section",classes:F,style:{gridTemplateColumns:"repeat(".concat(I,", 1fr)"),minHeight:"".concat(j,"px")}}))).append.apply(V,function(t){if(Array.isArray(t))return wo(t)}(P=R)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(P)||function(t,e){if(t){if("string"==typeof t)return wo(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wo(t,e):void 0}}(P)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}return L},xo=function(t,e){var n=t.gridColumnCount,r=t.layoutType,a=A.LAYOUT_TYPES;switch(r){case a.GRID:return Math.min(e,n);case a.HORIZONTAL:return e;case a.VERTICAL:return 1}},Lo=function(t,e,n,r,a,i){var o=A.LAYOUT_TYPES,l=t.gridFixCardHeight,c=t.gridFixCardHeightEnabled;switch(t.layoutType){case o.GRID:var u=Math.ceil(n/r);return c?l:Math.max((e-a*(u-1))/u,75);case o.HORIZONTAL:case o.STACKED:return e;case o.VERTICAL:return e/n-a*(n-1)/n}};function jo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Po(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Po(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Po(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Ro=function(t,e,n){var r=e.trendIndicatorShape,a=t.cardDimensions,i=t.components,o=t.isComparisonMetricAdded,l=_o.CARD_BODIES,c=_o.CARD_INDICATORS,u=(_o.CARD_SECONDARY_VALUES,_o.CARD_SECONDARY_VALUE_WITH_INDICATOR_WRAPPERS),s=i.cardBodies,d=i.cardSecondaryValueWithIndicatorWrappers;J(s,"height","100%"),J(s,"width","100%"),J(d,"height","100%");for(var f=function(){var n=jo(p[m],2),i=n[0],s=n[1];if([l,u].includes(i))return 0;if(!1===t.shouldFontBeChanged[i])return 0;var d=i===c;s.forEach(function(t){var n,l,u,s,f,m=d&&r===A.TREND_INDICATOR_SHAPE.ARROW&&null!==t.querySelector(".trend-indicator__icon");if(e[Ao[i]].fontSteps,i===c&&o){var p=t.closest(".card").querySelector(".card__secondary-value").offsetWidth,h=a.cardWidth,y=.16*h,g=Math.floor((l=(n={partialValue:h-p-y,totalValue:h}).partialValue,u=n.totalValue,100*Math.abs(l/u)));t.style.width="".concat(g,"%"),t.style.maxWidth="".concat(g,"%")}if(m){var v=t.querySelector(".trend-indicator__icon"),E=(s=t.style.fontSize,(f=parseInt(s)/Math.sqrt(2))+.1*f),I=parseInt(t.style.width);v.style.width="".concat(E,"px"),v.style.height="".concat(E,"px"),t.style.padding=0,t.style.textAlign="left",t.style.width="".concat(I+E,"px")}})},m=0,p=Object.entries(i);m<p.length;m++)f();J(s,"height","auto"),J(s,"width","84%"),J(d,"height","auto")},Vo=function(t){var e=t.cardDimensions,n=t.components,r=_o.CARD_BODIES,a=_o.CARD_SECONDARY_VALUE_WITH_INDICATOR_WRAPPERS,i=_o.CARD_PRIMARY_VALUES,o=_o.CARD_LABELS,l=n.cardBodies,c=n.cardSecondaryValueWithIndicatorWrappers;J(l,"height","100%"),J(l,"width","100%"),J(c,"height","100%");for(var u={},s={},d=function(){var n,l,c=jo(m[f],2),d=c[0],p=c[1];if([r,a].includes(d))return 0;var h=[];if(0===p.length)return 0;var y=P(p[0],"width",e),g=P(p[0],"height",e);if(s[d]={width:y,height:g},p.forEach(function(t){t.style.fontSize="".concat(t.style.fontSize,"px");var e=parseInt(t.style.fontSize),n=Z(t,e);h.push(n.width),l||(l=n.height)}),h.sort(function(t,e){return t-e}),void 0===t.shouldFontBeChanged[d]&&0!==t.shouldFontBeChanged.length)return 0;n=d===i?h[h.length-1]:d===o?h[Math.ceil(.75*h.length)-1]:h.reduce(function(t,e){return t+e},0)/h.length,u[d]={width:n,height:l}},f=0,m=Object.entries(n);f<m.length;f++)d();return J(l,"height","auto"),J(l,"width","84%"),J(c,"height","auto"),{dimensionsOfText:u,dimensionsOfContainer:s}};function Fo(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||Bo(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ko(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Bo(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,a=function(){};return{s:a,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,i=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw i}}}}function Bo(t,e){if(t){if("string"==typeof t)return zo(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zo(t,e):void 0}}function zo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Uo=function(t){var e,n=0,r=ko(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;n+=parseInt(a.style.fontSize)}}catch(t){r.e(t)}finally{r.f()}return n/t.length},Ko=function(t){return Math.min.apply(Math,function(t){if(Array.isArray(t))return zo(t)}(e=t.map(function(t){var e=t.style;return parseInt(e.fontSize)}))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||Bo(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());var e},Yo=function(t){var e=t.length,n=t.map(function(t){return t.textContent});n.sort(function(t,e){return t.length-e.length});var r=n[Math.ceil(.75*e)-1],a=t.find(function(t){return t.textContent===r});return parseInt(a.style.fontSize)},Ho=function(t,e){for(var n=t.components,r=_o.CARD_BODIES,a=_o.CARD_PRIMARY_VALUES,i=_o.CARD_LABELS,o=_o.CARD_INDICATORS,l=_o.CARD_SECONDARY_VALUES,c={},u=null,s=0,d=Object.entries(n);s<d.length;s++){var f=Fo(d[s],2),m=f[0],p=f[1];if(m!==r&&!1!==t.shouldFontBeChanged[m]){var h=void 0;m===a?h=Ko(p):m===i?h=Yo(p):m===l?u=h=Uo(p):h=m===o&&null!==u?u:Uo(p),c[m]=q(h);var y,g=ko(p);try{for(g.s();!(y=g.n()).done;)y.value.style.fontSize="".concat(h,"px")}catch(t){g.e(t)}finally{g.f()}}}if(n[o]&&n[l]&&null===u){var v=n[l];if(v&&v.length>0){var E,I=Uo(v),b=ko(n[o]);try{for(b.s();!(E=b.n()).done;)E.value.style.fontSize="".concat(I,"px")}catch(t){b.e(t)}finally{b.f()}c[o]=q(I)}}return Ro(t,e),c};function Go(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Wo(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Wo(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wo(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});function $o(t,e,n){var r=this;setTimeout(function(){r.savePropertyAndUpdateWidget(t,e,n)})}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var Xo="second",qo="minute",Zo="hour",Qo="day",Jo={};Jo[Xo]=1e3,Jo[qo]=60*Jo[Xo],Jo[Zo]=60*Jo[qo],Jo[Qo]=24*Jo[Zo],Jo.week=7*Jo[Qo],Jo.month=30*Jo[Qo],Jo.year=365*Jo[Qo],mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});function tl(t){return function(t){if(Array.isArray(t))return el(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return el(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?el(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function el(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.requiresCls("mstrmojo.CustomVisBase","mstrmojo.ui._HasScroller","mstrmojo._SupportRealtimeStreaming");var nl=function(t){var e=!1,n=t.updatedCategory,r=t.isBreakByAttributeAdded,a=t.isOnlyPrimaryValueRendered;t.parsedData.forEach(function(i,o){var l=i.graphicModel.cardId;(!r||i.breakByAttributeName===n)&&(function(t,e,n,r){var a=t.cardComponentReferences,i=t.isComparisonKPI,o=t.isComparisonMetricAdded,l=t.isTrendAttributeAdded,c=a[r],u=c.cardTrendGraphData,s=c.cardPrimaryValue,d=c.cardIndicator,f=u.isTrendIndicatorOnTop,m=u.referenceLine,p=u.properties,h=e.trendChartData,y=e.trend,g=e.indicator,v=e.trendComponentIndex,E=e.thresholdTarget;if(s.textContent=e.primaryValue.formatted,(l||i&&o)&&1!==h.length&&(function(t,e,n){var r,a,i=null!==(r=t.secondaryValueComponentIndex)&&void 0!==r?r:e,o=null===(a=t.secondaryValue)||void 0===a?void 0:a.value,l=n.components.cardSecondaryValues[i].secondaryValueData,c=l.labelTitle;l.labelValue=o,l.labelTitle=t.secondaryValue.label,n.isSecondaryLabelUpdated=c!==(null==l?void 0:l.labelTitle),n.secondaryMetricName=l.labelTitle,n.isComparisonMetricAdded&&(l.labelValue+=""),0===n.truncatedLabels.length&&(n.components.cardSecondaryValues[i].textContent="".concat(l.labelTitle,": ").concat(l.labelValue))}(e,n,t),function(t,e,n,r,a){var i=t.isComparisonKPI,o=t.isComparisonMetricAdded;(!i&&t.properties.trendIndicatorEnabled||i&&t.properties.comparisonIndicatorEnabled)&&(e.indicatorFontOptions.fontSize=n.style.fontSize,o?function(t,e,n,r){var a=n.trendIndicatorValueType,i=e.differenceBetweenPrimaryAndSecondary,o=e[a],l=Zi(i,n,o,r),c=l.indicatorColor,u=l.valueSign,s=a===A.TREND_INDICATOR_VALUE_TYPE.PERCENT?"(".concat(u).concat(o,")"):"".concat(u).concat(o);t.textContent=s,t.style.color=c}(n,r,e,a):function(t,e,n){var r=n.trendIndicatorValueType,a=n.trendIndicatorShape,i=A.TREND_INDICATOR_VALUE_TYPE.NUMERIC,o=e.differenceBetweenPrimaryAndSecondary,l=mstrmojo.string.encodeHtmlString(e[r]),c=Zi(o,n,l,{}),u=c.arrowType,s=c.indicatorColor,d=c.valueSign;if(a===A.TREND_INDICATOR_SHAPE.ARROW){var f=u?qi(s,u,!0):"";t.firstChild.innerHTML=f,t.lastChild.textContent=r===i?"".concat(d).concat(l):"".concat(d," ").concat(l),t.style.color=s}else l=r===i?"".concat(d).concat(l):"".concat(d," ").concat(l),t.textContent=l,t.style.backgroundColor=s}(n,r,e))}(t,p,d,g,E),l)){var I=null!=v?v:n;!function(t,e,n,r,a,i,o,l){var c=o.trendShape,u=o.trendFillColor,s=o.trendFillOpacity,d=o.axisScale,f=l.minValue,m=l.maxValue,p=r.isBreakByAttributeAdded,h=r.updatedCategory,y=r.cardDetails;if(d!==A.AXIS_SCALE.GLOBAL){var g=d===A.AXIS_SCALE.SYNCED_ALL?r.parsedData:r.parsedData.filter(function(t){return t.metricId===n});f=Math.min.apply(Math,wi(g.map(function(t){var e;return(null===(e=t.trend)||void 0===e?void 0:e.minValue)||t.trendChartData[0].raw}))),m=Math.max.apply(Math,wi(g.map(function(t){var e;return(null===(e=t.trend)||void 0===e?void 0:e.maxValue)||t.trendChartData[0].raw})))}p&&y.forEach(function(t){t.breakByAttributeName===h&&(t.trend[n]=l)});var v,E=Ri(r,e,a,s,c,i,{minValue:f,maxValue:m}),I=E.scales,b=E.graphData,_=E.trendFillOpacityFraction,S=E.trendWidth,T=E.trendVerticalMargin;v=c===Li?function(t,e,n,r){var a=e.xScale,i=e.yScale,o=fi().curve(Ii).x(function(t){return a(t.index)}).y(function(t){return i(t.value)});return t.selectAll(".trend-graph__tooltip-marker").remove(),t.select("path").datum(n).attr("d",o),Ni(t,e,n,r)}(t,I,b,e):c===ji?function(t,e,n,r,a,i){var o=e.xScale,l=e.yScale,c=mi().curve(Ii).x(function(t){return o(t.index)}).y1(function(t){return l(t.value)}).y0(a>=0?l(a)+i:l(0));return t.selectAll(".trend-graph__tooltip-marker").remove(),t.selectAll("path").datum(n).attr("d",c),Ni(t,e,n,r)}(t,I,b,e,f,T):function(t,e,n,r,a,i){var o=e.xBarScale,l=e.barYScale,c=e.heightScale,u=t.selectAll(".trend__bar").data(n);return u.enter().append("rect").attr("class","trend__bar").merge(u).style("fill",a).attr("fill-opacity",i).attr("stroke",a).attr("stroke-width",1.5).attr("x",function(t){return o(t.index)}).attr("width",o.bandwidth()).attr("y",function(t){return l(t.value)}).attr("height",function(t){return c(t.value)}),Oi(t,e,i,r)}(t,I,b,e,u,_),i&&function(t,e,n,r,a){var i=n.value,o=n.font,l=e.yScale;t.select("line").attr("x1",0).attr("x2",a).attr("y1",l(i)).attr("y2",l(i)).raise();var c=H(o,r),u=parseFloat(c.fontSize),s=l(i)-4,d=l(i)+4,f=s-u>0?s:d+u;t.select("text").attr("y",f).raise()}(t,I,i,r,S);var C=v,M=C.tooltipHandler,N=C.resetHighlight;t.on("tooltip",M).on("mouseout",function(){N(),r.tooltipInfo={isVisible:!1,isPositionFixed:!1,position:{},graphicModel:{}},r.hideTooltip(!1)})}(t.trendSVGs[I],h,e.metricId,t,f,m,p,y)}}(t,i,o,l),e=e||i.trendChartData.length>1&&i.primaryValue.formatted.length!==i.trendChartData.at(-2).formatted.length||!a&&function(t,e){var n,r,a,i,o,l,c=e.properties,u=e.truncatedLabels,s=e.isSecondaryLabelUpdated,d=e.components,f=c.trendIndicatorValueType,m=A.TREND_INDICATOR_VALUE_TYPE.NUMERIC,p=null===(n=t.secondaryValue)||void 0===n?void 0:n.value,h=f===m?null===(r=t.previousIndicator)||void 0===r?void 0:r.numericValue:null===(a=t.previousIndicator)||void 0===a?void 0:a.percentValue,y=f===m?null===(i=t.indicator)||void 0===i?void 0:i.numericValue:null===(o=t.indicator)||void 0===o?void 0:o.percentValue;return p&&(null===(l=t.previousSecondaryValue)||void 0===l?void 0:l.length)!==(null==p?void 0:p.length)||p&&s||(null==h?void 0:h.length)!==y.length||0===u.length||u.length!==d.cardSecondaryValues.length}(i,t)),i.isCardOld&&t.cardComponentReferences[l].cardComponent.classList.add("card--old-card")}),t.truncatedLabels.length>0&&t.truncatedLabels.length!==t.components.cardSecondaryValues.length&&(t.isSecondaryLabelUpdated=!0),e&&function(t,e){var n=e.isSecondaryLabelUpdated;switch(t.textSizeType){case A.TEXT_SIZE_TYPE.FIXED:""===t.labelFontOptions.fontSize?(Ro(e,t),Ho(e,t),e.componentsUnifiedFontSizesInPt=Ho(e,t)):Ro(e,t);break;case A.TEXT_SIZE_TYPE.UNIFIED:0!==e.shouldFontBeChanged.length||n||(Ro(e,t),Ho(e,t));var r={};r.oldDimensions=Vo(e),Ro(e,t),r.newDimensions=Vo(e),Object.keys(r.newDimensions.dimensionsOfText).length!==Object.keys(r.oldDimensions.dimensionsOfText).length?Object.keys(r.newDimensions.dimensionsOfText).forEach(function(t){e.shouldFontBeChanged[t]=!0}):function(t){var e=t.oldDimensions,n=t.newDimensions,r=e.dimensionsOfText,a=n.dimensionsOfText,i=n.dimensionsOfContainer,o={};Object.values(a).forEach(function(t){if(r[t])if(a[t].width===r[t].width)o[t]=!1;else if(a[t].width>1*i[t].width)o[t]=!0;else if(a[t].width<=1*i[t].width&&a[t].width>=1*r[t].width)o[t]=!1;else{var e=Math.max(a[t].width/i[t].width*1,a[t].height/i[t].height*1);o[t]=!(e>=.9)}else o[t]=!0})}(r);var a=_o.CARD_SECONDARY_VALUES;n&&(e.shouldFontBeChanged[a]=!0),!0===e.shouldFontBeChanged[a]&&(e.truncatedLabels=[]),Ro(e,t),Ho(e,t);break;case A.TEXT_SIZE_TYPE.FIT_TO_CONTAINER:Ro(e,t)}for(var i=e.components,o=0,l=Object.entries(i);o<l.length;o++){var c=Go(l[o],2),u=c[0],s=c[1];[_o.CARD_BODIES,_o.CARD_SECONDARY_VALUE_WITH_INDICATOR_WRAPPERS].includes(u)||(J(s,"maxWidth","none"),s.forEach(function(t){Z(t,t.style.fontSize).width<=parseInt(t.style.width)&&(t.style.overflow="visible")}))}}(t.properties,t),function(t){var e=t.parsedData,n=t.truncatedLabels,r=t.isBreakByAttributeAdded,a=t.updatedCategory,i=t.components;e.forEach(function(e,o){if(t.isComparisonMetricAdded&&(e.secondaryValue.value+=""),!(0===n.length||r&&e.breakByAttributeName!==a)){var l,c=null!==(l=e.secondaryValueComponentIndex)&&void 0!==l?l:o;i.cardSecondaryValues[c].textContent="".concat(n[c]).concat(e.secondaryValue.value)}})}(t)};function rl(t,e,n,r,a){var i=t.isComparisonMetricAdded,o=t.isTrendAttributeAdded,l=t.isBreakByAttributeAdded,c=t.isComparisonKPI,u=t.updatedCategory,s=t.metricFormattingRules,d=!o&&c?e.at(-1).v:function(t,e,n,r,a){var i=t.isComparisonMetricAdded,o=t.timeFilter,l=t.properties.secondaryMetricName,c=a.trend,u=a.trendChartData,s=a.primaryValue,d=Object.keys(n.metricSelector),f=new Date(r),m=Mt(n.headers[0].attributeSelector,n.idValueMapping,d,a.metricId);u.push({raw:s.raw,formatted:s.formatted,graphicModel:m,timestamp:r,timestampDate:f}),!a.isMoreDataThanFilter&&u[0].timestampDate<=o.timeRangeStart&&(a.isMoreDataThanFilter=!0,a.cardSecondaryLabel=l);var p=al(o,u);return a.trend=function(t,e,n,r){var a=n?Math.min(n.minValue,r):Math.min(r,t[0].raw),i=n?Math.max(n.maxValue,r):Math.max(r,t[0].raw);return{minValue:a=a===i&&a>0?0:a,maxValue:i}}(u,0,c,s.raw),a.trendChartData=p,i?e.at(-1).v:p[0].raw}(t,e,n,r,a);!function(t,e,n){var r=t.primaryValue.raw-e,a=Y({partialValue:r,totalValue:e}),i=null!=t&&t.compareMetricId?t.compareMetricId:t.metricId,o={numericValue:ht(r,i,n).formattedValue,percentValue:a,differenceBetweenPrimaryAndSecondary:r};t.previousIndicator=t.indicator,t.indicator=o}(a,d,s),function(t,e,n,r){var a=t.trendChartData,i=n?ht(e,t.compareMetricId,r).formattedValue:a[0].formatted;t.secondaryValue?(t.previousSecondaryValue=t.secondaryValue.value,t.secondaryValue.value=i,t.previousSecondaryLabel=t.secondaryValue.label,t.secondaryValue.label=t.cardSecondaryLabel):t.secondaryValue={value:i,label:t.cardSecondaryLabel}}(a,d,i,s),l&&t.cardDetails.forEach(function(t){t.breakByAttributeName===u&&(t.cardSecondaryLabel=a.cardSecondaryLabel)})}function al(t,e){var n;if(e[0].timestampDate>t.timeRangeStart)return e;t.isMoreDataThanFilter=!0;var r=null!==(n=t.firstIndexInFilterRange)&&void 0!==n?n:e.findIndex(function(e){return e.timestampDate>t.timeRangeStart});return e.slice(r)}function il(t,e){var n={breakByAttributeName:t.breakByAttributeName,cardSecondaryLabel:t.cardSecondaryLabel,firstTimestamp:t.trendChartData[0],trend:{}};return n.trend[t.metricId]=t.trend,n.isCardOld=!!e&&t.isCardOld,n.lastUpdateTimestamp=e?t.lastUpdateTimestamp:null,n}function ol(t,e,n,r,a,i){0===e.length?function(t,e,n,r){t.forEach(function(t){if(r.find(function(e){return e.breakByAttributeName===t.breakByAttributeName}))r.forEach(function(e){e.breakByAttributeName===t.breakByAttributeName&&(e.trend[t.metricId]=t.trend)});else{var a;t.isCardOld=t.trendChartData.at(-1).timestampDate<n.timeRangeStart;var i=null!==(a=t.lastUpdateTimestamp)&&void 0!==a?a:e.at(-1).timestampDateFormat;t.lastUpdateTimestamp=t.isCardOld?i:null;var o=il(t,!0);r.push(o)}})}(t,r,n,e):function(t,e,n,r){var a=r.axisScale;t.forEach(function(i){var o=e.find(function(t){return t.breakByAttributeName===i.breakByAttributeName});if(o){var l;null!=i&&i.cardSecondaryLabel&&(i.cardSecondaryLabel=n?r.secondaryMetricName:o.cardSecondaryLabel,null!=i&&null!==(l=i.secondaryValue)&&void 0!==l&&l.label&&(i.secondaryValue.label=i.cardSecondaryLabel)),i.isCardOld=o.isCardOld,i.lastUpdateTimestamp=o.lastUpdateTimestamp,function(t,e,n,r){if(t===A.AXIS_SCALE.GLOBAL)n.trend=e.trend[n.metricId];else{var a=t===A.AXIS_SCALE.SYNCED_ALL?r:r.filter(function(t){return t.metricId===n.metricId}),i=Math.min.apply(Math,tl(a.map(function(t){var e;return(null===(e=t.trend)||void 0===e?void 0:e.minValue)||t.trendChartData[0].raw}))),o=Math.max.apply(Math,tl(a.map(function(t){var e;return(null===(e=t.trend)||void 0===e?void 0:e.maxValue)||t.trendChartData[0].raw})));n.trend={minValue:i,maxValue:o}}}(a,o,i,t)}else{var c=il(i,!1);e.push(c)}})}(t,e,i,a)}function ll(t){return ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ll(t)}function cl(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function ul(t,e,n){return(e=function(t){var e=function(t){if("object"!=ll(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=ll(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ll(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={});var sl,dl,fl,ml=mstrmojo,pl=ml.DEFAULT_CONTEXT_MENU,hl=ml.CUSTOM_CONTEXT_MENU,yl=function(t){return[".card__label",".card__primary-value",".card__trend-indicator",".card__secondary-value",".card__reference-line-label"].map(function(e){return gl(t,e)}).filter(function(t){return!!t}).join("\t")},gl=function(t,e){var n=t.querySelector(e);return n&&(n.title||n.getAttribute("title")||n.textContent)};mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.plugins.ImageEnhancedKPI||(mstrmojo.plugins.ImageEnhancedKPI={}),mstrmojo.descriptors["IMGKPI.1"]||mstrmojo.requiresDescsWPrefix("IMGKPI.",1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42),mstrmojo.requiresCls("mstrmojo.num","mstrmojo.CustomVisBase","mstrmojo.ui._HasScroller","mstrmojo._SupportRealtimeStreaming","mstrmojo.func"),mstrmojo.plugins.ImageEnhancedKPI.ImageEnhancedKPI=mstrmojo.declare(mstrmojo.CustomVisBase,[mstrmojo.ui._HasScroller,mstrmojo._SupportRealtimeStreaming],{scriptClass:"mstrmojo.plugins.ImageEnhancedKPI.ImageEnhancedKPI",cssClass:"ImageEnhancedKPI",errorMessage:mstrmojo.descP("IMGKPI.","7","Either there is not enough data to display the visualization or the visualization configuration is incomplete."),errorDetails:(fl=mstrmojo.descP("IMGKPI.","56","Add 1 #metric####"),fl.replace(/####/g,"</span>").replace("#",'<span class="ghost-vis-txt-metric">')),useRichTooltip:!1,reuseDOMNode:!1,draggable:!0,supportNEE:!0,supportPagination:!0,isIOS:mstrApp.isDisplayOnMobile,isAndroid:/(android)/i.test(navigator.userAgent),isMobile:mstrApp.isDisplayOnMobile||/(android)/i.test(navigator.userAgent),isInChatbot:null===(sl=(dl=mstrApp).isInAIBotOrAutoAnswer)||void 0===sl?void 0:sl.call(dl),isWSLocalMode:mstrApp.isWSLocalMode&&mstrApp.isWSLocalMode(),isConsumption:!1,labelsEditState:{},components:{},componentsUnifiedFontSizesInPt:null,graphicModels:[],contextMenuCardsGraphicModels:[],selectedCardsGraphicModels:[],trendSVGs:[],autoPlayEnabled:!1,tooltipInfo:{isVisible:!1,isPositionFixed:!1,position:{},graphicModel:{}},intervalAutoPlayId:null,KPIType:0,isSingleCardDisplayed:null,isComparisonKPI:!1,animationDuration:0,iterator:0,init:function(t){this._super(t);var e=this,n=window.mstrApp.isExporting;e.animationDuration=n?0:1500,function(t){t.savePropertyAndUpdateWidgetAsync=$o}(e);var r,a=(r={},Object.values(T).forEach(function(t){var e=t.name,n=t.defaultValue;r[e]=n}),ut({},O,JSON.stringify(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ct(Object(n),!0).forEach(function(e){ut(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ct(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},r))));e.setDefaultPropertyValues(a),e.selectedCardsGraphicModels=[],e.contextMenuCardsGraphicModels=[]},destroy:function(t){this.isWSLocalMode||function(t){var e,n,r,a,i,o;if(null!==(e=mstrApp)&&void 0!==e&&null!==(n=e.rootCtrl)&&void 0!==n&&null!==(r=n.docCtrl)&&void 0!==r&&null!==(a=r.model)&&void 0!==a&&a.bs&&null!==(i=t.model)&&void 0!==i&&i.data&&!t.isWSLocalMode&&!t.isConsumption){var l=t.dataInterface.data.gsi.mx.map(function(e){var n;return null!==(n=e.wdgstrs)&&void 0!==n&&n[s]?{act:f,nodeKey:t.k,skey:s,objectId:e.did,objectType:4}:null}).filter(function(t){return t});(null===(o=t.model.data.wdgstrs)||void 0===o?void 0:o[d])&&l.push({act:f,nodeKey:t.k,skey:d}),l.length&&function(t,e){var n={taskId:"mojoRWManipulation",params:JSON.stringify({actions:e,style:{params:{treesToRender:2},name:"RWIVEMojoStyle"}}),nodeKey:t.k,suppressData:!0,messageId:mstrApp.getMsgID(),styleName:"RWIVEMojoStyle",rwb:mstrApp.rootCtrl.docCtrl.model.bs};mstrApp.serverRequest(n)}(t,l)}}(this),this._super(t)},onmousemove:function(t){var e=this,n=e.tooltipInfo,r={x:t.e.pageX,y:t.e.pageY},a={graphicModel:void 0};if($r(t.getTarget().parentNode).dispatch("tooltip",{detail:{evt:t,returnObject:a}}),a.graphicModel){if(n.isPositionFixed&&e.tooltipWin.isVisible())return;e.tooltipInfo={isVisible:!0,isPositionFixed:!1,position:r,graphicModel:a.graphicModel},this.showTooltip(a.graphicModel,r)}else e.tooltipInfo={isVisible:!1,isPositionFixed:!1,position:{},graphicModel:{}},this.hideTooltip(!1)},oncontextmenu:function(t){var e=t.e.target;"container"!==e.className&&function(t,e,n){var r=n.closest(".card"),a=n.closest(".card__trend-graph"),i=e.getGraphicModels().find(function(t){return mstrmojo.string.encodeHtmlString(t.cardId)===r.id}),o=e.selectedCardsGraphicModels,l=e.contextMenuCardsGraphicModels;if(Ki(e,o),null==l||l.forEach(function(t){var e=Bi(t);null==e||e.classList.remove("card--selected-context-menu")}),e.isIOS&&e.trendSVGs.forEach(function(t){return t.dispatch("mouseout")}),e.isMobile&&a){e.contextMenuCardsGraphicModels=[];var c={graphicModel:void 0};$r(a.querySelector("svg")).dispatch("tooltip",{detail:{evt:t,returnObject:c}}),e.handleContextMenuSelection(t,c.graphicModel)}else if(r.classList.contains("card--selected")&&o.length>1){e.clearSelections();var u=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?cl(Object(n),!0).forEach(function(e){ul(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):cl(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}({},t);u.ctrlKey=!0,u.metaKey=!0;var s=[];o.forEach(function(t){e.handleSelection(u,t),s.push(t)}),e.contextMenuCardsGraphicModels=s,e.handleContextMenuSelection(t,i)}else e.clearSelections(),e.contextMenuCardsGraphicModels=[i],e.handleContextMenuSelection(t,i);e.contextMenuCardsGraphicModels.forEach(function(t){Bi(t).classList.add("card--selected-context-menu")})}(t,this,e)},getContextMenuConfig:function(){var t=function(t){if(0===t.contextMenuCardsGraphicModels.length)return{commonConfig:[],customConfig:[]};var e=l(t.KPIType);return{commonConfig:K(t,e.BREAK_BY)?[{type:pl.CHANGE_VISUALIZATION},{type:pl.COPY_PASTE_FORMAT},{type:pl.KEEP_ONLY},{type:pl.EXCLUDE},{type:pl.DRILL},{type:pl.GROUP},{type:pl.CALCULATION},{type:pl.SHOW_DATA},{type:pl.GO_TO_TARGETS}]:[{type:pl.CHANGE_VISUALIZATION},{type:pl.COPY_PASTE_FORMAT}],customConfig:[t.isMobile?{}:{type:hl.NORMAL,name:mstrmojo.descP("IMGKPI.","12","Copy Text"),onClick:function(){!function(t){var e=t.map(function(t){return yl(t)}).join("\n"),n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}(t.contextMenuCardsGraphicModels.map(function(t){return Bi(t)}))}}]}}(this);return{common:t.commonConfig,custom:t.customConfig}},getGraphicModelsBySelector:function(t,e){var n=this,r=[],a={attribute:mstrmojo.customviz.PICKED_TYPE.BOTH,metric:mstrmojo.customviz.PICKED_TYPE.BOTH},i=function(t){mstrmojo.array.forEach(n.getGraphicModels(),function(i){i.getSelector()&&n.canPickGraphicModel(t,e,i,a)&&r.push(i)})};return t.length>1?t.forEach(i):i(t),0===r.length&&(function(t,e){e.getGraphicModels().forEach(function(t){var e=Bi(t);e&&zi(e)})}(0,this),n.selectedCardsGraphicModels=[],n.contextMenuCardsGraphicModels=[]),r},updateHighlight:function(){var t=this,e=this,n=[];e.getGraphicModels().forEach(function(e){t.graphicNeedsHighlight(e,!1)&&n.push(e)}),e.contextMenuCardsGraphicModels.length||Ki(e,n)},resetComponents:function(){this.components={cardLabels:[],cardPrimaryValues:[],cardBodies:[],cardSecondaryValues:[],cardSecondaryValueWithIndicatorWrappers:[],cardIndicators:[]}},clearDomNode:function(){this.domNode.innerHTML=""},addMojoScrollbar:function(){var t=this,e=t.domNode;t.containerNode=e.firstChild.firstChild,t.scrollNode=e.firstChild,t.isIOS?t.scrollbarHostNode=e.firstChild:t.scrollbarHostNode=e,t.scrollBarNodes={};var n=t.domNode.style,r=n.height,a=n.width;t.scrollNode.style.maxHeight=r,t.containerNode.style.maxHeight=r,t.containerNode.style.width=a,t.updateScrollbars(),t.addScrollNodeProperties()},rerenderVisualization:function(t,e){var n=this;!function(t,e,n){var r=t.isComparisonMetricAdded,a=t.isTrendAttributeAdded,i=t.isBreakByAttributeAdded,o=t.isComparisonKPI,l=t.updatedCategory,c=t.metricFormattingRules,u=t.data.at(-1).cells,s=St(u,t),d=!(a||o&&r);t.cardDataToUpdate=t.parsedData.find(function(t){return t.breakByAttributeName===l}),t.parsedData.forEach(function(r){if(!i||r.breakByAttributeName===l){var a=r.trendChartData,o=e[t.mappedIndexes[r.metricId]].v,f=ht(o,r.metricId,c).formattedValue;r.primaryValue.raw=o,r.primaryValue.formatted=f,d?a.push({raw:o,formatted:f}):rl(t,u,s,n,r)}})}(n,t,e),function(t){var e=t.isComparisonMetricAdded,n=t.isBreakByAttributeAdded,r=t.components,a=t.cardDataToUpdate,i=t.data,o=t.updatedCategory,l=t.properties,c=!e&&(!r.cardSecondaryValues[0]&&1!==i.length||n&&void 0===a.secondaryValueComponentIndex),u=e&&(!n&&2===i.length&&void 0===t.parsedData[0].trendComponentIndex||n&&void 0===a.trendComponentIndex);(c||u)&&t.parsedData.forEach(function(n,r){var a=null==n||!n.breakByAttributeName||n.breakByAttributeName===o;lo(n,t,l,r,!e&&a,a)})}(n),nl(n)},checkTimeFilter:function(){var t=this;t.updateFrequency=t.getRealtimeUpdateFrequency();var e=t.getRealtimeFilterInfo();if(t.timeFilter={},e){var n,r,a=e.curre,i=e.lastt,o=e.lastti,l=e.timef;if(t.timeFilter.typeOfTimeFilter=l,1===l)n=1===o?i:60*i;else{switch(a){case 1..KEY:n=1..TIME_IN_SECONDS;break;case 2..KEY:n=2..TIME_IN_SECONDS;break;case 3..KEY:n=3..TIME_IN_SECONDS;break;default:n=4..TIME_IN_SECONDS}t.timeFilter.currentSelection=a}r=n<=60?"".concat(n).concat("s"):n<=3600?"".concat(n/60).concat("mins"):n<=86400?"".concat(n/3600).concat("h"):"".concat(n/86400).concat("day"),t.timeFilter.filterTimeInSeconds=n,t.timeFilter.filterLabel=r}else{t.timeFilter={typeOfTimeFilter:1,filterTimeInSeconds:7200,filterLabel:"".concat(7200).concat("s")}}},updateTimeFilterRanges:function(t){var e=this.timeFilter,n="string"==typeof t?new Date(t):t;1===e.typeOfTimeFilter?e.timeRangeStart=new Date(n-e.filterTimeInSeconds*Jo[Xo]):2===e.typeOfTimeFilter&&(e.timeRangeStart=function(t,e){var n,r={year:(n=t).getFullYear(),month:n.getMonth(),day:n.getDate(),hour:n.getHours(),minute:n.getMinutes()},a=r.year,i=r.month,o=r.day,l=r.hour,c=r.minute;switch(e){case 1..KEY:return c<15?new Date(a,i,o,l,0):c<30?new Date(a,i,o,l,15):c<45?new Date(a,i,o,l,30):new Date(a,i,o,l,45);case 2..KEY:return c<30?new Date(a,i,o,l,0):new Date(a,i,o,l,30);case 3..KEY:return new Date(a,i,o,l,0);default:return new Date(a,i,o,0)}}(n,e.currentSelection))},applyFilterOnTrendData:al,plot:function(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=this,a=r.isRealtimeStreamingEnabled&&r.isRealtimeStreamingEnabled();if(r.isConsumption=!(null!==(t=(e=mstrApp).supportFeature)&&void 0!==t&&t.call(e,"show-react-dossier-format")),!a&&function(t){var e=l(t.KPIType);return!(!K(t,e.BREAK_BY)||!t.dataInterface.data.gsi.mx.length)&&(0===t.KPIType?t.dataInterface.data.gts.row[0].es.length*t.dataInterface.data.gsi.mx.length:t.dataInterface.data.gts.row[0].es.length)>500}(r)){var i,o=(null===(i=r.dataInterface.data.gts.row[0])||void 0===i?void 0:i.n)||"";throw new Error(mstrmojo.descP("IMGKPI.","49","The attribute ## has too many elements. Please filter the data to display the KPIs.").replace("##",o))}for(var u=pt(r.model.data.nf),s=!1,d=0;d<r.model.data.nf.length&&!s&&r.formattingModel;d++){var f;s=r.model.data.nf[d].id!==(null===(f=r.formattingModel.model[d])||void 0===f?void 0:f.id)||r.model.data.nf[d].nfs!==r.formattingModel.model[d].nfs}r.metricFormattingRules=u,r.formattingModel={model:r.model.data.nf,didMetricFormattingRuleChange:s},r.trendSVGs=[],r.shouldFontBeChanged=[],r.cardIds=[],r.graphicModels=[],r.truncatedLabels=[],r.isRealTime=a,r.isComparisonMetricAdded=at(r);var m=l(r.KPIType);if(a&&(r.isBreakByAttributeAdded=K(r,m.BREAK_BY),r.isTrendAttributeAdded=K(r,m.TREND),function(t){var e,n,r=t.isBreakByAttributeAdded;r&&(n=0),t.isTrendAttributeAdded&&(e=r?1:0),t.timestampIndex=e,t.breakByIndex=n}(r)),!a||r.data&&r.data.length){r.currentInterval&&clearInterval(r.currentInterval);var p=function(){var t=function(t){var e=l(t.KPIType),n=!K(t,e.METRICS),r=mstrApp.isDisplayOnMobile||mstrApp.isDossier||/(android)/i.test(navigator.userAgent),a=!window.mstrApp.isExporting&&!r&&!window.mstrApp.features["show-react-dossier-format"],i=t.isComparisonKPI;if(a)throw t.errorMessage=i?mstrmojo.descP("IMGKPI.","11","Comparison KPI is supported only on environments 11.3.1 or higher"):mstrmojo.descP("IMGKPI.","10","Multi-Metric KPI is supported only on environments 11.3.1 or higher"),t.errorDetails="",new Error("No react-format-panel");if(n){var o=document.createElement("div");o.classList.add("warning-container");var c=document.createElement("div");c.classList.add("icon"),c.style.backgroundPosition=i?"0 -90px":"unset";var u=t.domNode,s=u.clientWidth,d=u.clientHeight;(s<640||d<600)&&(c.style.width="60px",c.style.height="60px",c.style.backgroundPosition=i?"-90px -90px":"unset"),o.appendChild(c);var f=document.createElement("div");f.classList.add("title");var m=document.createTextNode(i?mstrmojo.descP("IMGKPI.","41","Comparison KPI"):mstrmojo.descP("IMGKPI.","50","Enhanced KPI"));f.appendChild(m),o.appendChild(f);var p=document.createElement("div");p.classList.add("description"),p.innerHTML=i?mstrmojo.descP("IMGKPI.","9","Add 2 #metrics####").replace("####","").replace("#","<svg class='metric-icon'></svg>"):mstrmojo.descP("IMGKPI.","56","Add 1 #metric####").replace("####","").replace("#","<svg class='metric-icon'></svg>"),o.appendChild(p),t.domNode.appendChild(o)}return a||n}(r);if(t)r.raiseEvent({name:"renderFinished",id:r.k});else{var e,a=r.intervalAutoPlayId;if(a&&clearInterval(a),r.addUseAsFilterMenuItem(),n)e=ot(n,r);else{var i=JSON.parse(r.getProperty(O));e=ot(i,r)}r.properties=e;var o=function(){var t,n,a,i,o=function(t,e){var n=t.model.data.nf,r=pt(n,!0),a=n.map(function(t){return t.id}),i={};return a.forEach(function(t){var n=e[t]||{},a=n.value,o=n.font;if(a&&!isNaN(a)){var l=ht(a,t,r).formattedValue;i[t]=e[t],i[t].formattedValue=l,i[t].font={fontColor:o.color,fontSize:o.size,fontFamily:o.fontFamily,fontStyle:o.style}}}),i}(r,e.createdReferenceLines);r.resetComponents(),r.trendSVGs=[],r.clearDomNode(),function(){var t=r.isRealTime,n=r.isBreakByAttributeAdded,a=r.isComparisonMetricAdded,i=r.cardsOrder,u=r.breakByIndex,s=r.timeFilter,d=r.data,f=t?d:function(t){var e=mstrmojo.models.template.DataInterface.ENUM_RAW_DATA_FORMAT.ROWS_ADV;return t.dataInterface.getRawData(e,{hasSelection:!0,hasTitleName:!0,minAttribute:0})}(r);t&&n&&i&&f.sort(function(t,e){return i.findIndex(function(e){return e===t.cells[u].v})-i.findIndex(function(t){return t===e.cells[u].v})});var m,p=function(t,e,n,r){var a,i,o=l(e.KPIType),u=function(t,e){var n=pt(e.model.data.nf);return t.forEach(function(t){t.forEach(function(t){var e=t.trendChartData[t.trendChartData.length-1].raw,r=t.trendChartData[t.trendChartData.length-1].formatted,a=ht(e,t.metricId,n).color;t.primaryValue={raw:e,formatted:r,color:a}})}),t}(At(t,e,o),e),s=(a=function(t,e,n,r){if(!K(e,r.TREND))return[t];var a={min:null,max:null},i=e.isComparisonKPI,o=e.isRealTime,l=n.axisScale,c=n.axisScaleComparison;return i&&(l=c),t.forEach(function(t){var e=null,n=null,r=t.map(function(t){return t.trendChartData.map(function(t){return t.raw})});if(l!==A.AXIS_SCALE.GLOBAL){var i=r.flat();n=i.reduce(function(t,e){return Math.min(t,e)},0),e=i.reduce(function(t,e){return Math.max(t,e)},Number.NEGATIVE_INFINITY),a.min=Math.min(0,a.min,n),a.max=Math.max(a.max,e)}t.forEach(function(t,a){if(t.trendChartData.length<=1)t.trend=null;else{var i,l=r[a].reduce(function(t,e){return Math.max(t,e)},Number.NEGATIVE_INFINITY),c=null!==(i=e)&&void 0!==i?i:l,u=function(t,e,n,r,a){if(null!==r)return r;var i=e[n],o=t?i.reduce(function(t,e){return Math.min(t,e)},Number.POSITIVE_INFINITY):i.reduce(function(t,e){return Math.min(t,e)},0);return o>=0&&o===a?0:o}(o,r,a,n,c);t.trend={minValue:u,maxValue:c}}})}),[t,a]}(u,e,n,o),i=2,function(t){if(Array.isArray(t))return t}(a)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,o,l=[],c=!0,u=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(l.push(r.value),l.length!==e);c=!0);}catch(t){u=!0,a=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return l}}(a,i)||bt(a,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=s[0],f=s[1],m=function(t,e,n,r){var a=e.isComparisonKPI,i=e.isRealTime,o=e.isBreakByAttributeAdded,l=e.timeFilter,u=n.secondaryMetricName,s=K(e,r.TREND);e.isTrendAttributeAdded=s;var d=0===e.KPIType,f=a?K(e,r.COMPARE_WITH):null,m=K(e,r.METRICS)&&f;if(d&&!s||a&&!m&&!s)return t;var p=pt(e.model.data.nf);return e.metricFormattingRules=p,e.metricId=t[0][0].metricId,t.forEach(function(t){t.forEach(function(t){if(i&&(t.cardSecondaryLabel=function(t,e,n,r,a){if(t<=e.timeRangeStart||n||!r&&e.isMoreDataThanFilter)return a;var i=t.toTimeString().split(" ").shift();return"Compare to ".concat(i)}(t.trendChartData[0].timestampDate,l,m,o,u)),null!==t.trend||m){var e,n,r,a={label:i?t.cardSecondaryLabel:u};r=i?0:t.trendChartData.length-2,m?(a.value=t.compareMetricValue.formatted,e=t.compareMetricValue.raw,n=t.compareMetricId):(a.value=t.trendChartData[r].formatted,e=t.trendChartData[r].raw,n=t.metricId);var s=t.primaryValue.raw-e,d=A.TREND_INDICATOR_VALUE_TYPE,f=ht(s,n,p).formattedValue,h=It(It(It({},d.NUMERIC,f),d.PERCENT,[0,""].includes(e)?c:Y({partialValue:s,totalValue:e})),"differenceBetweenPrimaryAndSecondary",s);t.secondaryValue=a,t.indicator=h}else t.secondaryValue=null,t.indicator=null})}),t}(d,e,n,o).flat(),p=function(t,e,n,r){var a=n.axisScale,i=n.axisScaleComparison;return r.isComparisonKPI&&(a=i),a===A.AXIS_SCALE.SYNCED_ALL?t.map(function(t){return t.trend={minValue:e.min,maxValue:e.max},t}):t}(Ct(m,n,e.isTrendAttributeAdded),f,n,e);return function(t,e){return t.map(function(t){return t.referenceLine=e[t.metricId],t})}(p,r)}(f,r,e,o);p.forEach(function(t){r.graphicModels.push(t.graphicModel)}),t&&n&&(r.cardDetails=null!==(m=r.cardDetails)&&void 0!==m?m:[],ol(p,r.cardDetails,s,d,e,a)),r.isSingleCardDisplayed=1===p.length||e.layoutType===A.LAYOUT_TYPES.STACKED,function(t,e){var n,r=l(t.KPIType),a=null===(n=t.gridData.gsi.sorts)||void 0===n?void 0:n[0],i=!(null==a||!a.length),o=K(t,r.BREAK_BY);if(i&&o&&e[0].graphicModel.getSelector().tid===a[0].key.split("!")[1]){var c={};e.forEach(function(t,e){t in c||(c[t.breakByAttributeName]=e)}),e.sort(function(t,e){return c[t.breakByAttributeName]-c[e.breakByAttributeName]})}}(r,p),r.parsedData=p}();var u=r.domNode,s=r.parsedData,d=r.isMobile,f=r.isInChatbot,m=u.appendChild(jt({},!1)),p=Do(r,s,e);m.appendChild(p);var h=Array.from(null==p?void 0:p.children),y=2===(null===(t=r.properties)||void 0===t?void 0:t.textSizeType);null==h||null===(n=h.forEach)||void 0===n||n.call(h,function(t,e){var n,a,i,o,l=null===(n=t.querySelector)||void 0===n?void 0:n.call(t,".card__label-body-wrapper"),c=null===(a=t.querySelector)||void 0===a?void 0:a.call(t,".secondary-value-indicator-wrapper"),u=null===(i=t.querySelector)||void 0===i?void 0:i.call(t,".card__img-wrapper");y||(function(t,e,n){var r=t.getBoundingClientRect(),a=r.left,i=r.right,o=r.width,l=e.getBoundingClientRect(),c=l.right,u=l.width,s=Math.min(.08*u,30),d=t.querySelector(".card__primary-value"),f=t.querySelector(".card__label"),m=getComputedStyle(d),p=getComputedStyle(f),h={fontSize:m.fontSize,fontFamily:m.fontFamily,fontWeight:m.fontWeight,fontStyle:m.fontStyle},y={fontSize:p.fontSize,fontFamily:p.fontFamily,fontWeight:p.fontWeight,fontStyle:p.fontStyle},g=a+rt(d.textContent,h)>c-s,v=t.scrollWidth>t.clientWidth;if(g||v){var E,I,b=g?o-(i-c)-s:t.clientWidth,_=Math.max(parseFloat(function(t,e,n,r,a,i,o,l,c){if(!t||""===t)return null;if(l=l||1,c=c||200,(e-=a=a||0)<=0)return null;var u=$HASH.copy(n||{}),s=u.fontSize,d=!0;s?"string"==typeof s&&-1!==s.indexOf("pt")&&(d=!1):($DOM.isIE||$DOM.isIEW3C)&&(d=!1);var f=function(n){return u.fontSize=n+(d?"px":"pt"),rt(t,u,0,r,void 0,void 0)<=e};if(!f(l))return null;if(f(c))return c+(d?"px":"pt");for(var m=l,p=c,h=l;p-m>.1;){var y=(m+p)/2;f(y)?(h=y,m=y):p=y}return(h=Math.floor(10*h)/10)+(d?"px":"pt")}(d.textContent,b,h,m.height)),12);if(0!==n.properties.primaryValueFontOptions.fontSteps){var A=R(_+"px",n.properties.primaryValueFontOptions.fontSteps);d.style.setProperty("font-size",A)}else d.style.setProperty("font-size",_+"px");var S=Math.min(_/parseFloat(m.fontSize),1);12===_&&(d.style.setProperty("width",b+"px"),d.style.setProperty("overflow","hidden"),d.style.setProperty("text-overflow","ellipsis"));var T=Math.max(S*parseFloat(getComputedStyle(f).fontSize),8);if(0!==(null==n||null===(E=n.properties)||void 0===E||null===(I=E.labelFontOptions)||void 0===I?void 0:I.fontSteps)){var C=R(T+"px",n.properties.labelFontOptions.fontSteps);f.style.setProperty("font-size",C)}else f.style.setProperty("font-size",T+"px")}else{var M,N,O,w;if(0!==(null==n||null===(M=n.properties)||void 0===M||null===(N=M.primaryValueFontOptions)||void 0===N?void 0:N.fontSteps)){var D=R(h.fontSize,n.properties.primaryValueFontOptions.fontSteps);d.style.setProperty("font-size",D)}if(0!==(null==n||null===(O=n.properties)||void 0===O||null===(w=O.labelFontOptions)||void 0===w?void 0:w.fontSteps)){var x=R(y.fontSize,n.properties.labelFontOptions.fontSteps);f.style.setProperty("font-size",x)}}}(l,t,r),c&&function(t,e,n,r){var a,i,o,l,c,u,s,d,f=e.getBoundingClientRect().width,m=t.querySelector(".card__secondary-value"),p=t.querySelector(".card__trend-indicator"),h=Math.min(.08*f,30),y="vertical-card"===(null==n||null===(a=n.cardProperties)||void 0===a?void 0:a.cssModifiers).cardDirection?f-2*h:f-2*h-p.clientWidth,g=null==n||null===(i=n.components)||void 0===i||null===(o=i.cardSecondaryValues)||void 0===o||null===(l=o[r])||void 0===l?void 0:l.secondaryValueData;if(0!==(null==n||null===(c=n.properties)||void 0===c||null===(u=c.secondaryValueFontOptions)||void 0===u?void 0:u.fontSteps)){var v=R(getComputedStyle(m).fontSize,n.properties.secondaryValueFontOptions.fontSteps);m.style.setProperty("font-size",v)}if(0!==(null==n||null===(s=n.properties)||void 0===s||null===(d=s.indicatorFontOptions)||void 0===d?void 0:d.fontSteps)){var E=R(getComputedStyle(p).fontSize,n.properties.indicatorFontOptions.fontSteps);p.style.setProperty("font-size",E)}var I=X({container:m,maxTextWidth:y,textData:{label:g.labelTitle,value:g.labelValue,connector:": "},fontSize:parseFloat(getComputedStyle(m).fontSize),fontStyle:Q(m,parseFloat(getComputedStyle(m).fontSize))}).truncatedLabelWithValue;m.textContent=I}(c,t,r,e),"vertical-card"===(null==r||null===(o=r.cardProperties)||void 0===o?void 0:o.cssModifiers).cardDirection&&(function(t,e,n){if(t&&e&&n){var r=t.querySelector(".card__label-text"),a=r.parentNode.getBoundingClientRect(),i=e.getBoundingClientRect(),o=n.getBoundingClientRect(),l=i.bottom,c=a.top;if(c<=l){if(f=r,(m=document.createRange()).selectNodeContents(f),!(m.getClientRects().length>1))return void r.style.setProperty("transform","translateY(min(5px, 5cqh))");var u=l-c+Math.min(.03*o.height,5),s=o.height,d="".concat((u/s*100).toFixed(2),"cqh");n.style.setProperty("--label-icon-gap",d),t.style.marginTop=d}}var f,m}(l,u,t),function(t,e){var n=t.cardDimensions.cardHeight;t.isTrendAttributeAdded&&n<100&&e.style.setProperty("display","none")}(r,u)),function(t,e){var n,r=e.cardDimensions.cardHeight,a=t.querySelector(".card__label-text");r<100&&"horizontal-card"===(null==e||null===(n=e.cardProperties)||void 0===n?void 0:n.cssModifiers).cardDirection&&e.isTrendAttributeAdded&&(a.style.setProperty("white-space","nowrap"),a.parentNode.style.setProperty("min-block-size","1lh"))}(l,r)),setTimeout(function(){return function(t){var e,n=t.domNode,r=(75-n.clientHeight)/2,a=n.querySelector(".card-wrapper"),i=null==a||null===(e=a.parentElement)||void 0===e?void 0:e.parentElement;i&&(i.scrollTop+=r)}(r)},0)}),r.visualizationNode=m;var g=m.appendChild(document.createElement("div"));g.classList.add("font-size-measure-div"),g.remove(),e.layoutType===A.LAYOUT_TYPES.GRID&&r.addMojoScrollbar(),d||f||e.layoutType===A.LAYOUT_TYPES.STACKED||function(t){var e,n,r,a,i=t.domNode,o=i.clientWidth,c=i.clientHeight,u=$r(i),s=u.append("div").attr("class","selection-tool").style("visibility","hidden");u.call(function(){var t,e,n,r,a=na,i=ra,o=aa,l=ia,c={},u=Qe("start","drag","end"),s=0,d=0;function f(t){t.on("mousedown.drag",m).filter(l).on("touchstart.drag",y).on("touchmove.drag",g,qr).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function m(o,l){if(!r&&a.call(this,o,l)){var c=E(this,i.call(this,o,l),o,l,"mouse");c&&($r(o.view).on("mousemove.drag",p,Zr).on("mouseup.drag",h,Zr),function(t){var e=t.document.documentElement,n=$r(t).on("dragstart.drag",Jr,Zr);"onselectstart"in e?n.on("selectstart.drag",Jr,Zr):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}(o.view),Qr(o),n=!1,t=o.clientX,e=o.clientY,c("start",o))}}function p(r){if(Jr(r),!n){var a=r.clientX-t,i=r.clientY-e;n=a*a+i*i>d}c.mouse("drag",r)}function h(t){$r(t.view).on("mousemove.drag mouseup.drag",null),function(t,e){var n=t.document.documentElement,r=$r(t).on("dragstart.drag",null);e&&(r.on("click.drag",Jr,Zr),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(t.view,n),Jr(t),c.mouse("end",t)}function y(t,e){if(a.call(this,t,e)){var n,r,o=t.changedTouches,l=i.call(this,t,e),c=o.length;for(n=0;n<c;++n)(r=E(this,l,t,e,o[n].identifier,o[n]))&&(Qr(t),r("start",t,o[n]))}}function g(t){var e,n,r=t.changedTouches,a=r.length;for(e=0;e<a;++e)(n=c[r[e].identifier])&&(Jr(t),n("drag",t,r[e]))}function v(t){var e,n,a=t.changedTouches,i=a.length;for(r&&clearTimeout(r),r=setTimeout(function(){r=null},500),e=0;e<i;++e)(n=c[a[e].identifier])&&(Qr(t),n("end",t,a[e]))}function E(t,e,n,r,a,i){var l,d,m,p=u.copy(),h=Xr(i||n,e);if(null!=(m=o.call(t,new ea("beforestart",{sourceEvent:n,target:f,identifier:a,active:s,x:h[0],y:h[1],dx:0,dy:0,dispatch:p}),r)))return l=m.x-h[0]||0,d=m.y-h[1]||0,function n(i,o,u){var y,g=h;switch(i){case"start":c[a]=n,y=s++;break;case"end":delete c[a],--s;case"drag":h=Xr(u||o,e),y=s}p.call(i,t,new ea(i,{sourceEvent:o,subject:m,target:f,identifier:a,active:y,x:h[0]+l,y:h[1]+d,dx:h[0]-g[0],dy:h[1]-g[1],dispatch:p}),r)}}return f.filter=function(t){return arguments.length?(a="function"==typeof t?t:ta(!!t),f):a},f.container=function(t){return arguments.length?(i="function"==typeof t?t:ta(t),f):i},f.subject=function(t){return arguments.length?(o="function"==typeof t?t:ta(t),f):o},f.touchable=function(t){return arguments.length?(l="function"==typeof t?t:ta(!!t),f):l},f.on=function(){var t=u.on.apply(u,arguments);return t===u?f:t},f.clickDistance=function(t){return arguments.length?(d=(t=+t)*t,f):Math.sqrt(d)},f}().on("start",function(o){var l,c,d=t.tooltipInfo;a=o.sourceEvent.target,d.isVisible&&null!==(l=t.model)&&void 0!==l&&null!==(c=l.data)&&void 0!==c&&c.doslinkinfo&&(t.showTooltip(d.graphicModel,d.position,!0),d.isPositionFixed=!0),(r=u.selectAll("article")).each(function(t,e,n){n[e].style.pointerEvents="none"}),e=i.scrollTop;var f={y:o.y,x:o.x};n=f,s.style("visibility","visible").style("left","".concat(n.x,"px")).style("top","".concat(n.y+e,"px")).style("width","0px").style("height","0px")}).on("drag",function(t){var r={y:t.y,x:t.x},a=o-n.x-2,i=c-n.y-2,l=r.x-n.x,u=r.y-n.y;l<0&&(s.style("left","".concat(Math.max(0,r.x),"px")),a=n.x),u<0&&(s.style("top","".concat(Math.max(0,r.y+e),"px")),i=n.y);var d=Math.min(a,Math.abs(l)),f=Math.min(i,Math.abs(u));s.style("width","".concat(d,"px")).style("height","".concat(f,"px"))}).on("end",function(n){var i={xMin:parseInt(s.style("left")),xMax:parseInt(s.style("left"))+parseInt(s.style("width")),yMin:parseInt(s.style("top")),yMax:parseInt(s.style("top"))+parseInt(s.style("height"))};s.style("visibility","hidden");var o=function(t,e,n,r){var a=n.xMin,i=n.xMax,o=n.yMin,l=n.yMax,c=t.node().getBoundingClientRect(),u=c.x,s=c.y,d=[];return e.each(function(t,e,n){var c=n[e],f=c.getBoundingClientRect(),m=f.x,p=f.y,h=f.width,y=f.height,g=m-u,v=p-s+r;!(a>g+h||i<g||l<v||o>v+y)&&d.push(c)}),d}(u,r,i,e);(function(t,e,n,r){var a=!!e.contextMenuCardsGraphicModels.length;if(Yi(e),n.length>1){e.selectedCardsGraphicModels=n.map(function(t){return e.getGraphicModels().find(function(e){return mstrmojo.string.encodeHtmlString(e.cardId)===t.id})}),e.clearSelections(),Ki(e);var i=l(e.KPIType),o=K(e,i.TREND),c=K(e,i.BREAK_BY);(o||c)&&e.applySelection(e.selectedCardsGraphicModels.map(function(t){return t.getSelector()}))}else if(1===n.length){var u=e.getGraphicModels().find(function(t){return mstrmojo.string.encodeHtmlString(t.cardId)===n[0].id});Vi(t,e,u,r)}else a||(e.selectedCardsGraphicModels=[],e.clearSelections(),Ki(e),e.handleSelection(t))})(n,t,o,a),r.each(function(t,e,n){n[e].style.pointerEvents="auto"})}).filter(function(t){return!("mstrmojo-scrollbar vertical"===t.target.className||2===t.button)}))}(r),r.animationDuration=0,e.stackedAutoPlay?r.autoPlayEnabled=!0:r.autoPlayEnabled=!1;var v=null===(a=r.getSelectionCache)||void 0===a||null===(i=a.call(r))||void 0===i?void 0:i._viSelections;v&&r.highlight("att",v,!0),r.raiseEvent({name:"renderFinished",id:r.k})};!function(t,e,n,r){var a=[t.allFontOptions,t.labelFontOptions,t.primaryValueFontOptions,t.secondaryValueFontOptions,t.indicatorFontOptions].map(function(t){return{name:t.fontFamily,isItalic:t.fontStyle[1],isBold:t.fontStyle[0]}}).reduce(function(t,e){return t.find(function(t){return t.name===e.name&&t.isItalic===e.isItalic&&t.isBold===e.isBold})?t:t.concat([e])},[]);mstrmojo.util.FontLoader.load(e.id,a,{success:n,failure:r})&&n()}(e,r,o,o)}},h="".concat(r.cssClass,"stylesheet");if(mstrApp.isWorkstation&&!tl(document.styleSheets).some(function(t){var e;return null===(e=t.href)||void 0===e?void 0:e.includes(r.cssClass)})){var y=document.getElementById(h);if(y){var g=y.onload;y.onload=function(){g(),p()}}else{var v=document.head,E=document.createElement("link");E.type="text/css",E.onload=p,E.id=h,E.rel="stylesheet",E.href="../plugins/".concat(r.cssClass,"/style/global.css"),v.appendChild(E)}}else p()}},renderRealtimeData:function(t){var e,n=this,r=n.timestampIndex,a=n.breakByIndex,i=n.isBreakByAttributeAdded,o=n.isTrendAttributeAdded;n.cardsOrder=null!==(e=n.cardsOrder)&&void 0!==e?e:[],i&&!n.cardsOrder.find(function(e){return e===t[0].cells[a].v})&&n.cardsOrder.push(t[0].cells[a].v),o&&(t[0].cells[r].v=t[0].cells[r].v.replace("T"," ").slice(0,-1),t[0].timestampDateFormat=new Date(t[0].cells[r].v)),n.data?n.data.push(t[0]):n.data=t,0===n.parsedData.length?(this.checkTimeFilter(),o&&(this.updateTimeFilterRanges(t[0].cells[r].v),this.timeFilter.isMoreDataThanFilter=!1),this.plot()):this.updateCardsAndRenderVisualization(t)},onRealtimeTopicChanged:function(){this.data=[],this.rawData=[],this.parsedData=[],this.trendSVGs=[]},updateCardsAndRenderVisualization:function(t){var e,n=this,r=n.isBreakByAttributeAdded,a=n.timestampIndex,i=n.breakByIndex,o=n.isTrendAttributeAdded;n.updatedCategory=r?t[0].cells[i].v:null,o?(e=t[0].cells[a].v,n.updateTimeFilterRanges(e),n.data=function(t){var e,n,r=t.timeFilter,a=t.data,i=t.breakByIndex,o=t.updatedCategory,l=t.isBreakByAttributeAdded,c=t.isComparisonMetricAdded;if(!l||c){var u=a.findIndex(function(t){return t.timestampDateFormat>r.timeRangeStart});e=a.slice(u),r.firstIndexInFilterRange=u}else e=a.filter(function(t){return t.cells[i].v!==o||t.timestampDateFormat>r.timeRangeStart});return!r.isMoreDataThanFilter&&a[0].timestampDateFormat<=r.timeRangeStart&&(r.isMoreDataThanFilter=!0,null!==(n=t.properties)&&void 0!==n&&n.secondaryMetricName&&function(t){var e=t.timeFilter,n=t.properties,r=t.components;if(2===e.typeOfTimeFilter){var a="Since ".concat(e.timeRangeStart.toLocaleTimeString());n.secondaryMetricName=a,r.cardSecondaryValues.forEach(function(t){t.secondaryValueData.labelTitle=a})}else{var i=ot({secondaryMetricName:""},t);n.secondaryMetricName=i.secondaryMetricName}}(t)),e}(n)):e=t[0].timestamp;var l=n.parsedData.map(function(t){return t.breakByAttributeName}).filter(function(t){return t}),c=!!r&&function(t,e){var n=e.updateFrequency,r=e.updatedCategory,a=e.timeFilter,i=e.parsedData,o=new Date(t-n*Jo[Xo]),l=i.filter(function(t){var e=t.isCardOld&&t.breakByAttributeName!==r&&t.lastUpdateTimestamp<o,n=t.breakByAttributeName===r&&t.trendChartData.at(-1).timestampDate<=a.timeRangeStart;return e||n}),c=l.length>0;return c&&function(t,e){t.forEach(function(t){e.cardsOrder=t.breakByAttributeName!==e.updatedCategory?e.cardsOrder.filter(function(e){return e!==t.breakByAttributeName}):e.cardsOrder,e.data=e.data.filter(function(n){return n.cells[e.breakByIndex].v!==t.breakByAttributeName||n.cells[e.breakByIndex].v===e.updatedCategory}),e.cardDetails=e.cardDetails.filter(function(e){return e.breakByAttributeName!==t.breakByAttributeName})})}(l,e),function(t,e){var n=e.updatedCategory,r=e.timeFilter,a=e.parsedData,i=e.cardDetails;a.forEach(function(e){var a;e.isCardOld=e.trendChartData.at(-1).timestampDate<r.timeRangeStart&&e.breakByAttributeName!==n;var o=null!==(a=e.lastUpdateTimestamp)&&void 0!==a?a:t;e.lastUpdateTimestamp=e.isCardOld?o:null,i.forEach(function(t){t.breakByAttributeName===e.breakByAttributeName&&(t.isCardOld=e.isCardOld,t.lastUpdateTimestamp=e.lastUpdateTimestamp)})})}(t,e),c}(t[0].timestampDateFormat,n),u=!r&&1===n.data.length&&n.parsedData[0].trendChartData.length>1;if(c||u||0!==l.length&&t.some(function(t){return!l.includes(t.cells[i].v)}))this.plot();else{var s=n.dataInterface.data.realtimeQueryInfo.columns,d=[];t.forEach(function(t){s.forEach(function(e,n){-1===e.bfid&&d.push(t.cells[n])})}),this.rerenderVisualization(d,e)}},localImageAdded:function(t){var e=this,n=JSON.parse(e.getProperty(O));n[T.IMAGE_PROP_NAME.name]=t.imageName,n[T.IMAGE_PROP_URL.name]=t.base64Str,e.savePropertyAndUpdateWidgetAsync(O,JSON.stringify(n)),e.plot(n)},urlImageAdded:function(t){var e=this,n=JSON.parse(e.getProperty(O)),r=function(t){e.savePropertyAndUpdateWidgetAsync(O,JSON.stringify(n)),mstrmojo.alert(t?mstrmojo.desc(25021,"Only HTTPS URL schemes are allowed."):mstrmojo.desc(20905,"Please ensure that the URL points to a valid image file."),null,mstrmojo.desc(12068,"Invalid URL"))};mstrmojo.imageUtils.isURLValid(t)?(mstrApp.showWait({message:mstrmojo.desc(1212,"Processing...")}),mstrmojo.imageUtils.isImageAccessible(t,{success:function(){mstrApp.hideWait(),n[T.IMAGE_PROP_NAME.name]=t,n[T.IMAGE_PROP_URL.name]=t,e.savePropertyAndUpdateWidgetAsync(O,JSON.stringify(n)),e.plot(n)},failure:function(){mstrApp.hideWait(),r(!1)}})):r(!0)}})})();